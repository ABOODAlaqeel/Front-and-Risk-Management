import{r as o,j as e,V as ia,e as na,f as la,C as ca,X as et,T as oa,D as da,P as Hr,h as ma,i as qr,R as O,u as st,L as ke,N as ys,S as Kr,k as ua,l as xa,m as ha,n as pa,o as zr,p as ga,I as Yr,q as tt,s as fa,t as ja,v as va,w as Wr,x as ba,y as Jr,z as ya,B as Na,E as Gr,F as at,G as Qr,H as wa,J as Xr,K as Zr,M as gs,O as Ze,Q as Tt,U as ei,W as $t,Y as _t,Z as Dt,_ as ka,$ as Sa,a0 as Ta,a1 as si,a2 as Da,a3 as Ca,a4 as Ra,a5 as Aa,a6 as Pa,a7 as Ia,a8 as La,a9 as Ea,aa as ti,ab as ai,ac as ri,ad as ii,ae as ni,af as Fa,ag as Oa,ah as Ma,ai as $a,aj as li,ak as ci,al as _a,am as oi,an as Ba,ao as Ua,ap as ss,aq as Va,ar as Ks,as as Ha,at as bt,au as fs,av as di,aw as qa,ax as Q,ay as mi,az as ui,aA as Ka,aB as xi,aC as hi,aD as ze,aE as za,aF as pi,aG as gi,aH as Me,aI as fi,aJ as Ya,aK as ji,aL as Wa,aM as Ja,aN as Ga,aO as Qa,aP as Xa,aQ as vi,aR as bi,aS as yi,aT as Ni,aU as Us,aV as ns,aW as Za,aX as wi,aY as er,aZ as ki,a_ as Si,a$ as Ti,b0 as sr,b1 as Di,b2 as tr,b3 as Ci,b4 as ar,b5 as rr,b6 as Ri,b7 as Ai,b8 as ws,b9 as Ct,ba as rt,bb as hs,bc as Ye,bd as Pi,be as ir,bf as Ii,bg as Li,bh as it,bi as Ei,bj as nr,bk as Fi,bl as Oi,bm as Mi,bn as Bt,bo as Ps,bp as $i,bq as _i,br as Bi,bs as lr,bt as Ui,bu as cr,bv as or,bw as Vi,bx as Hi,by as qi,bz as Ki,bA as zi,bB as re,bC as Yi,bD as Wi,bE as Ji}from"./react-vendor-CR30I2FQ.js";import{aD as Gi,f as Qi,aE as Ls,aF as Xi,aG as Zi,aH as dr}from"./vendor-C9L14_9Z.js";import{Q as en}from"./query-vendor-6kPKn-jw.js";import{R as zs,L as sn,C as Ys,X as Ws,Y as Js,T as Gs,a as mr,b as Es,B as yt,c as Nt,d as ur}from"./charts-vendor-17o_d4ot.js";import"./radix-vendor-BQCqNqg0.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const d of i)if(d.type==="childList")for(const l of d.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function a(i){const d={};return i.integrity&&(d.integrity=i.integrity),i.referrerPolicy&&(d.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?d.credentials="include":i.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function r(i){if(i.ep)return;i.ep=!0;const d=a(i);fetch(i.href,d)}})();const tn=1,an=1e6;let xt=0;function rn(){return xt=(xt+1)%Number.MAX_SAFE_INTEGER,xt.toString()}const ht=new Map,Ut=s=>{if(ht.has(s))return;const t=setTimeout(()=>{ht.delete(s),Ts({type:"REMOVE_TOAST",toastId:s})},an);ht.set(s,t)},nn=(s,t)=>{switch(t.type){case"ADD_TOAST":return{...s,toasts:[t.toast,...s.toasts].slice(0,tn)};case"UPDATE_TOAST":return{...s,toasts:s.toasts.map(a=>a.id===t.toast.id?{...a,...t.toast}:a)};case"DISMISS_TOAST":{const{toastId:a}=t;return a?Ut(a):s.toasts.forEach(r=>{Ut(r.id)}),{...s,toasts:s.toasts.map(r=>r.id===a||a===void 0?{...r,open:!1}:r)}}case"REMOVE_TOAST":return t.toastId===void 0?{...s,toasts:[]}:{...s,toasts:s.toasts.filter(a=>a.id!==t.toastId)}}},Vs=[];let Hs={toasts:[]};function Ts(s){Hs=nn(Hs,s),Vs.forEach(t=>{t(Hs)})}function ln({...s}){const t=rn(),a=i=>Ts({type:"UPDATE_TOAST",toast:{...i,id:t}}),r=()=>Ts({type:"DISMISS_TOAST",toastId:t});return Ts({type:"ADD_TOAST",toast:{...s,id:t,open:!0,onOpenChange:i=>{i||r()}}}),{id:t,dismiss:r,update:a}}function Pe(){const[s,t]=o.useState(Hs);return o.useEffect(()=>(Vs.push(t),()=>{const a=Vs.indexOf(t);a>-1&&Vs.splice(a,1)}),[s]),{...s,toast:ln,dismiss:a=>Ts({type:"DISMISS_TOAST",toastId:a})}}function n(...s){return Gi(Qi(s))}const cn=Hr,xr=o.forwardRef(({className:s,...t},a)=>e.jsx(ia,{ref:a,className:n("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",s),...t}));xr.displayName=ia.displayName;const on=Ls("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),hr=o.forwardRef(({className:s,variant:t,...a},r)=>e.jsx(na,{ref:r,className:n(on({variant:t}),s),...a}));hr.displayName=na.displayName;const dn=o.forwardRef(({className:s,...t},a)=>e.jsx(la,{ref:a,className:n("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors group-[.destructive]:border-muted/40 hover:bg-secondary group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 group-[.destructive]:focus:ring-destructive disabled:pointer-events-none disabled:opacity-50",s),...t}));dn.displayName=la.displayName;const pr=o.forwardRef(({className:s,...t},a)=>e.jsx(ca,{ref:a,className:n("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity group-hover:opacity-100 group-[.destructive]:text-red-300 hover:text-foreground group-[.destructive]:hover:text-red-50 focus:opacity-100 focus:outline-none focus:ring-2 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",s),"toast-close":"",...t,children:e.jsx(et,{className:"h-4 w-4"})}));pr.displayName=ca.displayName;const gr=o.forwardRef(({className:s,...t},a)=>e.jsx(oa,{ref:a,className:n("text-sm font-semibold",s),...t}));gr.displayName=oa.displayName;const fr=o.forwardRef(({className:s,...t},a)=>e.jsx(da,{ref:a,className:n("text-sm opacity-90",s),...t}));fr.displayName=da.displayName;function mn(){const{toasts:s}=Pe();return e.jsxs(cn,{children:[s.map(function({id:t,title:a,description:r,action:i,...d}){return e.jsxs(hr,{...d,children:[e.jsxs("div",{className:"grid gap-1",children:[a&&e.jsx(gr,{children:a}),r&&e.jsx(fr,{children:r})]}),i,e.jsx(pr,{})]},t)}),e.jsx(xr,{})]})}const un=({...s})=>{const{theme:t="system"}=Xi();return e.jsx(Zi,{theme:t,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...s})},xn=qr,hn=o.forwardRef(({className:s,sideOffset:t=4,...a},r)=>e.jsx(ma,{ref:r,sideOffset:t,className:n("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...a}));hn.displayName=ma.displayName;const ms={LOW:{max:4,label:"Low",color:"status-low"},MEDIUM:{min:5,max:9,label:"Medium",color:"status-medium"},HIGH:{min:10,max:14,label:"High",color:"status-high"},CRITICAL:{min:15,label:"Critical",color:"status-critical"}},pn="riskms_system_settings_v1",Rt="riskms_permissions_v1",gn=()=>{try{const s=localStorage.getItem(pn);if(!s)return null;const t=JSON.parse(s);if(!t||typeof t!="object")return null;const a=t.riskMatrixThresholds;if(!a)return null;const r=Number(a.low),i=Number(a.medium),d=Number(a.high);return[r,i,d].every(Number.isFinite)?{low:r,medium:i,high:d}:null}catch{return null}},nt=s=>{const t=gn(),a=t?.low??ms.LOW.max,r=t?.medium??ms.MEDIUM.max,i=t?.high??ms.HIGH.max;return s<=a?ms.LOW:s<=r?ms.MEDIUM:s<=i?ms.HIGH:ms.CRITICAL},jr=["Operational","Financial","Strategic","Compliance","Technology","Reputational","Environmental","Security"],vr=["Open","Closed","Monitoring"],fn=["Mitigate","Transfer","Avoid","Accept"],Vt=["Not Started","In Progress","Done"],Fs=["Context","Identification","Analysis","Evaluation","Treatment","Monitoring"],lt=["Admin","Data Entry","Viewer"],Qs={Admin:{canCreate:!0,canEdit:!0,canDelete:!0,canViewTreatments:!0,canViewReports:!0,canViewAnalysis:!0,canViewBCP:!0,canViewFollowUp:!0,canExport:!0,canViewSettings:!0,canViewAudit:!0,canManageUsers:!0},"Data Entry":{canCreate:!0,canEdit:!0,canDelete:!1,canViewTreatments:!0,canViewReports:!0,canViewAnalysis:!0,canViewBCP:!0,canViewFollowUp:!0,canExport:!1,canViewSettings:!1,canViewAudit:!1,canManageUsers:!1},Viewer:{canCreate:!1,canEdit:!1,canDelete:!1,canViewTreatments:!0,canViewReports:!0,canViewAnalysis:!0,canViewBCP:!0,canViewFollowUp:!0,canExport:!1,canViewSettings:!1,canViewAudit:!1,canManageUsers:!1}},br=s=>{const t=s&&typeof s=="object"?s:null,a={};for(const r of lt){const i=t&&t[r]&&typeof t[r]=="object"?t[r]:null,d=Qs[r],l={};Object.keys(Qs.Admin).forEach(h=>{const g=i?i[h]:void 0;l[h]=typeof g=="boolean"?g:d[h]}),r==="Admin"&&(l.canViewSettings=!0),a[r]=l}return a},Ds=()=>{try{const s=localStorage.getItem(Rt);if(!s)return Qs;const t=JSON.parse(s);return br(t)}catch{return Qs}},jn=s=>{try{localStorage.setItem(Rt,JSON.stringify(br(s)))}catch{}},vn=()=>{try{localStorage.removeItem(Rt)}catch{}},yr="http://localhost:5000/api/v1",ct="auth_token",At="auth_refresh_token",bn="auth_user",$=dr.create({baseURL:yr,timeout:3e4,headers:{"Content-Type":"application/json",Accept:"application/json"}});$.interceptors.request.use(s=>{const t=localStorage.getItem(ct);return t&&(s.headers.Authorization=`Bearer ${t}`),s},s=>(console.error("[API Request Error]",s),Promise.reject(s)));$.interceptors.response.use(s=>s,async s=>{const t=s.config;if(s.response?.status===401&&!t._retry){t._retry=!0;try{const a=localStorage.getItem(At);if(a){const r=await dr.post(`${yr}/auth/refresh`,{refresh_token:a});if(r.data.success){const i=r.data.data.access_token;return localStorage.setItem(ct,i),t.headers.Authorization=`Bearer ${i}`,$(t)}}}catch(a){return qs(),window.location.href="/login",Promise.reject(a)}}return Promise.reject(s)});const pt=(s,t)=>{localStorage.setItem(ct,s),t&&localStorage.setItem(At,t)},qs=()=>{localStorage.removeItem(ct),localStorage.removeItem(At),localStorage.removeItem(bn)},W=s=>{if(s.data.success&&s.data.data!==void 0)return s.data.data;throw new Error(s.data.error?.message||"Unknown API error")},Is=s=>{const t=Object.entries(s).filter(([,r])=>r!=null&&r!=="");return t.length===0?"":`?${t.map(([r,i])=>`${encodeURIComponent(r)}=${encodeURIComponent(String(i))}`).join("&")}`},yn={super_admin:"Admin",risk_manager:"Data Entry",risk_owner:"Data Entry",viewer:"Viewer"},Nn=s=>yn[s]||"Viewer",wn={identified:"Open",analyzing:"Open",analyzed:"Open",treating:"Open",treated:"Monitoring",monitoring:"Monitoring",accepted:"Monitoring",closed:"Closed"},kn={Open:"identified",Monitoring:"monitoring",Closed:"closed"},Sn=s=>wn[s]||"Open",Os=s=>kn[s]||"identified",Tn={low:"Low",medium:"Medium",high:"High",critical:"Critical"},Nr=s=>Tn[s]||"Low",Dn={avoid:"Avoid",mitigate:"Mitigate",transfer:"Transfer",accept:"Accept"},Cn={Avoid:"avoid",Mitigate:"mitigate",Transfer:"transfer",Accept:"accept"},Rn=s=>Dn[s]||"Mitigate",An=s=>Cn[s]||"mitigate",Pn=s=>s?"Done":"In Progress",In=s=>s==="Done",cs=s=>{let t="viewer";s.role&&(typeof s.role=="object"&&s.role.code?t=s.role.code:typeof s.role=="string"&&(t=s.role));const a=s.role_name||"";return(a.includes("مدير")||a.toLowerCase().includes("admin"))&&(t="super_admin"),{id:String(s.id),email:s.email,name:s.full_name,role:Nn(t),avatar:s.avatar_url}},ks=s=>{const t=s.residual_likelihood??s.inherent_likelihood??1,a=s.residual_impact??s.inherent_impact??1,r=s.residual_score??s.inherent_score??t*a,i=s.category?.code||s.category?.name||"operational",d=ot(i);return{id:s.code||`RISK-${String(s.id).padStart(3,"0")}`,title:s.title,description:s.description,category:d,owner:s.owner?.full_name||"غير محدد",status:Sn(s.status),likelihood:t,impact:a,score:r,level:Nr(s.risk_level||"low"),createdAt:s.created_at,updatedAt:s.updated_at,stagesHistory:[]}},us=s=>({id:`ASS-${String(s.id).padStart(3,"0")}`,riskId:s.risk?.code||`RISK-${String(s.risk_id).padStart(3,"0")}`,likelihood:s.likelihood,impact:s.impact,score:s.score,level:Nr(s.risk_level),assessor:s.assessor?.full_name||"غير محدد",date:s.created_at.split("T")[0],notes:s.notes||s.rationale||""}),vs=s=>({id:`TRT-${String(s.id).padStart(3,"0")}`,riskId:s.risk?.code||`RISK-${String(s.risk_id).padStart(3,"0")}`,approach:Rn(s.strategy),actions:(s.actions||[]).map(wr),createdAt:s.created_at,updatedAt:s.updated_at}),wr=s=>({id:`ACT-${String(s.id).padStart(6,"0")}`,title:s.title,owner:s.assignee?.full_name||"غير محدد",dueDate:s.due_date||"",status:Pn(s.is_completed),evidenceLink:s.evidence_url}),Ht=wr,qt=An,Kt=s=>({id:`LOG-${String(s.id).padStart(3,"0")}`,timestamp:s.created_at,actor:s.user?.full_name||"System",action:s.action.toUpperCase(),entityType:s.entity_type,entityId:String(s.entity_id||""),details:s.description||""}),es=(s,t)=>`${t}-${String(s).padStart(3,"0")}`,Ln={operational:"Operational",financial:"Financial",strategic:"Strategic",compliance:"Compliance",technology:"Technology",reputational:"Reputational",environmental:"Environmental",security:"Security"},ot=s=>Ln[s.toLowerCase()]||s,En={critical:"Critical",high:"High",medium:"Medium",low:"Low"},Fn={planned:"Planned",in_progress:"Planned",passed:"Passed",failed:"Failed",cancelled:"Failed",partial:"Passed"},Ms=s=>({id:es(s.id,"SVC"),name:s.name,criticality:En[s.criticality]||"Medium",rto:s.rto||"N/A",rpo:s.rpo||"N/A",dependencies:s.dependencies||[],owner:s.owner?.full_name||s.department||"Unassigned"}),gt=s=>({id:es(s.id,"DR"),name:s.name}),$s=s=>({id:es(s.id,"TEST"),name:s.name,type:s.test_type==="dr"?"DR":"BCP",date:s.scheduled_date?.split("T")[0]||new Date().toISOString().split("T")[0],status:Fn[s.status]||"Planned",durationMinutes:s.duration_minutes,notes:s.notes,serviceIds:s.service_ids?.map(t=>es(t,"SVC")),drTargetId:s.dr_site_id?es(s.dr_site_id,"DR"):void 0}),On={green:"green",yellow:"yellow",red:"red"},_s=s=>({id:es(s.id,"KRI"),riskId:s.risk_id?es(s.risk_id,"RISK"):void 0,metricName:s.name,value:s.current_value||0,targetValue:s.target_value||0,status:On[s.status]||"green",updatedAt:s.last_updated?.split("T")[0]||s.updated_at.split("T")[0]}),Mn={low:"Low",medium:"Medium",high:"High",critical:"Critical"},$n={open:"Open",investigating:"Investigating",contained:"Investigating",resolved:"Resolved",closed:"Resolved"},ft=s=>({id:es(s.id,"INC"),riskId:s.risk_id?es(s.risk_id,"RISK"):"",title:s.title,date:s.occurred_at.split("T")[0],severity:Mn[s.severity]||"Medium",status:$n[s.status]||"Open"}),bs={async login(s){try{const t=await $.post("/auth/login",{email:s.email,password:s.password}),a=W(t),r=cs(a.user);return pt(a.access_token,a.refresh_token),{token:a.access_token,refreshToken:a.refresh_token,user:r}}catch(t){const a=t;throw new Error(a.response?.data?.error?.message||"فشل تسجيل الدخول")}},async loginWithRole(s){if(s==="Admin")return bs.login({email:"admin@rms.local",password:"Admin@123"});throw new Error("الحساب غير متوفر تلقائياً. استخدم تسجيل الدخول بالبريد الإلكتروني.")},async register(s){try{const t=await $.post("/auth/register",{email:s.email,password:s.password,full_name:s.fullName,phone:s.phone,department:s.department,job_title:s.jobTitle}),a=W(t),r=cs(a.user);return pt(a.access_token,a.refresh_token),{token:a.access_token,refreshToken:a.refresh_token,user:r}}catch(t){const a=t;throw new Error(a.response?.data?.error?.message||"فشل التسجيل")}},async logout(){try{await $.post("/auth/logout")}catch{}finally{qs()}},async validateToken(){try{const s=await $.get("/auth/me"),t=W(s);return cs(t)}catch{return qs(),null}},async refreshToken(s){try{const t=await $.post("/auth/refresh",{refresh_token:s}),a=W(t);return pt(a.access_token),a.access_token}catch{throw qs(),new Error("فشل تجديد الجلسة")}},async forgotPassword(s){try{await $.post("/auth/forgot-password",{email:s})}catch(t){const a=t;throw new Error(a.response?.data?.error?.message||"فشل إرسال رابط الاستعادة")}},async resetPassword(s,t){try{await $.post("/auth/reset-password",{token:s,password:t})}catch(a){const r=a;throw new Error(r.response?.data?.error?.message||"فشل إعادة تعيين كلمة المرور")}},async changePassword(s,t){try{await $.post("/auth/change-password",{current_password:s,new_password:t})}catch(a){const r=a;throw new Error(r.response?.data?.error?.message||"فشل تغيير كلمة المرور")}}},_n=async()=>{try{const s=await $.get("/auth/stats");return{hasAdmin:W(s).has_admin!==!1}}catch{return{hasAdmin:!0}}},kr={Operational:1,Financial:2,Strategic:3,Compliance:4,Technology:5,Reputational:6,Environmental:7,Security:8};let Ns=null;const Sr=async()=>{if(Ns)return Ns;const s=await $.get("/risks/categories"),t=W(s)||[];return Ns=t,t},zt=async s=>{try{const a=(await Sr()).find(r=>ot(r.code||r.name||"")===s||r.name===s||r.code?.toLowerCase()===s.toLowerCase());if(a?.id)return a.id}catch{}return kr[s]||1},de={async getCategories(){try{return await Sr()}catch(s){return console.error("Failed to fetch categories:",s),[]}},async createCategory(s){const t=await $.post("/risks/categories",s),a=W(t);return Ns=null,a},async updateCategory(s,t){const a=await $.put(`/risks/categories/${s}`,t),r=W(a);return Ns=null,r},async deleteCategory(s){await $.delete(`/risks/categories/${s}`),Ns=null},async getAll(s){try{const t={};s?.status&&(t.status=Os(s.status)),s?.category&&(t.category_id=await zt(s.category)),s?.search&&(t.search=s.search),s?.page&&(t.page=s.page),s?.perPage&&(t.per_page=s.perPage);const a=await $.get(`/risks${Is(t)}`);return a.data.success&&a.data.data?a.data.data.map(ks):[]}catch(t){throw console.error("Failed to fetch risks:",t),new Error("فشل في جلب المخاطر")}},async getById(s){try{const t=parseInt(s.replace(/\D/g,""),10),a=await $.get(`/risks/${t}`),r=W(a);return ks(r)}catch{return null}},async create(s){try{const t={title:s.title,description:s.description,category_id:await zt(s.category),status:s.status?Os(s.status):void 0},a=await $.post("/risks",t),r=W(a);return ks(r)}catch(t){const a=t;throw new Error(a.response?.data?.error?.message||"فشل في إنشاء الخطر")}},async update(s,t){try{const a=parseInt(s.replace(/\D/g,""),10),r={};t.title&&(r.title=t.title),t.description&&(r.description=t.description),t.category&&(r.category_id=kr[t.category]),t.status&&(r.status=Os(t.status));const i=await $.put(`/risks/${a}`,r),d=W(i);return ks(d)}catch(a){const r=a;throw new Error(r.response?.data?.error?.message||"فشل في تحديث الخطر")}},async delete(s){try{const t=parseInt(s.replace(/\D/g,""),10);await $.delete(`/risks/${t}`)}catch(t){const a=t;throw new Error(a.response?.data?.error?.message||"فشل في حذف الخطر")}},async getStats(){try{const s=await $.get("/risks/statistics");return W(s)}catch(s){throw console.error("Failed to fetch stats:",s),new Error("فشل في جلب الإحصائيات")}},async changeStatus(s,t){try{const a=parseInt(s.replace(/\D/g,""),10),r=await $.patch(`/risks/${a}/status`,{status:Os(t)}),i=W(r);return ks(i)}catch(a){const r=a;throw new Error(r.response?.data?.error?.message||"فشل في تغيير الحالة")}}},Qe={async getAll(){try{const s=await $.get("/assessments");return W(s).map(us)}catch(s){throw console.error("Failed to fetch assessments:",s),new Error("فشل في جلب التقييمات")}},async getByRiskId(s){try{const t=parseInt(s.replace(/\D/g,""),10),a=await $.get(`/risks/${t}/assessments`);return W(a).map(us)}catch(t){throw console.error("Failed to fetch risk assessments:",t),new Error("فشل في جلب تقييمات الخطر")}},async getById(s){try{const t=parseInt(s.replace(/\D/g,""),10),a=await $.get(`/assessments/${t}`),r=W(a);return us(r)}catch{return null}},async create(s){try{const a={risk_id:parseInt(s.riskId.replace(/\D/g,""),10),assessment_type:s.type||"inherent",likelihood:s.likelihood,impact:s.impact,notes:s.notes},r=await $.post("/assessments",a),i=W(r);return us(i)}catch(t){const a=t;throw new Error(a.response?.data?.error?.message||"فشل في إنشاء التقييم")}},async update(s,t){try{const a=parseInt(s.replace(/\D/g,""),10),r={};t.likelihood!==void 0&&(r.likelihood=t.likelihood),t.impact!==void 0&&(r.impact=t.impact),t.notes!==void 0&&(r.notes=t.notes);const i=await $.put(`/assessments/${a}`,r),d=W(i);return us(d)}catch(a){const r=a;throw new Error(r.response?.data?.error?.message||"فشل في تحديث التقييم")}},async delete(s){try{const t=parseInt(s.replace(/\D/g,""),10);await $.delete(`/assessments/${t}`)}catch(t){const a=t;throw new Error(a.response?.data?.error?.message||"فشل في حذف التقييم")}},async getRiskMatrix(){try{const s=await $.get("/assessments/matrix");return W(s)}catch(s){throw console.error("Failed to fetch risk matrix:",s),new Error("فشل في جلب مصفوفة المخاطر")}},async approve(s){try{const t=parseInt(s.replace(/\D/g,""),10),a=await $.patch(`/assessments/${t}/approve`),r=W(a);return us(r)}catch(t){const a=t;throw new Error(a.response?.data?.error?.message||"فشل في اعتماد التقييم")}},async reject(s,t){try{const a=parseInt(s.replace(/\D/g,""),10),r=await $.patch(`/assessments/${a}/reject`,{rejection_reason:t}),i=W(r);return us(i)}catch(a){const r=a;throw new Error(r.response?.data?.error?.message||"فشل في رفض التقييم")}}},Oe={async getAll(){try{const s=await $.get("/treatments");return W(s).map(vs)}catch(s){throw console.error("Failed to fetch treatments:",s),new Error("فشل في جلب خطط المعالجة")}},async getByRiskId(s){try{const t=parseInt(s.replace(/\D/g,""),10),a=await $.get(`/risks/${t}/treatments`);return W(a).map(vs)}catch(t){throw console.error("Failed to fetch risk treatments:",t),new Error("فشل في جلب خطط معالجة الخطر")}},async getById(s){try{const t=parseInt(s.replace(/\D/g,""),10),a=await $.get(`/treatments/${t}`),r=W(a);return vs(r)}catch{return null}},async create(s){try{const a={risk_id:parseInt(s.riskId.replace(/\D/g,""),10),title:s.title||`خطة معالجة - ${s.approach}`,strategy:qt(s.approach),description:s.description,target_date:s.targetDate,estimated_budget:s.estimatedBudget},r=await $.post("/treatments",a),i=W(r);return vs(i)}catch(t){const a=t;throw new Error(a.response?.data?.error?.message||"فشل في إنشاء خطة المعالجة")}},async update(s,t){try{const a=parseInt(s.replace(/\D/g,""),10),r={};t.approach&&(r.strategy=qt(t.approach)),t.title&&(r.title=t.title),t.description&&(r.description=t.description),t.targetDate&&(r.target_date=t.targetDate);const i=await $.put(`/treatments/${a}`,r),d=W(i);return vs(d)}catch(a){const r=a;throw new Error(r.response?.data?.error?.message||"فشل في تحديث خطة المعالجة")}},async delete(s){try{const t=parseInt(s.replace(/\D/g,""),10);await $.delete(`/treatments/${t}`)}catch(t){const a=t;throw new Error(a.response?.data?.error?.message||"فشل في حذف خطة المعالجة")}},async addAction(s,t){try{const a=parseInt(s.replace(/\D/g,""),10),r={title:t.title,description:t.description,priority:t.priority||"medium",due_date:t.dueDate},i=await $.post(`/treatments/${a}/actions`,r),d=W(i);return Ht(d)}catch(a){const r=a;throw new Error(r.response?.data?.error?.message||"فشل في إضافة الإجراء")}},async updateAction(s,t,a){try{const r=parseInt(s.replace(/\D/g,""),10),i=parseInt(t.replace(/\D/g,""),10),d={};a.title&&(d.title=a.title),a.description&&(d.description=a.description),a.dueDate&&(d.due_date=a.dueDate),a.status&&(d.is_completed=In(a.status));const l=await $.put(`/treatments/${r}/actions/${i}`,d),h=W(l);return Ht(h)}catch(r){const i=r;throw new Error(i.response?.data?.error?.message||"فشل في تحديث الإجراء")}},async deleteAction(s,t){try{const a=parseInt(s.replace(/\D/g,""),10),r=parseInt(t.replace(/\D/g,""),10);await $.delete(`/treatments/${a}/actions/${r}`)}catch(a){const r=a;throw new Error(r.response?.data?.error?.message||"فشل في حذف الإجراء")}},async approve(s){try{const t=parseInt(s.replace(/\D/g,""),10),a=await $.patch(`/treatments/${t}/approve`),r=W(a);return vs(r)}catch(t){const a=t;throw new Error(a.response?.data?.error?.message||"فشل في اعتماد الخطة")}},async getProgress(s){try{const t=parseInt(s.replace(/\D/g,""),10),a=await $.get(`/treatments/${t}/progress`);return W(a).progress}catch{return 0}}},he={async getServices(){try{const s=await $.get("/bcp/services");return W(s).map(Ms)}catch(s){throw console.error("Failed to fetch BCP services:",s),new Error("فشل في جلب الخدمات الحرجة")}},async getServiceById(s){try{const t=parseInt(s.replace(/\D/g,""),10),a=await $.get(`/bcp/services/${t}`),r=W(a);return Ms(r)}catch{return null}},async createService(s){try{const t={name:s.name,criticality:s.criticality.toLowerCase(),rto:s.rto,rpo:s.rpo,dependencies:s.dependencies,department:s.owner},a=await $.post("/bcp/services",t),r=W(a);return Ms(r)}catch(t){const a=t;throw new Error(a.response?.data?.error?.message||"فشل في إنشاء الخدمة")}},async updateService(s,t){try{const a=parseInt(s.replace(/\D/g,""),10),r={};t.name&&(r.name=t.name),t.criticality&&(r.criticality=t.criticality.toLowerCase()),t.rto&&(r.rto=t.rto),t.rpo&&(r.rpo=t.rpo),t.dependencies&&(r.dependencies=t.dependencies),t.owner&&(r.department=t.owner);const i=await $.put(`/bcp/services/${a}`,r),d=W(i);return Ms(d)}catch(a){const r=a;throw new Error(r.response?.data?.error?.message||"فشل في تحديث الخدمة")}},async deleteService(s){try{const t=parseInt(s.replace(/\D/g,""),10);await $.delete(`/bcp/services/${t}`)}catch(t){const a=t;throw new Error(a.response?.data?.error?.message||"فشل في حذف الخدمة")}},async getBCPlan(){try{const s=await $.get("/bcp/plan"),t=W(s);return{lastUpdated:t.updated_at?.split("T")[0]||new Date().toISOString().split("T")[0],status:t.status||"Active",sections:t.sections||[]}}catch(s){throw console.error("Failed to fetch BCP plan:",s),new Error("فشل في جلب خطة BCP")}},async updateBCPlan(s){try{const t={};s.status&&(t.status=s.status.toLowerCase()),s.sections&&(t.sections=s.sections);const a=await $.patch("/bcp/plan",t),r=W(a);return{lastUpdated:r.updated_at?.split("T")[0]||new Date().toISOString().split("T")[0],status:r.status||"Active",sections:r.sections||[]}}catch(t){const a=t;throw new Error(a.response?.data?.error?.message||"فشل في تحديث خطة BCP")}},async getDRPlan(){try{const s=await $.get("/bcp/dr-plan"),t=W(s);return{lastUpdated:t.last_updated?.split("T")[0]||new Date().toISOString().split("T")[0],rto:t.rto||"4 hours",rpo:t.rpo||"1 hour",sites:(t.sites||[]).map(gt)}}catch(s){throw console.error("Failed to fetch DR plan:",s),new Error("فشل في جلب خطة DR")}},async updateDRPlan(s){try{const t={};s.rto&&(t.rto=s.rto),s.rpo&&(t.rpo=s.rpo);const a=await $.patch("/bcp/dr-plan",t),r=W(a);return{lastUpdated:r.last_updated?.split("T")[0]||new Date().toISOString().split("T")[0],rto:r.rto||"4 hours",rpo:r.rpo||"1 hour",sites:(r.sites||[]).map(gt)}}catch(t){const a=t;throw new Error(a.response?.data?.error?.message||"فشل في تحديث خطة DR")}},async getDRSites(){try{const s=await $.get("/bcp/dr-sites");return W(s).map(gt)}catch(s){throw console.error("Failed to fetch DR sites:",s),new Error("فشل في جلب مواقع DR")}},async getTests(){try{const s=await $.get("/bcp/tests");return W(s).map($s)}catch(s){throw console.error("Failed to fetch BCP tests:",s),new Error("فشل في جلب الاختبارات")}},async getTestById(s){try{const t=parseInt(s.replace(/\D/g,""),10),a=await $.get(`/bcp/tests/${t}`),r=W(a);return $s(r)}catch{return null}},async createTest(s){try{const t={name:s.name,test_type:s.type.toLowerCase(),scheduled_date:s.date,status:s.status.toLowerCase(),duration_minutes:s.durationMinutes,notes:s.notes},a=await $.post("/bcp/tests",t),r=W(a);return $s(r)}catch(t){const a=t;throw new Error(a.response?.data?.error?.message||"فشل في إنشاء الاختبار")}},async updateTest(s,t){try{const a=parseInt(s.replace(/\D/g,""),10),r={};t.name&&(r.name=t.name),t.type&&(r.test_type=t.type.toLowerCase()),t.date&&(r.scheduled_date=t.date),t.status&&(r.status=t.status.toLowerCase()),t.durationMinutes&&(r.duration_minutes=t.durationMinutes),t.notes&&(r.notes=t.notes);const i=await $.put(`/bcp/tests/${a}`,r),d=W(i);return $s(d)}catch(a){const r=a;throw new Error(r.response?.data?.error?.message||"فشل في تحديث الاختبار")}},async deleteTest(s){try{const t=parseInt(s.replace(/\D/g,""),10);await $.delete(`/bcp/tests/${t}`)}catch(t){const a=t;throw new Error(a.response?.data?.error?.message||"فشل في حذف الاختبار")}},async getStats(){try{const s=await $.get("/bcp/statistics");return W(s)}catch(s){throw console.error("Failed to fetch BCP stats:",s),new Error("فشل في جلب إحصائيات BCP")}}},$e={async getUsers(s){try{const t={};s?.search&&(t.search=s.search),s?.role&&(t.role=s.role),s?.isActive!==void 0&&(t.is_active=s.isActive),s?.page&&(t.page=s.page),s?.perPage&&(t.per_page=s.perPage);const a=await $.get(`/users${Is(t)}`);return a.data.success&&a.data.data?a.data.data.map(cs):[]}catch(t){throw console.error("Failed to fetch users:",t),new Error("فشل في جلب المستخدمين")}},async getUserById(s){try{const t=parseInt(s.replace(/\D/g,""),10),a=await $.get(`/users/${t}`),r=W(a);return cs(r)}catch{return null}},async createUser(s){try{const t={email:s.email,full_name:s.fullName,password:s.password,phone:s.phone,department:s.department,job_title:s.jobTitle,role_id:s.roleId,is_active:s.isActive??!0},a=await $.post("/users",t),r=W(a);return cs(r)}catch(t){const a=t;throw new Error(a.response?.data?.error?.message||"فشل في إنشاء المستخدم")}},async updateUser(s,t){try{const a=parseInt(s.replace(/\D/g,""),10),r={};t.email&&(r.email=t.email),t.fullName&&(r.full_name=t.fullName),t.phone&&(r.phone=t.phone),t.department&&(r.department=t.department),t.jobTitle&&(r.job_title=t.jobTitle),t.roleId&&(r.role_id=t.roleId),t.isActive!==void 0&&(r.is_active=t.isActive);const i=await $.put(`/users/${a}`,r),d=W(i);return cs(d)}catch(a){const r=a;throw new Error(r.response?.data?.error?.message||"فشل في تحديث المستخدم")}},async deleteUser(s){try{const t=parseInt(s.replace(/\D/g,""),10);await $.delete(`/users/${t}`)}catch(t){const a=t;throw new Error(a.response?.data?.error?.message||"فشل في حذف المستخدم")}},async getRoles(){try{const s=await $.get("/users/roles");return W(s)}catch(s){throw console.error("Failed to fetch roles:",s),new Error("فشل في جلب الأدوار")}},async getPermissions(){try{const s=await $.get("/users/permissions");return W(s)}catch(s){throw console.error("Failed to fetch permissions:",s),new Error("فشل في جلب الصلاحيات")}},async getAuditLogs(s){try{const t={};s?.entityType&&(t.entity_type=s.entityType),s?.entityId&&(t.entity_id=s.entityId),s?.userId&&(t.user_id=s.userId),s?.action&&(t.action=s.action),s?.startDate&&(t.start_date=s.startDate),s?.endDate&&(t.end_date=s.endDate),s?.page&&(t.page=s.page),s?.perPage&&(t.per_page=s.perPage);const a=await $.get(`/audit-logs${Is(t)}`);return a.data.success&&a.data.data?a.data.data.map(Kt):[]}catch(t){throw console.error("Failed to fetch audit logs:",t),new Error("فشل في جلب سجلات التدقيق")}},async getSettings(){try{const s=await $.get("/settings");return W(s)}catch(s){throw console.error("Failed to fetch settings:",s),new Error("فشل في جلب الإعدادات")}},async updateSettings(s){try{await $.put("/settings",s)}catch(t){const a=t;throw new Error(a.response?.data?.error?.message||"فشل في تحديث الإعدادات")}},async updateProfile(s){try{const t={};s.fullName&&(t.full_name=s.fullName),s.phone&&(t.phone=s.phone),s.department&&(t.department=s.department),s.jobTitle&&(t.job_title=s.jobTitle);const a=await $.put("/auth/profile",t),r=W(a);return cs(r)}catch(t){const a=t;throw new Error(a.response?.data?.error?.message||"فشل في تحديث الملف الشخصي")}},async getAuditLogsByEntity(s,t){try{const a=parseInt(t.replace(/\D/g,""),10),r=await $.get(`/users/audit-logs?entity_type=${s}&entity_id=${a}`);return r.data.success&&r.data.data?r.data.data.map(Kt):[]}catch(a){return console.error("Failed to fetch audit logs:",a),[]}},async getSystemSettings(){try{const s=await $.get("/settings"),t=W(s)||{};return{riskMatrixThresholds:{low:t.risk_threshold_low||5,medium:t.risk_threshold_medium||12,high:t.risk_threshold_high||20},notifications:t.notifications??t.notificationsEnabled??!0,autoAssessmentReminder:t.autoAssessmentReminderDays??t.autoAssessmentReminder??t.reviewCycleDays??30}}catch(s){return console.error("Failed to fetch system settings:",s),{riskMatrixThresholds:{low:5,medium:12,high:20},notifications:!0,autoAssessmentReminder:30}}},async updateSystemSettings(s){try{await $.put("/settings",s)}catch(t){throw console.error("Failed to update system settings:",t),new Error("فشل في تحديث إعدادات النظام")}}},Bn={async getAll(s){try{const t=Is(s||{}),a=await $.get(`/kris${t}`);return(W(a)||[]).map(_s)}catch(t){return console.error("Error fetching KRIs:",t),[]}},async getByRiskId(s){try{const t=await $.get(`/risks/${s}/kris`);return(W(t)||[]).map(_s)}catch(t){return console.error(`Error fetching KRIs for risk ${s}:`,t),[]}},async getById(s){try{const t=await $.get(`/kris/${s}`),a=W(t);return a?_s(a):null}catch(t){return console.error(`Error fetching KRI ${s}:`,t),null}},async updateValue(s,t,a){try{const r=await $.post(`/kris/${s}/values`,{value:t,notes:a}),i=W(r);return i?_s(i):null}catch(r){return console.error(`Error updating KRI ${s} value:`,r),null}}},Un={async getAll(s){try{const t=Is(s||{}),a=await $.get(`/incidents${t}`);return(W(a)||[]).map(ft)}catch(t){return console.error("Error fetching incidents:",t),[]}},async getByRiskId(s){try{const t=await $.get(`/risks/${s}/incidents`);return(W(t)||[]).map(ft)}catch(t){return console.error(`Error fetching incidents for risk ${s}:`,t),[]}},async getById(s){try{const t=await $.get(`/incidents/${s}`),a=W(t);return a?ft(a):null}catch(t){return console.error(`Error fetching incident ${s}:`,t),null}}},Tr=o.createContext(null),Ne=()=>{const s=o.useContext(Tr);if(!s)throw new Error("useAuth must be used within an AuthProvider");return s},Vn=({children:s})=>{const[t,a]=o.useState(null),[r,i]=o.useState(null),[d,l]=o.useState(!0);o.useEffect(()=>{(async()=>{const T=localStorage.getItem("auth_token"),p=localStorage.getItem("auth_user");if(T&&p)try{const N=await bs.validateToken(T);N?(i(T),a(N),localStorage.setItem("auth_user",JSON.stringify(N))):(localStorage.removeItem("auth_token"),localStorage.removeItem("auth_user"))}catch{localStorage.removeItem("auth_token"),localStorage.removeItem("auth_user")}l(!1)})()},[]);const h=o.useCallback(async(k,T)=>{l(!0);try{const p=await bs.login({email:k,password:T});i(p.token),a(p.user),localStorage.setItem("auth_token",p.token),localStorage.setItem("auth_user",JSON.stringify(p.user))}finally{l(!1)}},[]),g=o.useCallback(async k=>{l(!0);try{const T=await bs.loginWithRole(k);i(T.token),a(T.user),localStorage.setItem("auth_token",T.token),localStorage.setItem("auth_user",JSON.stringify(T.user))}finally{l(!1)}},[]),L=o.useCallback(async(k,T,p,N)=>{l(!0);try{const m=await bs.register({name:k,email:T,password:p,role:N});i(m.token),a(m.user),localStorage.setItem("auth_token",m.token),localStorage.setItem("auth_user",JSON.stringify(m.user))}finally{l(!1)}},[]),f=o.useCallback(async()=>{await bs.logout(),i(null),a(null),localStorage.removeItem("auth_token"),localStorage.removeItem("auth_user")},[]),x=o.useCallback(k=>t?Ds()[t.role]?.[k]??!1:!1,[t]);return e.jsx(Tr.Provider,{value:{user:t,token:r,isAuthenticated:!!t&&!!r,isLoading:d,login:h,register:L,loginWithRole:g,logout:f,can:x},children:s})},Hn={lang:{english:"English",arabic:"Arabic"},nav:{dashboard:"Dashboard",risksDashboard:"Risks Dashboard",risks:"Risks",followUp:"Follow-up",assessments:"Assessments",treatments:"Treatments",analysis:"Analysis",analysisDashboard:"Analysis Dashboard",riskMatrix:"Risk Matrix",bcpdr:"BCP/DR",bcpDashboard:"BCP Dashboard",bcpPlans:"Continuity Plans",criticalServices:"Critical Services",bcpPlan:"Business Continuity Plan",drPlan:"Disaster Recovery",bcpTests:"BCP Tests",reports:"Reports",reportsHome:"Reports Home",reportsExecutive:"Executive Report",reportsStandard:"Standard Report",reportsCustom:"Custom Report",reportsRegister:"Register Report",settings:"Settings",users:"Users",roles:"Roles",permissions:"Permissions",system:"System",audit:"Audit Log",backup:"Backup"},page:{dashboard:"Dashboard",risksDashboard:"Risks Dashboard",riskRegister:"Risk Register",newRisk:"New Risk",assessments:"Assessments",newAssessment:"New Assessment",treatmentPlans:"Treatment Plans",followUp:"Follow-up",analysisDashboard:"Analysis Dashboard",riskMatrix:"Risk Matrix",bcpDashboard:"BCP Dashboard",bcpPlans:"Continuity Plans",criticalServices:"Critical Services",bcpPlan:"Business Continuity Plan",drPlan:"Disaster Recovery",bcpTests:"BCP Tests",reports:"Reports",reportsHome:"Reports Home",reportsExecutive:"Executive Report",reportsStandard:"Standard Report",reportsCustom:"Custom Report",users:"Users",roleManagement:"Role Management",permissions:"Permissions",systemSettings:"System Settings",auditLog:"Audit Log",riskDetails:"Risk Details",treatmentPlan:"Treatment Plan",appName:"Risk Management System"},risksDashboard:{title:"Risks Dashboard",subtitle:"A focused view of risk posture, priorities, and follow-up.",criticalHigh:"Critical/High",inProgress:"Open/Monitoring",closed:"Closed",overdue:"Overdue assessments",dueSoon:"Due soon",overdueCardTitle:"Follow-up required",overdueCardDesc:"{count} risks are overdue for reassessment (every {days} days).",viewFollowUp:"Open Follow-up",topRisksTitle:"Top priority risks",topRisksDesc:"Highest severity risks that need attention.",noTopRisks:"No high-priority risks found.",openRegister:"Open Risk Register",total:"Total"},analysis:{dashboardTitle:"Analysis Dashboard",dashboardSubtitle:"Risk overview, distribution, and assessment coverage.",openMatrix:"Open Matrix",totalRisks:"Total Risks",updatedFromRegister:"From Risk Register",highPriority:"High Priority",needsFollowUp:"Requires follow-up",totalAssessments:"Assessments",assessmentsStoredLocally:"Stored locally (demo)",avgScore:"Average Score",risksByLevel:"Risks by Level",risksByLevelDesc:"Count of risks per severity level.",risksByCategory:"Risks by Category",risksByCategoryDesc:"Count of risks per category.",topCriticalRisks:"Top Critical/High Risks",topCriticalRisksDesc:"Highest scores that need attention.",noCriticalRisks:"No high-priority risks found.",leastAssessed:"Least Assessed Risks",leastAssessedDesc:"Risks with the fewest assessments recorded.",noRisks:"No risks found.",assessmentsCountLabel:"Assessments",addAssessment:"Add Assessment",matrixTitle:"Risk Matrix",matrixSubtitle:"Distribution by likelihood and impact (click a cell to open a risk).",matrixCardTitle:"Risk Matrix",matrixCardDesc:"Counts of risks in each likelihood × impact cell.",likelihoodAxis:"Likelihood",impactAxis:"Impact",riskLabel:"risk",risksLabel:"risks",legendCritical:"Critical",legendHigh:"High",legendMedium:"Medium",legendLow:"Low",otherLevel:"Other",matrixHint:"Levels are computed from score (Likelihood × Impact) using your system thresholds."},followup:{title:"Follow-up",subtitle:"Re-assessment reminders based on the last assessment date (every {days} days).",overdue:"Overdue",dueSoon:"Due soon (≤ 14 days)",totalTracked:"Tracked risks",listTitle:"Re-assessment schedule",listDesc:"Use this list to prioritize reassessment and updates.",noRisks:"No risks found.",lastAssessment:"Last assessment",due:"Due",overdueBy:"Overdue by {days} days",dueIn:"Due in {days} days",score:"Score",assessNow:"Assess now",viewRisk:"View"},users:{title:"Users",subtitle:"Manage users (stored locally until backend integration).",addUser:"Add User",editUser:"Edit User",dialogDesc:"Create or update user details and role.",listTitle:"User Directory",listDesc:"Demo data is stored in this browser.",noUsers:"No users found.",name:"Name",email:"Email",role:"Role",namePlaceholder:"Enter name",emailPlaceholder:"name@example.com",missingFields:"Name and email are required.",createdTitle:"User created",createdDesc:"User added successfully.",updatedTitle:"User updated",updatedDesc:"Changes saved successfully.",deletedTitle:"User deleted",deletedDesc:"User removed successfully.",saveFailedTitle:"Save failed",deleteFailedTitle:"Delete failed"},bcpDashboard:{title:"BCP Dashboard",subtitle:"Operational summary for continuity planning and testing.",overviewTitle:"Overall continuity & recovery readiness",manageServices:"Services",services:"Services",vitalServices:"Vital services",critical:"Critical/High",criticalServices:"Critical services",avgRto:"Avg RTO",readyPlans:"Ready plans",hoursShort:"h",bcpStatus:"BCP Status",drTargets:"DR Targets",tests:"Tests",openTests:"Open tests",lastUpdated:"Last updated",quickLinks:"Quick links",quickLinksDesc:"Jump to the most used continuity modules.",editBcpPlan:"Edit BCP Plan",editDrPlan:"Edit DR Plan",editServices:"Manage Services",manageTests:"Manage Tests",coverage:"Coverage",coverageDesc:"Basic coverage stats across modules.",sections:"Sections",sites:"Sites",distributionTitle:"Services distribution by criticality",distributionSubtitle:"How many services fall into each criticality tier.",mediumLow:"Medium/Low",countOfTotal:"{count} of {total}",upcomingTestsTitle:"Upcoming scheduled tests",upcomingTestsDesc:"{count} continuity tests are scheduled within the next month"},bcpTests:{title:"BCP Tests",subtitle:"Track BCP/DR test execution and outcomes.",addTest:"Add Test",scheduleTest:"Schedule Test",successRate:"Success rate",scheduledTests:"Scheduled tests",executedTests:"Executed tests",listTitle:"Test History",listDesc:"Planned and executed tests (stored locally).",noTests:"No tests recorded.",dialogDesc:"Record a planned test or capture an executed result.",name:"Name",plan:"Plan",recordId:"ID",type:"Type",date:"Date",status:"Status",notes:"Notes",result:"Result",duration:"Duration",minutesShort:"min",durationMinutesLabel:"Duration (minutes)",durationMinutesPlaceholder:"e.g. 90",namePlaceholder:"e.g. Annual DR failover",notesPlaceholder:"Optional notes…",missingFieldsTitle:"Missing fields",missingFieldsDesc:"Test name is required.",createdTitle:"Test added",createdDesc:"Test saved successfully.",deletedTitle:"Test deleted",deletedDesc:"Test removed successfully.",saveFailedTitle:"Save failed",deleteFailedTitle:"Delete failed",statusPlanned:"Planned",statusPassed:"Passed",statusFailed:"Failed",statusCompleted:"Completed",resultSuccess:"Success",resultFailed:"Failed",typeBCP:"BCP",typeDR:"DR",markPassed:"Mark as passed",markFailed:"Mark as failed",emptyNotes:"—"},bcpPlans:{title:"Business continuity plans",subtitle:"Business continuity and disaster recovery plans overview.",addPlan:"Add plan",viewDetails:"View details",lastUpdated:"Last updated",mainProcedures:"Main procedures:",sectionsCount:"Sections",recoveryTargets:"Recovery targets",lastTest:"Last test",nextTest:"Next test",bcpCardTitle:"Business continuity plan",bcpCardDesc:"Plan to maintain essential services during incidents.",drCardTitle:"Disaster recovery plan",drCardDesc:"Recovery steps for critical systems and infrastructure."},common:{language:"Language",loading:"Loading…",notAllowed:"Not allowed",pleaseTryAgain:"Please try again.",search:"Search…"},header:{notifications:"Notifications",criticalRiskAlert:"Critical Risk Alert",criticalRiskAlertDesc:"Cybersecurity risk score exceeded threshold",kriWarning:"KRI Warning",kriWarningDesc:"Audit findings exceeding target",assessmentDue:"Assessment Due",assessmentDueDesc:"RISK-002 requires reassessment",timeAgo2Hours:"2 hours ago",timeAgo5Hours:"5 hours ago",timeAgo1Day:"1 day ago"},actions:{newRisk:"New Risk",viewAll:"View All",save:"Save",add:"Add",edit:"Edit",back:"Back",reset:"Reset",export:"Export",import:"Import",clear:"Clear",signIn:"Sign In",signOut:"Sign out",createAccount:"Create Account",signingIn:"Signing in…",creating:"Creating…",cancel:"Cancel",delete:"Delete"},index:{title:"Risk Management",subtitle:"Select a module from the sidebar to get started."},footer:{copyright:"© 2025 Risk Management & Business Continuity System",version:"Version 1.0.0",lastUpdated:"Last updated: Dec 27, 2025"},roles:{title:"Role Management",subtitle:"Roles are fixed; permissions can be adjusted in the Permissions page.",enabled:"enabled",noCapabilities:"No capabilities enabled.",enabledListPrefix:"Enabled:"},permissions:{title:"Permissions",subtitle:"Edit role permissions (stored locally until backend integration).",saved:"Permissions saved",resetDone:"Permissions reset to defaults",noAccess:"You don't have access to view or edit permissions.",create:"Create",edit:"Edit",delete:"Delete",viewTreatments:"View Treatments",viewReports:"View Reports",viewAnalysis:"View Analysis",viewBCP:"View BCP/DR",viewFollowUp:"View Follow-up",export:"Export",viewSettings:"View Settings",viewAudit:"View Audit",manageUsers:"Manage Users",noAccessSystemSettings:"You do not have access to system settings."},audit:{title:"Audit Log",time:"Time",actor:"Actor",action:"Action",details:"Details"},bcp:{servicesTitle:"Critical Services",servicesSubtitle:"Maintain service criticality, dependencies, and targets.",searchPlaceholder:"Search services…",noServicesFound:"No services found.",ownerPrefix:"Owner:",depsPrefix:"Dependencies:",serviceUpdated:"Service updated",serviceCreated:"Service created",serviceDeleted:"Service deleted",editService:"Edit Service",addService:"Add Service",dialogDesc:"Define targets and operational dependencies.",serviceName:"Service Name",enterServiceName:"Enter service name",criticality:"Criticality",owner:"Owner",enterOwner:"Enter owner",dependenciesLabel:"Dependencies (comma separated)",dependenciesPlaceholder:"Database, Auth Service, CDN",deleteServiceTitle:"Delete service?",deleteServiceDesc:"This action cannot be undone.",failedToLoadServices:"Failed to load services",missingFieldsTitle:"Missing fields",missingFieldsDesc:"Name, owner, RTO, and RPO are required.",noPermissionEdit:"You do not have permission to edit.",noPermissionCreate:"You do not have permission to create.",noPermissionDelete:"You do not have permission to delete.",saveFailedTitle:"Save failed",deleteFailedTitle:"Delete failed",viewDetails:"View details",serviceDetailsTitle:"Service details",serviceCardHint:"Maintain recovery targets and operational dependencies",depsCount:"{count} deps",planTitle:"Business Continuity Plan",planSubtitle:"Edit plan metadata and sections.",failedToLoadPlan:"Failed to load BCP plan",planSaved:"BCP plan saved",noPlanData:"No plan data available.",planDetails:"Plan Details",status:"Status",lastUpdated:"Last Updated",sections:"Sections",addSection:"Add Section",noSectionsYet:"No sections yet.",section:"Section",newSection:"New Section",remove:"Remove",drTitle:"Disaster Recovery",drSubtitle:"Maintain recovery targets and sites.",failedToLoadDrPlan:"Failed to load DR plan",drPlanSaved:"DR plan saved",rtoTarget:"Target RTO",rpoTarget:"Target RPO",rtoPlaceholder:"e.g. 4 hours",rpoPlaceholder:"e.g. 1 hour",recoverySites:"Recovery Sites",addSite:"Add Site",newSite:"New Site",noSites:"No sites configured.",addTarget:"Add Target",newTarget:"New Target",lastTest:"Last test",statusReady:"Ready",targetDetailsTitle:"Target details",targetDetailsSubtitle:"Shows what this target is linked to.",targetName:"Target name",targetId:"Target ID",targetStatus:"Status",linkedServices:"Linked services",linkedCount:"{count} linked",noLinkedServices:"No linked services.",recoveryStrategyTitle:"Recovery strategy",recoveryStrategySubtitle:"Overview based on disaster recovery targets",averageRpo:"Average RPO",averageRto:"Average RTO",availabilityRate:"Availability rate",criticalityCritical:"Critical",criticalityHigh:"High",criticalityMedium:"Medium",criticalityLow:"Low",statusActive:"Active",statusDraft:"Draft",statusInReview:"In Review",statusArchived:"Archived"},treatments:{plansTitle:"Treatment Plans",plansSubtitle:"Select a risk to manage its treatment plan.",noRisksFound:"No risks found.",managePlan:"Manage Treatment Plan",planTitle:"Treatment Plan",viewRisk:"View Risk",savePlan:"Save Plan",createPlan:"Create Plan",planSettings:"Plan Settings",approach:"Approach",selectApproach:"Select approach",progress:"Progress",completed:"Completed",noPlanYet:"No plan exists yet. Choose an approach and click “Create Plan”.",actionsTitle:"Treatment Actions",addAction:"Add Action",riskNotFoundTitle:"Risk not found",riskNotFoundDesc:"The selected risk does not exist.",failedToLoad:"Failed to load treatment plan",noCreatePermission:"You do not have permission to create a treatment plan.",noEditPlanPermission:"You do not have permission to edit this treatment plan.",created:"Treatment plan created",updated:"Treatment plan updated",saveFailedTitle:"Save failed",saveFailedDesc:"Could not save the treatment plan. Please try again.",noEditActionsPermission:"You do not have permission to edit treatment actions.",missingFieldsTitle:"Missing fields",missingFieldsDesc:"Title, owner, and due date are required.",actionAdded:"Action added",actionUpdated:"Action updated",actionRemoved:"Action removed",deleteFailedTitle:"Delete failed",deleteFailedDesc:"Could not remove the action. Please try again.",updateFailedTitle:"Update failed",updateFailedDesc:"Could not update action status.",approachMitigate:"Mitigate",approachTransfer:"Transfer",approachAvoid:"Avoid",approachAccept:"Accept",statusNotStarted:"Not Started",statusInProgress:"In Progress",statusDone:"Done",createPlanToStartActions:"Create a plan to start adding actions.",noActionsYet:"No actions yet. Add your first action.",ownerPrefix:"Owner:",duePrefix:"Due:",evidence:"Evidence",editAction:"Edit Action",addActionDialog:"Add Action",actionDialogDesc:"Track owners, due dates, and completion status.",fieldTitle:"Title",fieldOwner:"Owner",fieldDueDate:"Due Date",fieldStatus:"Status",fieldEvidence:"Evidence Link (optional)",placeholderActionTitle:"Enter action title",placeholderOwner:"Enter owner",placeholderEvidence:"https://…",deleteActionTitle:"Delete action?",deleteActionDesc:"This will remove the action from the treatment plan."},table:{id:"ID",title:"Title",description:"Description",category:"Category",count:"Count",status:"Status",owner:"Owner",score:"Score",level:"Level",updated:"Updated",actions:"Actions",likelihoodShort:"L",impactShort:"I"},auth:{productTagline:"Business Continuity & Risk Control",cardTitle:"Sign In",cardDescription:"Sign in or create an account (frontend-only demo)",tabQuick:"Quick",tabEmail:"Sign In",tabSignup:"Create Account",quickHint:"Select a role to login instantly (demo mode)",email:"Email",password:"Password",anyPassword:"Enter any password",demoUsers:"Demo users: admin@company.com, analyst@company.com, viewer@company.com",fullName:"Full name",yourName:"Your name",role:"Role",selectRole:"Select a role",adminDisabled:"Admin registration is disabled because an Admin account already exists.",adminFirstSetup:"First-time setup: you can create an Admin account.",toastWelcomeBackTitle:"Welcome back!",toastWelcomeBackDesc:"You have successfully logged in.",toastLoginFailedTitle:"Login failed",toastLoginFailedDesc:"Invalid email or password. Try: admin@company.com, analyst@company.com, or viewer@company.com",toastWelcomeTitle:"Welcome!",toastLoggedInAs:"Logged in as",toastSomethingWrong:"Something went wrong. Please try again.",toastAccountCreatedTitle:"Account created",toastAccountCreatedDesc:"You are now signed in.",toastSignupFailedTitle:"Sign up failed",toastSignupFailedDesc:"Please check your details and try again.",roleAdminDesc:"Full access to all features including settings and audit logs",roleDataEntryDesc:"Can create and edit risks, assessments, and treatments (and view dashboards/reports)",roleViewerDesc:"Read-only access to view risks, dashboards, reports, and BCP/DR",footerVersion:"Risk Management & Business Continuity System v1.0"},dashboard:{loading:"Loading dashboard…",title:"Dashboard",subtitle:"Risk overview and key indicators",totalRisks:"Total Risks",open:"open",criticalHighRisks:"Critical/High Risks",requiresAttention:"Requires attention",kriStatus:"KRI Status",avgRiskScore:"Avg Risk Score",fromLastMonth:"from last month",keyRiskIndicators:"Key Risk Indicators",riskTrendOverTime:"Risk Trend Over Time",risksByCategory:"Risks by Category",criticalHighTableTitle:"Critical & High Priority Risks",riskAlerts:"Risk Alerts",current:"Current",alertCritical:"CRITICAL",alertWarning:"WARNING",target:"Target",updated:"Updated"},risks:{loading:"Loading risks…",riskRegister:"Risk Register",risksTracked:"risks tracked",searchPlaceholder:"Search risks by title or description…",filters:"Filters",clear:"Clear",category:"Category",allCategories:"All Categories",riskLevel:"Risk Level",allLevels:"All Levels",status:"Status",allStatuses:"All Statuses",noRisksFound:"No risks found",noRisksMatchFilters:"No risks match your current filters. Try adjusting your search criteria.",getStartedCreate:"Get started by creating your first risk entry.",createRisk:"Create Risk",toastRiskDeletedTitle:"Risk deleted",toastRiskDeletedDescSuffix:"has been deleted.",toastErrorTitle:"Error",toastDeleteFailed:"Failed to delete risk.",deleteDialogTitle:"Delete Risk",deleteDialogDescriptionPrefix:"Are you sure you want to delete",deleteDialogDescriptionSuffix:"This action cannot be undone.",categories:{Operational:"Operational",Financial:"Financial",Strategic:"Strategic",Compliance:"Compliance",Technology:"Technology",Reputational:"Reputational",Environmental:"Environmental",Security:"Security"},statuses:{Open:"Open",Closed:"Closed",Monitoring:"Monitoring"},levels:{Low:"Low",Medium:"Medium",High:"High",Critical:"Critical"},stages:{Context:"Context",Identification:"Identification",Analysis:"Analysis",Evaluation:"Evaluation",Treatment:"Treatment",Monitoring:"Monitoring"},form:{loadingRisk:"Loading risk…",backToRiskRegister:"Back to Risk Register",editRiskTitle:"Edit Risk",createRiskTitle:"Create New Risk",updateRisk:"Update Risk",createRisk:"Create Risk",saving:"Saving…",requiredTitle:"Title is required",requiredDescription:"Description is required",requiredCategory:"Category is required",requiredOwner:"Owner is required",placeholderTitle:"Enter risk title",placeholderDescription:"Describe the risk in detail",placeholderCategory:"Select category",placeholderOwner:"Risk owner / responsible party",assessmentTitle:"Risk Assessment",likelihood:"Likelihood",impact:"Impact",rare:"Rare",almostCertain:"Almost Certain",insignificant:"Insignificant",catastrophic:"Catastrophic",scoreTitle:"Risk Score",levelTitle:"Risk Level",toastUpdatedTitle:"Risk updated",toastUpdatedDesc:"The risk has been updated successfully.",toastCreatedTitle:"Risk created",toastCreatedDescSuffix:"has been created.",toastSaveFailed:"Failed to save risk.",stageCreatedNote:"Risk created",stageUpdatedBy:"Current User"},details:{loadingDetails:"Loading risk details…",notFoundTitle:"Risk not found",notFoundDesc:"The risk you're looking for doesn't exist.",editRisk:"Edit Risk",newAssessment:"New Assessment",lifecycleTitle:"Risk Lifecycle",overview:"Overview",assessments:"Assessments",treatment:"Treatment",incidents:"Incidents",auditTrail:"Audit Trail",riskAssessment:"Risk Assessment",likelihoodScale:"Likelihood (1-5)",impactScale:"Impact (1-5)",scoreScale:"Score (L×I)",treatmentProgress:"Treatment Progress",approachLabel:"Approach:",completeSuffix:"complete",viewTreatmentPlan:"View Treatment Plan",assessmentHistory:"Assessment History",addAssessment:"Add Assessment",noAssessments:"No assessments recorded yet.",byPrefix:"By:",likelihoodLabel:"Likelihood:",impactLabel:"Impact:",scoreLabel:"Score:",editAssessmentTitle:"Edit Assessment",editAssessmentDesc:"Update likelihood, impact, and assessor details.",assessor:"Assessor",date:"Date",notes:"Notes",pending:"Pending",deleteAssessmentTitle:"Delete assessment?",deleteAssessmentDesc:"This action cannot be undone.",managePlan:"Manage Plan",noTreatmentPlan:"No treatment plan created yet.",createTreatmentPlan:"Create Treatment Plan",openEvidence:"Open evidence link",noRelatedIncidents:"No related incidents.",noAuditEntries:"No audit entries."}},assessments:{newTitle:"New Assessment",forPrefix:"for",selectRiskHint:"Select a risk to create an assessment.",recentTitle:"Recent assessments",viewAll:"View all",noRecent:"No assessments recorded yet.",loadingRisks:"Loading risks…",noRisksYet:"No risks available yet.",createRisk:"Create a Risk",riskLabel:"Risk",selectRiskPlaceholder:"Select a risk",failedToLoadRisksTitle:"Failed to load risks",riskNotFoundTitle:"Risk not found",riskNotFoundDesc:"The selected risk could not be found. Please select a different risk.",missingRiskIdTitle:"Missing Risk ID",missingRiskIdDesc:"Please select a risk first.",invalidDateTitle:"Invalid date",invalidDateDesc:"Assessment date cannot be in the future.",assessorRequiredTitle:"Assessor is required",assessorRequiredDesc:"Please enter who performed the assessment.",assessor:"Assessor",assessorPlaceholder:"Enter assessor name",date:"Date",likelihood:"Likelihood",impact:"Impact",rare:"Rare",almostCertain:"Almost Certain",insignificant:"Insignificant",catastrophic:"Catastrophic",notes:"Notes",notesPlaceholder:"Optional notes about this assessment",createdTitle:"Assessment created",saveAssessment:"Save Assessment",failedToCreateTitle:"Failed to create assessment"},notFound:{message:"Page not found",backToDashboard:"Back to Dashboard"},reports:{failedToLoadTitle:"Failed to load report data",noExportPermission:"You do not have permission to export.",exportReadyTitle:"Export ready",exportCsvDesc:"CSV downloaded (opens in Excel).",exportHtmlDesc:"HTML report downloaded (print to PDF).",homeSubtitle:"Choose a report type and export when needed.",quickReportsTitle:"Quick reports",registerReport:"Register report",registerSubtitle:"Summary + breakdown tables + exports (existing report).",reportsHome:"Reports Home",executiveReport:"Executive Report",standardReport:"Standard Report",customReport:"Custom Report",executiveTitle:"Executive Report",executiveSubtitle:"High-level summary for leadership and decision makers",standardTitle:"Standard Report",standardSubtitle:"Printable operational report with exports",customTitle:"Custom Report",customSubtitle:"Select fields and generate a report export",print:"Print",reportConfigTitle:"Report configuration",reportConfigDesc:"Choose format and generate an export file.",format:"Format",generate:"Generate",fieldsTitle:"Fields",fieldsDesc:"Select the columns you want in your report.",previewTitle:"Preview",previewDesc:"{selected} selected out of {total}",missingFieldsTitle:"No fields selected",missingFieldsDesc:"Select at least one field to generate a report.",exportPermissionHint:"Export permission is required to generate files.",fieldLikelihood:"Likelihood",fieldImpact:"Impact",fieldCreatedAt:"Created At",executiveSummaryTitle:"Executive summary",executiveSummaryText:"There are {total} total risks, including {critical} critical risks. {closed} risks are closed.",reportTitle:"Risk Report",period:"Period",generated:"Generated",totalRisks:"Total Risks",criticalRisks:"Critical Risks",highRisks:"High Risks",inProgress:"In progress",closedRisks:"Closed Risks",highRisksLabel:"High",top5Included:"Top 5 prioritized risks included",keyRisksTitle:"Key risks",noPriorityRisks:"No critical/high risks found.",viewRisk:"View",recommendationsTitle:"Recommendations",reco1:"Prioritize critical risks with immediate mitigation actions and owners.",reco2:"Review high risks weekly and track treatment progress.",reco3:"Close risks with verified controls and document evidence.",reco4:"Use the risk matrix to validate scoring consistency.",quickLinksTitle:"Quick links",summaryTitle:"Summary",detailedTableTitle:"Detailed table",byCategory:"By Category",byStatus:"By Status",noData:"No data.",registerTitle:"Risk Register",noRisksAvailable:"No risks available.",showingTop10:"Top 10 by score",showingAll:"All risks (sorted by score)",noteHtml:"Note: This file is HTML (printable). Use your browser's Print → Save as PDF.",top10:"Top 10",all:"All",exportCsv:"Export CSV",exportHtml:"Export HTML (Print)"},system:{title:"System Settings",subtitle:"Configure risk thresholds and system behavior.",noSettings:"No settings available.",saved:"Settings saved",saveFailedTitle:"Save failed",failedToLoadTitle:"Failed to load settings",invalidThresholdsTitle:"Invalid thresholds",invalidThresholdsDesc:"Thresholds must be positive numbers.",invalidOrderTitle:"Invalid order",invalidOrderDesc:"Thresholds must satisfy Low < Medium < High.",invalidReminderTitle:"Invalid reminder",invalidReminderDesc:"Reminder days must be 0 or greater.",thresholdsTitle:"Risk Matrix Thresholds",thresholdsHelp:"Levels are calculated by score (Likelihood × Impact). Scores above “High” become “Critical”.",lowMax:"Low max",mediumMax:"Medium max",highMax:"High max",notificationsTitle:"Notifications",enableNotifications:"Enable notifications",notificationsHelp:"Controls in-app reminders and alerts.",reminderDays:"Auto assessment reminder (days)",demoDataTitle:"Demo Data",demoDataHelp:"Export or import your frontend-only data (stored in this browser). Clearing data will remove all saved demo records.",exportedTitle:"Exported",exportedDesc:"A JSON export file has been downloaded.",importedTitle:"Imported",importedDesc:"Data imported. Reloading…",importFailedTitle:"Import failed",couldNotRead:"Could not read the file.",invalidFile:"Invalid file.",clearedTitle:"Cleared",clearedDesc:"All demo data cleared. Reloading…",noAccessDesc:"You do not have access to system settings.",exportJson:"Export JSON",importJson:"Import JSON",clearAllData:"Clear All Data",clearDialogTitle:"Clear all demo data?",clearDialogDescription:"This will remove all saved Risks, Assessments, Treatments, BCP/DR plans, and Settings from this browser."}},qn={lang:{english:"الإنجليزية",arabic:"العربية"},nav:{dashboard:"لوحة التحكم",risksDashboard:"لوحة المخاطر",risks:"المخاطر",followUp:"المتابعة",assessments:"التقييمات",treatments:"خطط المعالجة",analysis:"التحليل",analysisDashboard:"لوحة التحليل",riskMatrix:"مصفوفة المخاطر",bcpdr:"استمرارية الأعمال/التعافي",bcpDashboard:"لوحة BCP",bcpPlans:"خطط الاستمرارية",criticalServices:"الخدمات الحرجة",bcpPlan:"خطة استمرارية الأعمال",drPlan:"خطة التعافي من الكوارث",bcpTests:"اختبارات BCP",reports:"التقارير",reportsHome:"صفحة التقارير",reportsExecutive:"تقرير تنفيذي",reportsStandard:"تقرير قياسي",reportsCustom:"تقرير مخصص",reportsRegister:"تقرير السجل",settings:"الإعدادات",users:"المستخدمون",roles:"الأدوار",permissions:"الصلاحيات",system:"النظام",audit:"سجل التدقيق",backup:"النسخ الاحتياطي"},page:{dashboard:"لوحة التحكم",risksDashboard:"لوحة المخاطر",riskRegister:"سجل المخاطر",newRisk:"إضافة خطر",assessments:"التقييمات",newAssessment:"تقييم جديد",treatmentPlans:"خطط المعالجة",followUp:"المتابعة",analysisDashboard:"لوحة التحليل",riskMatrix:"مصفوفة المخاطر",bcpDashboard:"لوحة BCP",bcpPlans:"خطط الاستمرارية",criticalServices:"الخدمات الحرجة",bcpPlan:"خطة استمرارية الأعمال",drPlan:"التعافي من الكوارث",bcpTests:"اختبارات BCP",reports:"التقارير",reportsHome:"صفحة التقارير",reportsExecutive:"تقرير تنفيذي",reportsStandard:"تقرير قياسي",reportsCustom:"تقرير مخصص",users:"المستخدمون",roleManagement:"إدارة الأدوار",permissions:"الصلاحيات",systemSettings:"إعدادات النظام",auditLog:"سجل التدقيق",riskDetails:"تفاصيل الخطر",treatmentPlan:"خطة المعالجة",appName:"نظام إدارة المخاطر"},risksDashboard:{title:"لوحة المخاطر",subtitle:"عرض مركز لحالة المخاطر والأولويات والمتابعة.",criticalHigh:"حرج/عالي",inProgress:"مفتوح/مراقبة",closed:"مغلق",overdue:"متأخر عن التقييم",dueSoon:"قريب الاستحقاق",overdueCardTitle:"تحتاج متابعة",overdueCardDesc:"يوجد {count} مخاطر متأخرة عن إعادة التقييم (كل {days} يوم).",viewFollowUp:"فتح المتابعة",topRisksTitle:"أهم المخاطر ذات الأولوية",topRisksDesc:"المخاطر الأعلى شدة التي تحتاج اهتمام.",noTopRisks:"لا توجد مخاطر عالية الأولوية.",openRegister:"فتح سجل المخاطر",total:"الإجمالي"},analysis:{dashboardTitle:"لوحة التحليل",dashboardSubtitle:"نظرة عامة على المخاطر وتوزيعها وتغطية التقييمات.",openMatrix:"فتح المصفوفة",totalRisks:"إجمالي المخاطر",updatedFromRegister:"من سجل المخاطر",highPriority:"أولوية عالية",needsFollowUp:"تحتاج متابعة",totalAssessments:"التقييمات",assessmentsStoredLocally:"محفوظة محليًا (تجريبي)",avgScore:"متوسط الدرجة",risksByLevel:"توزيع المخاطر حسب المستوى",risksByLevelDesc:"عدد المخاطر في كل مستوى.",risksByCategory:"توزيع المخاطر حسب التصنيف",risksByCategoryDesc:"عدد المخاطر في كل تصنيف.",topCriticalRisks:"أهم المخاطر الحرجة/العالية",topCriticalRisksDesc:"أعلى الدرجات التي تحتاج اهتمام.",noCriticalRisks:"لا توجد مخاطر عالية الأولوية.",leastAssessed:"الأقل تقييمًا",leastAssessedDesc:"مخاطر لديها أقل عدد من التقييمات.",noRisks:"لا توجد مخاطر.",assessmentsCountLabel:"عدد التقييمات",addAssessment:"إضافة تقييم",matrixTitle:"مصفوفة المخاطر",matrixSubtitle:"التوزيع حسب الاحتمالية والأثر (اضغط على خلية لفتح خطر).",matrixCardTitle:"مصفوفة المخاطر",matrixCardDesc:"عدد المخاطر داخل كل خلية (الاحتمالية × الأثر).",likelihoodAxis:"الاحتمالية",impactAxis:"الأثر",riskLabel:"خطر",risksLabel:"مخاطر",legendCritical:"حرج",legendHigh:"عالي",legendMedium:"متوسط",legendLow:"منخفض",otherLevel:"أخرى",matrixHint:"يتم حساب المستوى من الدرجة (الاحتمالية × الأثر) حسب عتبات النظام."},followup:{title:"المتابعة",subtitle:"تذكيرات إعادة التقييم حسب آخر تقييم (كل {days} يوم).",overdue:"متأخر",dueSoon:"قريب الاستحقاق (≤ 14 يوم)",totalTracked:"المخاطر المتابعة",listTitle:"جدول إعادة التقييم",listDesc:"استخدم هذه القائمة لتحديد الأولويات.",noRisks:"لا توجد مخاطر.",lastAssessment:"آخر تقييم",due:"الاستحقاق",overdueBy:"متأخر {days} يوم",dueIn:"يستحق بعد {days} يوم",score:"الدرجة",assessNow:"قيّم الآن",viewRisk:"عرض"},users:{title:"المستخدمون",subtitle:"إدارة المستخدمين (محفوظة محليًا حتى الربط مع الخلفية).",addUser:"إضافة مستخدم",editUser:"تعديل مستخدم",dialogDesc:"إنشاء أو تحديث بيانات المستخدم والدور.",listTitle:"دليل المستخدمين",listDesc:"البيانات التجريبية محفوظة في هذا المتصفح.",noUsers:"لا يوجد مستخدمون.",name:"الاسم",email:"البريد الإلكتروني",role:"الدور",namePlaceholder:"أدخل الاسم",emailPlaceholder:"name@example.com",missingFields:"الاسم والبريد مطلوبان.",createdTitle:"تم إنشاء المستخدم",createdDesc:"تمت إضافة المستخدم بنجاح.",updatedTitle:"تم تحديث المستخدم",updatedDesc:"تم حفظ التغييرات.",deletedTitle:"تم حذف المستخدم",deletedDesc:"تمت إزالة المستخدم.",saveFailedTitle:"فشل الحفظ",deleteFailedTitle:"فشل الحذف"},bcpDashboard:{title:"لوحة BCP",subtitle:"ملخص تشغيلي لاستمرارية الأعمال والاختبارات.",overviewTitle:"نظرة شاملة على جاهزية الاستمرارية والاستعادة",manageServices:"الخدمات",services:"الخدمات",vitalServices:"الخدمات الحيوية",critical:"حرج/عالي",criticalServices:"خدمات حرجة",avgRto:"متوسط RTO",readyPlans:"خطط جاهزة",hoursShort:"س",bcpStatus:"حالة BCP",drTargets:"أهداف DR",tests:"الاختبارات",openTests:"فتح الاختبارات",lastUpdated:"آخر تحديث",quickLinks:"روابط سريعة",quickLinksDesc:"انتقل لأكثر وحدات الاستمرارية استخدامًا.",editBcpPlan:"تعديل خطة BCP",editDrPlan:"تعديل خطة DR",editServices:"إدارة الخدمات",manageTests:"إدارة الاختبارات",coverage:"التغطية",coverageDesc:"إحصاءات تغطية أساسية.",sections:"الأقسام",sites:"المواقع",distributionTitle:"توزيع الخدمات حسب الأهمية",distributionSubtitle:"نسبة الخدمات في كل مستوى حرج.",mediumLow:"متوسط/منخفض",countOfTotal:"{count} من {total}",upcomingTestsTitle:"اختبارات مجدولة قريبًا",upcomingTestsDesc:"يوجد {count} اختبارات لخطط الاستمرارية مجدولة خلال الشهر القادم"},bcpTests:{title:"اختبارات BCP",subtitle:"تتبع اختبارات BCP/DR ونتائجها.",addTest:"إضافة اختبار",scheduleTest:"جدولة اختبار",successRate:"معدل النجاح",scheduledTests:"اختبارات مجدولة",executedTests:"اختبارات منفذة",listTitle:"سجل الاختبارات",listDesc:"الاختبارات المخططة والمنفذة (محفوظة محليًا).",noTests:"لا توجد اختبارات.",dialogDesc:"سجل اختبارًا مخططًا أو نتيجة اختبار منفذ.",name:"الاسم",plan:"الخطة",recordId:"المعرّف",type:"النوع",date:"التاريخ",status:"الحالة",notes:"ملاحظات",result:"النتيجة",duration:"المدة",minutesShort:"دقيقة",durationMinutesLabel:"المدة (بالدقائق)",durationMinutesPlaceholder:"مثال: 90",namePlaceholder:"مثال: اختبار DR السنوي",notesPlaceholder:"ملاحظات اختيارية…",missingFieldsTitle:"حقول ناقصة",missingFieldsDesc:"اسم الاختبار مطلوب.",createdTitle:"تمت إضافة الاختبار",createdDesc:"تم حفظ الاختبار.",deletedTitle:"تم حذف الاختبار",deletedDesc:"تمت إزالة الاختبار.",saveFailedTitle:"فشل الحفظ",deleteFailedTitle:"فشل الحذف",statusPlanned:"مخطط",statusPassed:"ناجح",statusFailed:"فشل",statusCompleted:"مكتمل",resultSuccess:"ناجح",resultFailed:"فشل",typeBCP:"BCP",typeDR:"DR",markPassed:"وضع كناجح",markFailed:"وضع كفشل",emptyNotes:"—"},bcpPlans:{title:"خطط استمرارية الأعمال",subtitle:"خطط الاستمرارية والتعافي من الكوارث.",addPlan:"إضافة خطة",viewDetails:"عرض التفاصيل",lastUpdated:"آخر تحديث",mainProcedures:"الإجراءات الرئيسية:",sectionsCount:"الأقسام",recoveryTargets:"أهداف التعافي",lastTest:"آخر اختبار",nextTest:"الاختبار القادم",bcpCardTitle:"خطة استمرارية الأعمال",bcpCardDesc:"خطة لضمان استمرارية الخدمات الأساسية أثناء الحوادث.",drCardTitle:"خطة التعافي من الكوارث",drCardDesc:"إجراءات لاستعادة الأنظمة والبنية التحتية الحرجة."},common:{language:"اللغة",loading:"جارٍ التحميل…",notAllowed:"غير مسموح",pleaseTryAgain:"حاول مرة أخرى.",search:"بحث…"},header:{notifications:"الإشعارات",criticalRiskAlert:"تنبيه خطر حرج",criticalRiskAlertDesc:"تجاوزت درجة مخاطر الأمن السيبراني الحد",kriWarning:"تحذير KRI",kriWarningDesc:"نتائج التدقيق تجاوزت الهدف",assessmentDue:"استحقاق تقييم",assessmentDueDesc:"RISK-002 يتطلب إعادة تقييم",timeAgo2Hours:"منذ ساعتين",timeAgo5Hours:"منذ 5 ساعات",timeAgo1Day:"منذ يوم"},actions:{newRisk:"إضافة خطر",viewAll:"عرض الكل",save:"حفظ",add:"إضافة",edit:"تعديل",back:"رجوع",reset:"إعادة ضبط",export:"تصدير",import:"استيراد",clear:"مسح",signIn:"تسجيل الدخول",signOut:"تسجيل الخروج",createAccount:"إنشاء حساب",signingIn:"جارٍ تسجيل الدخول…",creating:"جارٍ الإنشاء…",cancel:"إلغاء",delete:"حذف"},index:{title:"إدارة المخاطر",subtitle:"اختر وحدة من الشريط الجانبي للبدء."},footer:{copyright:"© 2025 نظام إدارة المخاطر واستمرارية الأعمال",version:"الإصدار 1.0.0",lastUpdated:"آخر تحديث: 27 ديسمبر 2025"},roles:{title:"إدارة الأدوار",subtitle:"الأدوار ثابتة؛ يمكن تعديل الصلاحيات من صفحة الصلاحيات.",enabled:"مفعّلة",noCapabilities:"لا توجد صلاحيات مفعّلة.",enabledListPrefix:"المفعّل:"},permissions:{title:"الصلاحيات",subtitle:"تعديل صلاحيات الأدوار (محفوظة محليًا حتى الربط مع الخلفية).",saved:"تم حفظ الصلاحيات",resetDone:"تمت إعادة ضبط الصلاحيات للوضع الافتراضي",noAccess:"لا تملك صلاحية عرض أو تعديل الصلاحيات.",create:"إنشاء",edit:"تعديل",delete:"حذف",viewTreatments:"عرض خطط المعالجة",viewReports:"عرض التقارير",viewAnalysis:"عرض التحليل",viewBCP:"عرض استمرارية الأعمال/التعافي",viewFollowUp:"عرض المتابعة",export:"تصدير",viewSettings:"عرض الإعدادات",viewAudit:"عرض التدقيق",manageUsers:"إدارة المستخدمين",noAccessSystemSettings:"لا تملك صلاحية الوصول لإعدادات النظام."},audit:{title:"سجل التدقيق",time:"الوقت",actor:"المنفّذ",action:"الإجراء",details:"التفاصيل"},bcp:{servicesTitle:"الخدمات الحرجة",servicesSubtitle:"إدارة حرَجية الخدمة والاعتماديات والأهداف.",searchPlaceholder:"بحث في الخدمات…",noServicesFound:"لا توجد خدمات.",ownerPrefix:"المالك:",depsPrefix:"الاعتماديات:",serviceUpdated:"تم تحديث الخدمة",serviceCreated:"تم إنشاء الخدمة",serviceDeleted:"تم حذف الخدمة",editService:"تعديل خدمة",addService:"إضافة خدمة",dialogDesc:"حدد الأهداف والاعتماديات التشغيلية.",serviceName:"اسم الخدمة",enterServiceName:"أدخل اسم الخدمة",criticality:"درجة الحرَجية",owner:"المالك",enterOwner:"أدخل اسم المالك",dependenciesLabel:"الاعتماديات (مفصولة بفواصل)",dependenciesPlaceholder:"قاعدة البيانات، خدمة الدخول، CDN",deleteServiceTitle:"حذف الخدمة؟",deleteServiceDesc:"لا يمكن التراجع عن هذا الإجراء.",failedToLoadServices:"فشل تحميل الخدمات",missingFieldsTitle:"حقول ناقصة",missingFieldsDesc:"اسم الخدمة والمالك وRTO وRPO مطلوبة.",noPermissionEdit:"لا تملك صلاحية التعديل.",noPermissionCreate:"لا تملك صلاحية الإنشاء.",noPermissionDelete:"لا تملك صلاحية الحذف.",saveFailedTitle:"فشل الحفظ",deleteFailedTitle:"فشل الحذف",viewDetails:"عرض التفاصيل",serviceDetailsTitle:"تفاصيل الخدمة",serviceCardHint:"إدارة أهداف التعافي والاعتماديات التشغيلية",depsCount:"{count} تبعيات",planTitle:"خطة استمرارية الأعمال",planSubtitle:"تعديل بيانات الخطة والأقسام.",failedToLoadPlan:"فشل تحميل خطة استمرارية الأعمال",planSaved:"تم حفظ خطة استمرارية الأعمال",noPlanData:"لا توجد بيانات خطة متاحة.",planDetails:"تفاصيل الخطة",status:"الحالة",lastUpdated:"آخر تحديث",sections:"الأقسام",addSection:"إضافة قسم",noSectionsYet:"لا توجد أقسام بعد.",section:"قسم",newSection:"قسم جديد",remove:"إزالة",drTitle:"التعافي من الكوارث",drSubtitle:"إدارة أهداف التعافي والمواقع.",failedToLoadDrPlan:"فشل تحميل خطة التعافي",drPlanSaved:"تم حفظ خطة التعافي",rtoTarget:"الهدف RTO",rpoTarget:"الهدف RPO",rtoPlaceholder:"مثال: 4 ساعات",rpoPlaceholder:"مثال: ساعة واحدة",recoverySites:"مواقع التعافي",addSite:"إضافة موقع",newSite:"موقع جديد",noSites:"لا توجد مواقع مُعدّة.",addTarget:"إضافة هدف",newTarget:"هدف جديد",lastTest:"آخر اختبار",statusReady:"جاهز",targetDetailsTitle:"تفاصيل الهدف",targetDetailsSubtitle:"يعرض مع من هذا الهدف مرتبط.",targetName:"اسم الهدف",targetId:"معرّف الهدف",targetStatus:"الحالة",linkedServices:"الخدمات المرتبطة",linkedCount:"{count} مرتبطة",noLinkedServices:"لا توجد خدمات مرتبطة.",recoveryStrategyTitle:"استراتيجية الاستعادة",recoveryStrategySubtitle:"نظرة عامة على خطة التعافي من الكوارث",averageRpo:"متوسط RPO",averageRto:"متوسط RTO",availabilityRate:"معدل الجاهزية",criticalityCritical:"حرجة",criticalityHigh:"عالية",criticalityMedium:"متوسطة",criticalityLow:"منخفضة",statusActive:"نشط",statusDraft:"مسودة",statusInReview:"قيد المراجعة",statusArchived:"مؤرشف"},treatments:{plansTitle:"خطط المعالجة",plansSubtitle:"اختر خطرًا لإدارة خطة معالجته.",noRisksFound:"لا توجد مخاطر.",managePlan:"إدارة خطة المعالجة",planTitle:"خطة المعالجة",viewRisk:"عرض الخطر",savePlan:"حفظ الخطة",createPlan:"إنشاء خطة",planSettings:"إعدادات الخطة",approach:"النهج",selectApproach:"اختر النهج",progress:"التقدم",completed:"مكتمل",noPlanYet:'لا توجد خطة بعد. اختر نهجًا ثم اضغط "إنشاء خطة".',actionsTitle:"إجراءات المعالجة",addAction:"إضافة إجراء",riskNotFoundTitle:"الخطر غير موجود",riskNotFoundDesc:"الخطر المحدد غير موجود.",failedToLoad:"فشل تحميل خطة المعالجة",noCreatePermission:"لا تملك صلاحية إنشاء خطة معالجة.",noEditPlanPermission:"لا تملك صلاحية تعديل هذه الخطة.",created:"تم إنشاء خطة المعالجة",updated:"تم تحديث خطة المعالجة",saveFailedTitle:"فشل الحفظ",saveFailedDesc:"تعذر حفظ خطة المعالجة. حاول مرة أخرى.",noEditActionsPermission:"لا تملك صلاحية تعديل إجراءات المعالجة.",missingFieldsTitle:"حقول ناقصة",missingFieldsDesc:"العنوان والمالك وتاريخ الاستحقاق مطلوبة.",actionAdded:"تمت إضافة الإجراء",actionUpdated:"تم تحديث الإجراء",actionRemoved:"تمت إزالة الإجراء",deleteFailedTitle:"فشل الحذف",deleteFailedDesc:"تعذر إزالة الإجراء. حاول مرة أخرى.",updateFailedTitle:"فشل التحديث",updateFailedDesc:"تعذر تحديث حالة الإجراء.",approachMitigate:"تخفيف",approachTransfer:"نقل",approachAvoid:"تجنب",approachAccept:"قبول",statusNotStarted:"لم يبدأ",statusInProgress:"قيد التنفيذ",statusDone:"تم",createPlanToStartActions:"أنشئ خطة لبدء إضافة الإجراءات.",noActionsYet:"لا توجد إجراءات بعد. أضف أول إجراء.",ownerPrefix:"المالك:",duePrefix:"الاستحقاق:",evidence:"إثبات",editAction:"تعديل إجراء",addActionDialog:"إضافة إجراء",actionDialogDesc:"تتبع المالكين وتواريخ الاستحقاق وحالة الإكمال.",fieldTitle:"العنوان",fieldOwner:"المالك",fieldDueDate:"تاريخ الاستحقاق",fieldStatus:"الحالة",fieldEvidence:"رابط الإثبات (اختياري)",placeholderActionTitle:"أدخل عنوان الإجراء",placeholderOwner:"أدخل المالك",placeholderEvidence:"https://…",deleteActionTitle:"حذف الإجراء؟",deleteActionDesc:"سيؤدي ذلك إلى إزالة الإجراء من خطة المعالجة."},table:{id:"المعرّف",title:"العنوان",description:"الوصف",category:"التصنيف",count:"العدد",status:"الحالة",owner:"المالك",score:"الدرجة",level:"المستوى",updated:"آخر تحديث",actions:"الإجراءات",likelihoodShort:"اح",impactShort:"أث"},auth:{productTagline:"استمرارية الأعمال والتحكم بالمخاطر",cardTitle:"تسجيل الدخول",cardDescription:"سجّل الدخول أو أنشئ حسابًا (عرض تجريبي للواجهة فقط)",tabQuick:"سريع",tabEmail:"تسجيل الدخول",tabSignup:"إنشاء حساب",quickHint:"اختر دورًا لتسجيل الدخول فورًا (وضع تجريبي)",email:"البريد الإلكتروني",password:"كلمة المرور",anyPassword:"أدخل أي كلمة مرور",demoUsers:"حسابات تجريبية: admin@company.com, analyst@company.com, viewer@company.com",fullName:"الاسم الكامل",yourName:"اسمك",role:"الدور",selectRole:"اختر دورًا",adminDisabled:"تعطّل تسجيل Admin لأن حساب Admin موجود بالفعل.",adminFirstSetup:"إعداد أول مرة: يمكنك إنشاء حساب Admin.",toastWelcomeBackTitle:"مرحبًا بعودتك!",toastWelcomeBackDesc:"تم تسجيل الدخول بنجاح.",toastLoginFailedTitle:"فشل تسجيل الدخول",toastLoginFailedDesc:"البريد الإلكتروني أو كلمة المرور غير صحيحة. جرّب: admin@company.com أو analyst@company.com أو viewer@company.com",toastWelcomeTitle:"مرحبًا!",toastLoggedInAs:"تم تسجيل الدخول كـ",toastSomethingWrong:"حدث خطأ. حاول مرة أخرى.",toastAccountCreatedTitle:"تم إنشاء الحساب",toastAccountCreatedDesc:"تم تسجيل الدخول الآن.",toastSignupFailedTitle:"فشل إنشاء الحساب",toastSignupFailedDesc:"يرجى التأكد من البيانات والمحاولة مرة أخرى.",roleAdminDesc:"صلاحيات كاملة لجميع الميزات بما فيها الإعدادات وسجل التدقيق",roleDataEntryDesc:"يمكنه إنشاء وتعديل المخاطر والتقييمات وخطط المعالجة (مع عرض اللوحات والتقارير)",roleViewerDesc:"صلاحية عرض فقط للمخاطر واللوحات والتقارير وخطط الاستمرارية/التعافي",footerVersion:"نظام إدارة المخاطر واستمرارية الأعمال v1.0"},dashboard:{loading:"جارٍ تحميل لوحة التحكم…",title:"لوحة التحكم",subtitle:"نظرة عامة على المخاطر ومؤشرات الأداء",totalRisks:"إجمالي المخاطر",open:"مفتوح",criticalHighRisks:"مخاطر حرجة/عالية",requiresAttention:"تتطلب انتباهًا",kriStatus:"حالة مؤشرات KRI",avgRiskScore:"متوسط درجة الخطر",fromLastMonth:"عن الشهر الماضي",keyRiskIndicators:"مؤشرات المخاطر الرئيسية",riskTrendOverTime:"اتجاه المخاطر عبر الزمن",risksByCategory:"المخاطر حسب التصنيف",criticalHighTableTitle:"المخاطر الحرجة والعالية الأولوية",riskAlerts:"تنبيهات المخاطر",current:"الحالي",alertCritical:"حرج",alertWarning:"تحذير",target:"الهدف",updated:"آخر تحديث"},risks:{loading:"جارٍ تحميل المخاطر…",riskRegister:"سجل المخاطر",risksTracked:"مخاطر مسجلة",searchPlaceholder:"ابحث في المخاطر حسب العنوان أو الوصف…",filters:"الفلاتر",clear:"مسح",category:"التصنيف",allCategories:"كل التصنيفات",riskLevel:"مستوى الخطر",allLevels:"كل المستويات",status:"الحالة",allStatuses:"كل الحالات",noRisksFound:"لا توجد مخاطر",noRisksMatchFilters:"لا توجد مخاطر تطابق الفلاتر الحالية. جرّب تعديل معايير البحث.",getStartedCreate:"ابدأ بإنشاء أول خطر لديك.",createRisk:"إنشاء خطر",toastRiskDeletedTitle:"تم حذف الخطر",toastRiskDeletedDescSuffix:"تم حذفه.",toastErrorTitle:"خطأ",toastDeleteFailed:"فشل حذف الخطر.",deleteDialogTitle:"حذف خطر",deleteDialogDescriptionPrefix:"هل أنت متأكد أنك تريد حذف",deleteDialogDescriptionSuffix:"لا يمكن التراجع عن هذا الإجراء.",categories:{Operational:"تشغيلي",Financial:"مالي",Strategic:"استراتيجي",Compliance:"امتثال",Technology:"تقني",Reputational:"سمعة",Environmental:"بيئي",Security:"أمني"},statuses:{Open:"مفتوح",Closed:"مغلق",Monitoring:"قيد المراقبة"},levels:{Low:"منخفض",Medium:"متوسط",High:"عالي",Critical:"حرج"},stages:{Context:"السياق",Identification:"التحديد",Analysis:"التحليل",Evaluation:"التقييم",Treatment:"المعالجة",Monitoring:"المراقبة"},form:{loadingRisk:"جارٍ تحميل الخطر…",backToRiskRegister:"العودة إلى سجل المخاطر",editRiskTitle:"تعديل خطر",createRiskTitle:"إنشاء خطر جديد",updateRisk:"تحديث الخطر",createRisk:"إنشاء خطر",saving:"جارٍ الحفظ…",requiredTitle:"العنوان مطلوب",requiredDescription:"الوصف مطلوب",requiredCategory:"التصنيف مطلوب",requiredOwner:"المالك مطلوب",placeholderTitle:"أدخل عنوان الخطر",placeholderDescription:"اشرح الخطر بالتفصيل",placeholderCategory:"اختر التصنيف",placeholderOwner:"مالك الخطر / الجهة المسؤولة",assessmentTitle:"تقييم الخطر",likelihood:"الاحتمالية",impact:"الأثر",rare:"نادر",almostCertain:"شبه مؤكد",insignificant:"غير مهم",catastrophic:"كارثي",scoreTitle:"درجة الخطر",levelTitle:"مستوى الخطر",toastUpdatedTitle:"تم تحديث الخطر",toastUpdatedDesc:"تم تحديث الخطر بنجاح.",toastCreatedTitle:"تم إنشاء الخطر",toastCreatedDescSuffix:"تم إنشاؤه.",toastSaveFailed:"فشل حفظ الخطر.",stageCreatedNote:"تم إنشاء الخطر",stageUpdatedBy:"المستخدم الحالي"},details:{loadingDetails:"جارٍ تحميل تفاصيل الخطر…",notFoundTitle:"الخطر غير موجود",notFoundDesc:"الخطر الذي تبحث عنه غير موجود.",editRisk:"تعديل خطر",newAssessment:"تقييم جديد",lifecycleTitle:"دورة حياة الخطر",overview:"نظرة عامة",assessments:"التقييمات",treatment:"المعالجة",incidents:"الحوادث",auditTrail:"سجل التدقيق",riskAssessment:"تقييم الخطر",likelihoodScale:"الاحتمالية (1-5)",impactScale:"الأثر (1-5)",scoreScale:"الدرجة (الاحتمالية×الأثر)",treatmentProgress:"تقدم المعالجة",approachLabel:"النهج:",completeSuffix:"مكتمل",viewTreatmentPlan:"عرض خطة المعالجة",assessmentHistory:"سجل التقييمات",addAssessment:"إضافة تقييم",noAssessments:"لا توجد تقييمات بعد.",byPrefix:"بواسطة:",likelihoodLabel:"الاحتمالية:",impactLabel:"الأثر:",scoreLabel:"الدرجة:",editAssessmentTitle:"تعديل التقييم",editAssessmentDesc:"تحديث الاحتمالية والأثر وبيانات المقيّم.",assessor:"المقيّم",date:"التاريخ",notes:"ملاحظات",pending:"معلق",deleteAssessmentTitle:"حذف التقييم؟",deleteAssessmentDesc:"لا يمكن التراجع عن هذا الإجراء.",managePlan:"إدارة الخطة",noTreatmentPlan:"لا توجد خطة معالجة بعد.",createTreatmentPlan:"إنشاء خطة معالجة",openEvidence:"فتح رابط الإثبات",noRelatedIncidents:"لا توجد حوادث مرتبطة.",noAuditEntries:"لا توجد سجلات تدقيق."}},assessments:{newTitle:"تقييم جديد",forPrefix:"لـ",selectRiskHint:"اختر خطرًا لإنشاء تقييم.",recentTitle:"آخر التقييمات",viewAll:"عرض الكل",noRecent:"لا توجد تقييمات بعد.",loadingRisks:"جارٍ تحميل المخاطر…",noRisksYet:"لا توجد مخاطر بعد.",createRisk:"إنشاء خطر",riskLabel:"الخطر",selectRiskPlaceholder:"اختر خطرًا",failedToLoadRisksTitle:"فشل تحميل المخاطر",riskNotFoundTitle:"الخطر غير موجود",riskNotFoundDesc:"لا يمكن العثور على الخطر المحدد. يرجى اختيار خطر آخر.",missingRiskIdTitle:"معرّف الخطر مفقود",missingRiskIdDesc:"يرجى اختيار خطر أولاً.",invalidDateTitle:"تاريخ غير صالح",invalidDateDesc:"لا يمكن أن يكون تاريخ التقييم في المستقبل.",assessorRequiredTitle:"المقيّم مطلوب",assessorRequiredDesc:"يرجى إدخال اسم المقيّم.",assessor:"المقيّم",assessorPlaceholder:"أدخل اسم المقيّم",date:"التاريخ",likelihood:"الاحتمالية",impact:"الأثر",rare:"نادر",almostCertain:"شبه مؤكد",insignificant:"غير مهم",catastrophic:"كارثي",notes:"ملاحظات",notesPlaceholder:"ملاحظات اختيارية عن هذا التقييم",createdTitle:"تم إنشاء التقييم",saveAssessment:"حفظ التقييم",failedToCreateTitle:"فشل إنشاء التقييم"},notFound:{message:"الصفحة غير موجودة",backToDashboard:"العودة إلى لوحة التحكم"},reports:{failedToLoadTitle:"فشل تحميل بيانات التقرير",noExportPermission:"لا تملك صلاحية التصدير.",exportReadyTitle:"التصدير جاهز",exportCsvDesc:"تم تنزيل CSV (يفتح في Excel).",exportHtmlDesc:"تم تنزيل تقرير HTML (اطبع إلى PDF).",homeSubtitle:"اختر نوع التقرير ثم قم بالتصدير عند الحاجة.",quickReportsTitle:"تقارير سريعة",registerReport:"تقرير السجل",registerSubtitle:"ملخص + جداول توزيع + تصدير (التقرير الحالي).",reportsHome:"صفحة التقارير",executiveReport:"تقرير تنفيذي",standardReport:"تقرير قياسي",customReport:"تقرير مخصص",executiveTitle:"تقرير تنفيذي",executiveSubtitle:"ملخص عالي المستوى للإدارة وصناع القرار",standardTitle:"تقرير قياسي",standardSubtitle:"تقرير تشغيلي قابل للطباعة مع خيارات التصدير",customTitle:"تقرير مخصص",customSubtitle:"اختر الحقول وأنشئ ملف تصدير للتقرير",print:"طباعة",reportConfigTitle:"إعدادات التقرير",reportConfigDesc:"اختر الصيغة وأنشئ ملف تصدير.",format:"الصيغة",generate:"إنشاء",fieldsTitle:"الحقول",fieldsDesc:"اختر الأعمدة التي تريد ظهورها في التقرير.",previewTitle:"معاينة",previewDesc:"تم اختيار {selected} من أصل {total}",missingFieldsTitle:"لم يتم اختيار حقول",missingFieldsDesc:"اختر حقلًا واحدًا على الأقل لإنشاء التقرير.",exportPermissionHint:"يتطلب إنشاء الملفات صلاحية التصدير.",fieldLikelihood:"الاحتمالية",fieldImpact:"الأثر",fieldCreatedAt:"تاريخ الإنشاء",executiveSummaryTitle:"ملخص تنفيذي",executiveSummaryText:"يوجد {total} خطرًا، منها {critical} مخاطر حرجة. تم إغلاق {closed} مخاطر.",reportTitle:"تقرير المخاطر",period:"الفترة",generated:"تاريخ الإنشاء",totalRisks:"إجمالي المخاطر",criticalRisks:"المخاطر الحرجة",highRisks:"المخاطر العالية",inProgress:"قيد المعالجة",closedRisks:"المخاطر المغلقة",highRisksLabel:"عالي",top5Included:"يتضمن أفضل 5 مخاطر حسب الأولوية",keyRisksTitle:"المخاطر الرئيسية",noPriorityRisks:"لا توجد مخاطر حرجة/عالية.",viewRisk:"عرض",recommendationsTitle:"توصيات",reco1:"أولوية عاجلة للمخاطر الحرجة مع إجراءات معالجة ومالكين واضحين.",reco2:"مراجعة المخاطر العالية أسبوعيًا وتتبع تقدم المعالجة.",reco3:"إغلاق المخاطر بعد التحقق من الضوابط وتوثيق الأدلة.",reco4:"استخدام مصفوفة المخاطر للتحقق من اتساق التقييمات.",quickLinksTitle:"روابط سريعة",summaryTitle:"ملخص",detailedTableTitle:"تفاصيل",byCategory:"حسب التصنيف",byStatus:"حسب الحالة",noData:"لا توجد بيانات.",registerTitle:"سجل المخاطر",noRisksAvailable:"لا توجد مخاطر متاحة.",showingTop10:"أفضل 10 حسب الدرجة",showingAll:"كل المخاطر (مرتبة حسب الدرجة)",noteHtml:"ملاحظة: هذا الملف HTML (قابل للطباعة). استخدم طباعة المتصفح ← حفظ كـ PDF.",top10:"أفضل 10",all:"الكل",exportCsv:"تصدير CSV",exportHtml:"تصدير HTML (طباعة)"},system:{title:"إعدادات النظام",subtitle:"ضبط عتبات المخاطر وسلوك النظام.",noSettings:"لا توجد إعدادات متاحة.",saved:"تم حفظ الإعدادات",saveFailedTitle:"فشل الحفظ",failedToLoadTitle:"فشل تحميل الإعدادات",invalidThresholdsTitle:"عتبات غير صالحة",invalidThresholdsDesc:"يجب أن تكون العتبات أرقامًا موجبة.",invalidOrderTitle:"ترتيب غير صالح",invalidOrderDesc:"يجب أن تحقق العتبات: منخفض < متوسط < عالي.",invalidReminderTitle:"تذكير غير صالح",invalidReminderDesc:"أيام التذكير يجب أن تكون 0 أو أكثر.",thresholdsTitle:"عتبات مصفوفة المخاطر",thresholdsHelp:"يتم حساب المستويات بالدرجة (الاحتمالية × الأثر). الدرجات أعلى من “عالي” تصبح “حرجة”.",lowMax:"الحد الأعلى (منخفض)",mediumMax:"الحد الأعلى (متوسط)",highMax:"الحد الأعلى (عالي)",notificationsTitle:"الإشعارات",enableNotifications:"تفعيل الإشعارات",notificationsHelp:"يتحكم في التذكيرات والتنبيهات داخل النظام.",reminderDays:"تذكير التقييم التلقائي (بالأيام)",demoDataTitle:"بيانات تجريبية",demoDataHelp:"صدّر أو استورد بيانات الواجهة فقط (محفوظة في هذا المتصفح). مسح البيانات سيزيل كل السجلات التجريبية.",exportedTitle:"تم التصدير",exportedDesc:"تم تنزيل ملف JSON للتصدير.",importedTitle:"تم الاستيراد",importedDesc:"تم استيراد البيانات. جارٍ إعادة التحميل…",importFailedTitle:"فشل الاستيراد",couldNotRead:"تعذرت قراءة الملف.",invalidFile:"ملف غير صالح.",clearedTitle:"تم المسح",clearedDesc:"تم مسح كل البيانات التجريبية. جارٍ إعادة التحميل…",noAccessDesc:"لا تملك صلاحية الوصول لإعدادات النظام.",exportJson:"تصدير JSON",importJson:"استيراد JSON",clearAllData:"مسح كل البيانات",clearDialogTitle:"مسح كل البيانات التجريبية؟",clearDialogDescription:"سيؤدي هذا إلى إزالة كل المخاطر والتقييمات وخطط المعالجة وخطط BCP/DR والإعدادات المحفوظة في هذا المتصفح."}},Dr="riskms_lang_v1",Cr=O.createContext(void 0),Kn=s=>s==="en"||s==="ar",zn=()=>{const s=localStorage.getItem(Dr);return Kn(s)?s:(navigator.language||"").toLowerCase().startsWith("ar")?"ar":"en"},Yn=({children:s})=>{const[t,a]=O.useState(()=>zn()),r=t==="ar"?qn:Hn,i=t==="ar",d=O.useCallback(h=>{a(h)},[]);O.useEffect(()=>{localStorage.setItem(Dr,t),document.documentElement.lang=t,document.documentElement.dir=i?"rtl":"ltr"},[i,t]);const l=O.useMemo(()=>({language:t,setLanguage:d,strings:r,isRTL:i}),[i,t,d,r]);return e.jsx(Cr.Provider,{value:l,children:s})},ie=()=>{const s=O.useContext(Cr);if(!s)throw new Error("useI18n must be used within an I18nProvider");return s},me=({children:s,allowedRoles:t,requirePermission:a})=>{const{isAuthenticated:r,isLoading:i,user:d,can:l}=Ne(),h=st(),{strings:g}=ie();return i?e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-background",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx(ke,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("p",{className:"text-muted-foreground",children:g.common.loading})]})}):r?t&&d&&!t.includes(d.role)?e.jsx(ys,{to:"/dashboard",replace:!0}):a&&!l(a)?e.jsx(ys,{to:"/dashboard",replace:!0}):e.jsx(e.Fragment,{children:s}):e.jsx(ys,{to:"/login",state:{from:h},replace:!0})},Pt=Ls("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),y=o.forwardRef(({className:s,variant:t,size:a,asChild:r=!1,...i},d)=>{const l=r?Kr:"button";return e.jsx(l,{className:n(Pt({variant:t,size:a,className:s})),ref:d,...i})});y.displayName="Button";const G=o.forwardRef(({className:s,type:t,...a},r)=>e.jsx("input",{type:t,className:n("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:r,...a}));G.displayName="Input";const Wn=Ls("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),V=o.forwardRef(({className:s,...t},a)=>e.jsx(ua,{ref:a,className:n(Wn(),s),...t}));V.displayName=ua.displayName;const R=o.forwardRef(({className:s,...t},a)=>e.jsx("div",{ref:a,className:n("rounded-lg border bg-card text-card-foreground shadow-sm",s),...t}));R.displayName="Card";const K=o.forwardRef(({className:s,...t},a)=>e.jsx("div",{ref:a,className:n("flex flex-col space-y-1.5 p-6",s),...t}));K.displayName="CardHeader";const Y=o.forwardRef(({className:s,...t},a)=>e.jsx("h3",{ref:a,className:n("text-2xl font-semibold leading-none tracking-tight",s),...t}));Y.displayName="CardTitle";const ye=o.forwardRef(({className:s,...t},a)=>e.jsx("p",{ref:a,className:n("text-sm text-muted-foreground",s),...t}));ye.displayName="CardDescription";const P=o.forwardRef(({className:s,...t},a)=>e.jsx("div",{ref:a,className:n("p-6 pt-0",s),...t}));P.displayName="CardContent";const Jn=o.forwardRef(({className:s,...t},a)=>e.jsx("div",{ref:a,className:n("flex items-center p-6 pt-0",s),...t}));Jn.displayName="CardFooter";const Rr=zr,It=o.forwardRef(({className:s,...t},a)=>e.jsx(xa,{ref:a,className:n("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...t}));It.displayName=xa.displayName;const Je=o.forwardRef(({className:s,...t},a)=>e.jsx(ha,{ref:a,className:n("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",s),...t}));Je.displayName=ha.displayName;const Ge=o.forwardRef(({className:s,...t},a)=>e.jsx(pa,{ref:a,className:n("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...t}));Ge.displayName=pa.displayName;const Re=Xr,Ae=Zr,Se=o.forwardRef(({className:s,children:t,...a},r)=>e.jsxs(ga,{ref:r,className:n("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...a,children:[t,e.jsx(Yr,{asChild:!0,children:e.jsx(tt,{className:"h-4 w-4 opacity-50"})})]}));Se.displayName=ga.displayName;const Ar=o.forwardRef(({className:s,...t},a)=>e.jsx(fa,{ref:a,className:n("flex cursor-default items-center justify-center py-1",s),...t,children:e.jsx(ja,{className:"h-4 w-4"})}));Ar.displayName=fa.displayName;const Pr=o.forwardRef(({className:s,...t},a)=>e.jsx(va,{ref:a,className:n("flex cursor-default items-center justify-center py-1",s),...t,children:e.jsx(tt,{className:"h-4 w-4"})}));Pr.displayName=va.displayName;const Te=o.forwardRef(({className:s,children:t,position:a="popper",...r},i)=>e.jsx(Wr,{children:e.jsxs(ba,{ref:i,className:n("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:a,...r,children:[e.jsx(Ar,{}),e.jsx(Jr,{className:n("p-1",a==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),e.jsx(Pr,{})]})}));Te.displayName=ba.displayName;const Gn=o.forwardRef(({className:s,...t},a)=>e.jsx(ya,{ref:a,className:n("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...t}));Gn.displayName=ya.displayName;const te=o.forwardRef(({className:s,children:t,...a},r)=>e.jsxs(Na,{ref:r,className:n("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",s),...a,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Gr,{children:e.jsx(at,{className:"h-4 w-4"})})}),e.jsx(Qr,{children:t})]}));te.displayName=Na.displayName;const Qn=o.forwardRef(({className:s,...t},a)=>e.jsx(wa,{ref:a,className:n("-mx-1 my-1 h-px bg-muted",s),...t}));Qn.displayName=wa.displayName;const Xn=()=>{const s=gs(),t=st(),{login:a,register:r,loginWithRole:i,isLoading:d}=Ne(),{toast:l}=Pe(),{strings:h}=ie(),g={Admin:{icon:Ze,description:h.auth.roleAdminDesc,color:"text-primary"},"Data Entry":{icon:ei,description:h.auth.roleDataEntryDesc,color:"text-chart-2"},Viewer:{icon:Tt,description:h.auth.roleViewerDesc,color:"text-chart-3"}},[L,f]=o.useState(""),[x,k]=o.useState(""),[T,p]=o.useState(null),[N,m]=o.useState(""),[u,c]=o.useState(""),[j,b]=o.useState(""),[M,z]=o.useState("Viewer"),[S,X]=o.useState(!0);O.useEffect(()=>{let B=!1;return(async()=>{try{const J=await _n();if(B)return;X(J.hasAdmin),J.hasAdmin&&M==="Admin"&&z("Viewer")}catch{B||X(!0)}})(),()=>{B=!0}},[]);const ee=t.state?.from?.pathname||"/dashboard",U=async B=>{B.preventDefault();try{await a(L,x),l({title:h.auth.toastWelcomeBackTitle,description:h.auth.toastWelcomeBackDesc}),s(ee,{replace:!0})}catch{l({title:h.auth.toastLoginFailedTitle,description:h.auth.toastLoginFailedDesc,variant:"destructive"})}},H=async B=>{p(B);try{await i(B),l({title:h.auth.toastWelcomeTitle,description:`${h.auth.toastLoggedInAs} ${B}`}),s(ee,{replace:!0})}catch(J){l({title:h.auth.toastLoginFailedTitle,description:J instanceof Error?J.message:h.auth.toastSomethingWrong,variant:"destructive"})}finally{p(null)}},_=async B=>{B.preventDefault();try{await r(N,u,j,M),l({title:h.auth.toastAccountCreatedTitle,description:h.auth.toastAccountCreatedDesc}),s(ee,{replace:!0})}catch(J){l({title:h.auth.toastSignupFailedTitle,description:J instanceof Error?J.message:h.auth.toastSignupFailedDesc,variant:"destructive"})}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background p-4",children:e.jsxs("div",{className:"w-full max-w-md space-y-8 animate-in",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-2xl bg-primary/10 mb-4",children:e.jsx(Ze,{className:"h-8 w-8 text-primary"})}),e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:h.page.appName}),e.jsx("p",{className:"text-muted-foreground mt-2",children:h.auth.productTagline})]}),e.jsxs(R,{className:"glass-card border-border/50",children:[e.jsxs(K,{className:"pb-4",children:[e.jsx(Y,{className:"text-lg",children:h.auth.cardTitle}),e.jsx(ye,{children:h.auth.cardDescription})]}),e.jsx(P,{children:e.jsxs(Rr,{defaultValue:"quick",className:"w-full",children:[e.jsxs(It,{className:"grid w-full grid-cols-3 mb-6",children:[e.jsx(Je,{value:"quick",children:h.auth.tabQuick}),e.jsx(Je,{value:"email",children:h.auth.tabEmail}),e.jsx(Je,{value:"signup",children:h.auth.tabSignup})]}),e.jsxs(Ge,{value:"quick",className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:h.auth.quickHint}),Object.entries(g).map(([B,J])=>{const oe=J.icon;return e.jsx(y,{variant:"outline",className:"w-full justify-start h-auto p-4 hover:bg-secondary/80 transition-colors",onClick:()=>H(B),disabled:d,children:e.jsxs("div",{className:"flex items-start gap-4 w-full",children:[e.jsx("div",{className:`p-2 rounded-lg bg-secondary ${J.color}`,children:T===B&&d?e.jsx(ke,{className:"h-5 w-5 animate-spin"}):e.jsx(oe,{className:"h-5 w-5"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium",children:B}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:J.description})]})]})},B)})]}),e.jsx(Ge,{value:"email",children:e.jsxs("form",{onSubmit:U,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"email",children:h.auth.email}),e.jsxs("div",{className:"relative",children:[e.jsx($t,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(G,{id:"email",type:"email",placeholder:"admin@company.com",value:L,onChange:B=>f(B.target.value),className:"pl-10",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"password",children:h.auth.password}),e.jsxs("div",{className:"relative",children:[e.jsx(_t,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(G,{id:"password",type:"password",placeholder:h.auth.anyPassword,value:x,onChange:B=>k(B.target.value),className:"pl-10",required:!0})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:h.auth.demoUsers}),e.jsx(y,{type:"submit",className:"w-full",disabled:d,children:d?e.jsxs(e.Fragment,{children:[e.jsx(ke,{className:"mr-2 h-4 w-4 animate-spin"}),h.actions.signingIn]}):h.actions.signIn})]})}),e.jsx(Ge,{value:"signup",children:e.jsxs("form",{onSubmit:_,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"name",children:h.auth.fullName}),e.jsxs("div",{className:"relative",children:[e.jsx(Dt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(G,{id:"name",placeholder:h.auth.yourName,value:N,onChange:B=>m(B.target.value),className:"pl-10",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"signup-email",children:h.auth.email}),e.jsxs("div",{className:"relative",children:[e.jsx($t,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(G,{id:"signup-email",type:"email",placeholder:"name@company.com",value:u,onChange:B=>c(B.target.value),className:"pl-10",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"signup-password",children:h.auth.password}),e.jsxs("div",{className:"relative",children:[e.jsx(_t,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(G,{id:"signup-password",type:"password",placeholder:"Min 4 characters",value:j,onChange:B=>b(B.target.value),className:"pl-10",required:!0,minLength:4})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:h.auth.role}),e.jsxs(Re,{value:M,onValueChange:B=>z(B),children:[e.jsx(Se,{children:e.jsx(Ae,{placeholder:h.auth.selectRole})}),e.jsxs(Te,{children:[!S&&e.jsx(te,{value:"Admin",children:"Admin"}),e.jsx(te,{value:"Data Entry",children:"Data Entry"}),e.jsx(te,{value:"Viewer",children:"Viewer"})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:S?h.auth.adminDisabled:h.auth.adminFirstSetup})]}),e.jsx(y,{type:"submit",className:"w-full",disabled:d,children:d?e.jsxs(e.Fragment,{children:[e.jsx(ke,{className:"mr-2 h-4 w-4 animate-spin"}),h.actions.creating]}):h.actions.createAccount})]})})]})})]}),e.jsx("p",{className:"text-center text-xs text-muted-foreground",children:h.auth.footerVersion})]})})},wt=ti,kt=ai,Zn=o.forwardRef(({className:s,inset:t,children:a,...r},i)=>e.jsxs(ka,{ref:i,className:n("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[state=open]:bg-accent focus:bg-accent",t&&"pl-8",s),...r,children:[a,e.jsx(Sa,{className:"ml-auto h-4 w-4"})]}));Zn.displayName=ka.displayName;const el=o.forwardRef(({className:s,...t},a)=>e.jsx(Ta,{ref:a,className:n("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...t}));el.displayName=Ta.displayName;const Xs=o.forwardRef(({className:s,sideOffset:t=4,...a},r)=>e.jsx(si,{children:e.jsx(Da,{ref:r,sideOffset:t,className:n("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...a})}));Xs.displayName=Da.displayName;const os=o.forwardRef(({className:s,inset:t,...a},r)=>e.jsx(Ca,{ref:r,className:n("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",t&&"pl-8",s),...a}));os.displayName=Ca.displayName;const sl=o.forwardRef(({className:s,children:t,checked:a,...r},i)=>e.jsxs(Ra,{ref:i,className:n("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",s),checked:a,...r,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Aa,{children:e.jsx(at,{className:"h-4 w-4"})})}),t]}));sl.displayName=Ra.displayName;const tl=o.forwardRef(({className:s,children:t,...a},r)=>e.jsxs(Pa,{ref:r,className:n("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",s),...a,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Aa,{children:e.jsx(Ia,{className:"h-2 w-2 fill-current"})})}),t]}));tl.displayName=Pa.displayName;const al=o.forwardRef(({className:s,inset:t,...a},r)=>e.jsx(La,{ref:r,className:n("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",s),...a}));al.displayName=La.displayName;const Ir=o.forwardRef(({className:s,...t},a)=>e.jsx(Ea,{ref:a,className:n("-mx-1 my-1 h-px bg-muted",s),...t}));Ir.displayName=Ea.displayName;const rl=ri,il=ii,nl=ni,Lr=o.forwardRef(({className:s,...t},a)=>e.jsx(Fa,{ref:a,className:n("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",s),...t}));Lr.displayName=Fa.displayName;const ll=o.forwardRef(({className:s,...t},a)=>e.jsx(Oa,{ref:a,className:n("aspect-square h-full w-full",s),...t}));ll.displayName=Oa.displayName;const Er=o.forwardRef(({className:s,...t},a)=>e.jsx(Ma,{ref:a,className:n("flex h-full w-full items-center justify-center rounded-full bg-muted",s),...t}));Er.displayName=Ma.displayName;const Fr=o.forwardRef(({className:s,children:t,...a},r)=>e.jsxs($a,{ref:r,className:n("relative overflow-hidden",s),...a,children:[e.jsx(li,{className:"h-full w-full rounded-[inherit]",children:t}),e.jsx(Or,{}),e.jsx(ci,{})]}));Fr.displayName=$a.displayName;const Or=o.forwardRef(({className:s,orientation:t="vertical",...a},r)=>e.jsx(_a,{ref:r,orientation:t,className:n("flex touch-none select-none transition-colors",t==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",t==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",s),...a,children:e.jsx(oi,{className:"relative flex-1 rounded-full bg-border"})}));Or.displayName=_a.displayName;const cl=[{titleKey:"dashboard",href:"/dashboard",icon:Ba},{titleKey:"risksDashboard",href:"/risks/dashboard",icon:Ua},{titleKey:"risks",href:"/risks",icon:ss},{titleKey:"followUp",href:"/risks/followup",icon:Va,permission:"canViewFollowUp"},{titleKey:"assessments",href:"/assessments/new",icon:Ks,permission:"canCreate"},{titleKey:"treatments",href:"/treatments",icon:Ze,permission:"canViewTreatments"},{titleKey:"analysis",icon:Ha,children:[{titleKey:"analysisDashboard",href:"/analysis/dashboard",permission:"canViewAnalysis"},{titleKey:"riskMatrix",href:"/analysis/matrix",permission:"canViewAnalysis"}]},{titleKey:"bcpdr",icon:bt,children:[{titleKey:"bcpDashboard",href:"/bcp/dashboard",permission:"canViewBCP"},{titleKey:"bcpPlans",href:"/bcp/plans",permission:"canViewBCP"},{titleKey:"criticalServices",href:"/bcp/services",permission:"canViewBCP"},{titleKey:"bcpPlan",href:"/bcp/plan",permission:"canViewBCP"},{titleKey:"drPlan",href:"/bcp/dr",permission:"canViewBCP"},{titleKey:"bcpTests",href:"/bcp/tests",permission:"canViewBCP"}]},{titleKey:"reports",icon:fs,children:[{titleKey:"reportsHome",href:"/reports/home",permission:"canViewReports"},{titleKey:"reportsExecutive",href:"/reports/executive",permission:"canViewReports"},{titleKey:"reportsStandard",href:"/reports/standard",permission:"canViewReports"},{titleKey:"reportsCustom",href:"/reports/custom",permission:"canViewReports"},{titleKey:"reportsRegister",href:"/reports/register",permission:"canViewReports"}]},{titleKey:"settings",icon:di,children:[{titleKey:"users",href:"/settings/users",permission:"canManageUsers"},{titleKey:"roles",href:"/settings/roles",permission:"canViewSettings"},{titleKey:"permissions",href:"/settings/permissions",permission:"canViewSettings"},{titleKey:"system",href:"/settings/system",permission:"canViewSettings"},{titleKey:"backup",href:"/settings/backup",permission:"canViewSettings"}]},{titleKey:"audit",href:"/audit",icon:qa,permission:"canViewAudit"}],ol=({isOpen:s,onClose:t})=>{const a=st(),{user:r,logout:i,can:d}=Ne(),{strings:l,isRTL:h}=ie(),[g,L]=O.useState(["bcpdr","settings"]),f=N=>{L(m=>m.includes(N)?m.filter(u=>u!==N):[...m,N])},x=N=>a.pathname===N||a.pathname.startsWith(N+"/"),k=cl.filter(N=>!(N.permission&&!d(N.permission))),T=N=>{if(!N.children)return N;const m=N.children.filter(u=>u.permission?d(u.permission):!0);return{...N,children:m}},p=k.map(T).filter(N=>!N.children||N.children.length>0);return e.jsxs(e.Fragment,{children:[s&&e.jsx("div",{className:"fixed inset-0 bg-background/80 backdrop-blur-sm z-40 lg:hidden",onClick:t}),e.jsx("aside",{className:n("fixed top-0 z-50 h-full w-64 bg-sidebar border-sidebar-border transform transition-transform duration-300 ease-in-out lg:translate-x-0 lg:static",h?"right-0 border-l":"left-0 border-r",s?"translate-x-0":h?"translate-x-full":"-translate-x-full"),children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center justify-between h-16 px-4 border-b border-sidebar-border",children:[e.jsxs(Q,{to:"/dashboard",className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-primary/20 flex items-center justify-center",children:e.jsx(Ze,{className:"h-5 w-5 text-primary"})}),e.jsx("span",{className:"font-semibold text-sidebar-foreground",children:"RiskMS"})]}),e.jsx(y,{variant:"ghost",size:"icon",className:"lg:hidden text-sidebar-foreground",onClick:t,children:e.jsx(et,{className:"h-5 w-5"})})]}),e.jsx(Fr,{className:"flex-1 py-4",children:e.jsx("nav",{className:"px-2 space-y-1",children:p.map(N=>N.children?e.jsxs(rl,{open:g.includes(N.titleKey),onOpenChange:()=>f(N.titleKey),children:[e.jsx(il,{asChild:!0,children:e.jsxs("button",{className:n("flex items-center justify-between w-full px-3 py-2 rounded-lg text-sm font-medium transition-colors","text-sidebar-foreground/70 hover:text-sidebar-foreground hover:bg-sidebar-accent"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(N.icon,{className:"h-5 w-5"}),e.jsx("span",{children:l.nav[N.titleKey]})]}),e.jsx(tt,{className:n("h-4 w-4 transition-transform",g.includes(N.titleKey)&&"rotate-180")})]})}),e.jsx(nl,{className:"pl-10 space-y-1 mt-1",children:N.children.map(m=>e.jsx(Q,{to:m.href,onClick:t,className:n("block px-3 py-2 rounded-lg text-sm transition-colors",x(m.href)?"bg-sidebar-primary text-sidebar-primary-foreground":"text-sidebar-foreground/70 hover:text-sidebar-foreground hover:bg-sidebar-accent"),children:l.nav[m.titleKey]},m.href))})]},N.titleKey):e.jsxs(Q,{to:N.href,onClick:t,className:n("flex items-center gap-3 px-3 py-2 rounded-lg text-sm font-medium transition-colors",x(N.href)?"bg-sidebar-primary text-sidebar-primary-foreground":"text-sidebar-foreground/70 hover:text-sidebar-foreground hover:bg-sidebar-accent"),children:[e.jsx(N.icon,{className:"h-5 w-5"}),e.jsx("span",{children:l.nav[N.titleKey]})]},N.titleKey))})}),e.jsx("div",{className:"p-4 border-t border-sidebar-border",children:e.jsxs(wt,{children:[e.jsx(kt,{asChild:!0,children:e.jsxs("button",{className:"flex items-center gap-3 w-full p-2 rounded-lg hover:bg-sidebar-accent transition-colors",children:[e.jsx(Lr,{className:"h-8 w-8",children:e.jsx(Er,{className:"bg-primary/20 text-primary text-sm",children:r?.name?.split(" ").map(N=>N[0]).join("")})}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("p",{className:"text-sm font-medium text-sidebar-foreground",children:r?.name}),e.jsx("p",{className:"text-xs text-sidebar-foreground/60",children:r?.role})]})]})}),e.jsxs(Xs,{align:"end",className:"w-56",children:[e.jsx(os,{className:"text-muted-foreground",children:e.jsx("span",{className:"truncate",children:r?.email})}),e.jsx(Ir,{}),e.jsxs(os,{onClick:i,className:"text-destructive focus:text-destructive",children:[e.jsx(mi,{className:"mr-2 h-4 w-4"}),l.actions.signOut]})]})]})})]})})]})},dl=Ls("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function pe({className:s,variant:t,...a}){return e.jsx("div",{className:n(dl({variant:t}),s),...a})}const jt={"/dashboard":s=>s.page.dashboard,"/risks/dashboard":s=>s.page.risksDashboard,"/risks":s=>s.page.riskRegister,"/risks/new":s=>s.page.newRisk,"/risks/followup":s=>s.page.followUp,"/analysis/dashboard":s=>s.page.analysisDashboard,"/analysis/matrix":s=>s.page.riskMatrix,"/assessments":s=>s.page.assessments,"/assessments/new":s=>s.page.newAssessment,"/treatments":s=>s.page.treatmentPlans,"/bcp/dashboard":s=>s.page.bcpDashboard,"/bcp/plans":s=>s.page.bcpPlans,"/bcp/services":s=>s.page.criticalServices,"/bcp/plan":s=>s.page.bcpPlan,"/bcp/dr":s=>s.page.drPlan,"/bcp/tests":s=>s.page.bcpTests,"/reports":s=>s.page.reports,"/reports/home":s=>s.page.reportsHome,"/reports/register":s=>s.page.reports,"/reports/executive":s=>s.page.reportsExecutive,"/reports/standard":s=>s.page.reportsStandard,"/reports/custom":s=>s.page.reportsCustom,"/settings/roles":s=>s.page.roleManagement,"/settings/permissions":s=>s.page.permissions,"/settings/system":s=>s.page.systemSettings,"/settings/users":s=>s.page.users,"/audit":s=>s.page.auditLog},ml=({onMenuClick:s})=>{const t=st(),{user:a}=Ne(),{strings:r,language:i,setLanguage:d,isRTL:l}=ie(),h=()=>jt[t.pathname]?jt[t.pathname](r):t.pathname.startsWith("/risks/")&&t.pathname!=="/risks/new"?r.page.riskDetails:t.pathname.startsWith("/treatments/")?r.page.treatmentPlan:r.page.appName,g=()=>{const L=t.pathname.split("/").filter(Boolean),f=[];let x="";for(const k of L){x+=`/${k}`;const T=jt[x]?.(r)||k.charAt(0).toUpperCase()+k.slice(1);f.push({title:T,path:x})}return f};return e.jsxs("header",{className:"sticky top-0 z-30 h-16 bg-background/80 backdrop-blur-lg border-b border-border flex items-center px-4 lg:px-6 gap-4",children:[e.jsx(y,{variant:"ghost",size:"icon",className:"lg:hidden shrink-0",onClick:s,children:e.jsx(ui,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:l?"hidden md:flex items-center gap-1 text-sm text-muted-foreground flex-row-reverse text-right":"hidden md:flex items-center gap-1 text-sm text-muted-foreground",children:g().map((L,f,x)=>e.jsxs(O.Fragment,{children:[e.jsx("span",{className:f===x.length-1?"text-foreground font-medium":"",children:L.title}),f<x.length-1&&e.jsx(Sa,{className:l?"h-4 w-4 rotate-180":"h-4 w-4"})]},L.path))}),e.jsx("h1",{className:"md:hidden text-lg font-semibold truncate",children:h()})]}),e.jsxs("div",{className:"hidden md:flex relative max-w-xs",children:[e.jsx(Ka,{className:l?"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground":"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(G,{placeholder:r.common.search,className:l?"pr-9 w-48 lg:w-64 bg-secondary/50 border-border/50":"pl-9 w-48 lg:w-64 bg-secondary/50 border-border/50"})]}),e.jsxs(wt,{children:[e.jsx(kt,{asChild:!0,children:e.jsxs(y,{variant:"ghost",size:"sm",className:"shrink-0",children:[r.common.language,": ",i==="ar"?r.lang.arabic:r.lang.english]})}),e.jsxs(Xs,{align:"end",children:[e.jsx(os,{onClick:()=>d("en"),children:r.lang.english}),e.jsx(os,{onClick:()=>d("ar"),children:r.lang.arabic})]})]}),e.jsxs(wt,{children:[e.jsx(kt,{asChild:!0,children:e.jsxs(y,{variant:"ghost",size:"icon",className:"relative",children:[e.jsx(xi,{className:"h-5 w-5"}),e.jsx(pe,{variant:"destructive",className:"absolute -top-1 -right-1 h-5 w-5 rounded-full p-0 flex items-center justify-center text-xs",children:"3"})]})}),e.jsxs(Xs,{align:"end",className:"w-80",children:[e.jsx("div",{className:"p-3 border-b border-border",children:e.jsx("p",{className:"font-medium",children:r.header.notifications})}),e.jsx(os,{className:"p-3 cursor-pointer",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-destructive",children:r.header.criticalRiskAlert}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:r.header.criticalRiskAlertDesc}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:r.header.timeAgo2Hours})]})}),e.jsx(os,{className:"p-3 cursor-pointer",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-status-warning",children:r.header.kriWarning}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:r.header.kriWarningDesc}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:r.header.timeAgo5Hours})]})}),e.jsx(os,{className:"p-3 cursor-pointer",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:r.header.assessmentDue}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:r.header.assessmentDueDesc}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:r.header.timeAgo1Day})]})})]})]}),e.jsx(pe,{variant:"outline",className:"hidden sm:flex",children:a?.role})]})},ul=()=>{const{strings:s}=ie();return e.jsx("footer",{className:"py-4 px-6 border-t border-border bg-background/50",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-2 text-xs text-muted-foreground",children:[e.jsx("p",{children:s.footer.copyright}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{children:s.footer.version}),e.jsx("span",{children:"•"}),e.jsx("span",{children:s.footer.lastUpdated})]})]})})},xl=()=>{const[s,t]=o.useState(!1),{isRTL:a}=ie();return e.jsxs("div",{className:n("flex min-h-screen bg-background",a&&"flex-row-reverse"),children:[e.jsx(ol,{isOpen:s,onClose:()=>t(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col min-w-0",children:[e.jsx(ml,{onMenuClick:()=>t(!0)}),e.jsx("main",{className:"flex-1 p-4 lg:p-6 overflow-auto",children:e.jsx(hi,{})}),e.jsx(ul,{})]})]})},hl={sm:"h-4 w-4",md:"h-6 w-6",lg:"h-8 w-8"},pl=({className:s,size:t="md",text:a})=>e.jsxs("div",{className:n("flex flex-col items-center justify-center gap-2",s),children:[e.jsx(ke,{className:n("animate-spin text-primary",hl[t])}),a&&e.jsx("p",{className:"text-sm text-muted-foreground",children:a})]}),fe=({text:s="Loading..."})=>e.jsx("div",{className:"flex min-h-[400px] items-center justify-center",children:e.jsx(pl,{size:"lg",text:s})}),ce=({status:s,className:t,children:a})=>{const i={green:"kri-green",yellow:"kri-yellow",red:"kri-red",Critical:"status-critical",High:"status-high",Medium:"status-medium",Low:"status-low",Open:"bg-primary/10 text-primary border-primary/30",Closed:"bg-muted text-muted-foreground border-border",Monitoring:"bg-chart-2/10 text-chart-2 border-chart-2/30"}[s]||"bg-muted text-muted-foreground";return e.jsx("span",{className:n("inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border",i,t),children:a||s})},gl=()=>{const{can:s}=Ne(),{strings:t}=ie(),[a,r]=o.useState([]),[i,d]=o.useState([]),[l,h]=o.useState(!0),[g,L]=o.useState(null);if(o.useEffect(()=>{(async()=>{try{const[u,c,j]=await Promise.all([de.getAll(),Bn.getAll(),de.getStats()]);r(u),d(c),L(j)}catch(u){console.error("Failed to load dashboard data",u)}finally{h(!1)}})()},[]),l)return e.jsx(fe,{text:t.dashboard.loading});const f=a.filter(m=>m.level==="Critical"||m.level==="High"),x=a.filter(m=>m.status==="Open"),k={green:i.filter(m=>m.status==="green").length,yellow:i.filter(m=>m.status==="yellow").length,red:i.filter(m=>m.status==="red").length},T=m=>m==="red"?t.dashboard.alertCritical:m==="yellow"?t.dashboard.alertWarning:t.dashboard.current,p=g?.by_category?.map(m=>({category:m.category_name,count:m.count}))||[],N=[{month:"Jan",open:0,monitoring:0,closed:0}];return e.jsxs("div",{className:"space-y-6 animate-in",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:t.dashboard.title}),e.jsx("p",{className:"text-muted-foreground",children:t.dashboard.subtitle})]}),s("canCreate")&&e.jsx(y,{asChild:!0,children:e.jsxs(Q,{to:"/risks/new",children:[e.jsx(ze,{className:"mr-2 h-4 w-4"}),t.actions.newRisk]})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(R,{className:"glass-card",children:e.jsxs(P,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:t.dashboard.totalRisks}),e.jsx("p",{className:"text-3xl font-bold mt-1",children:a.length})]}),e.jsx("div",{className:"w-12 h-12 rounded-xl bg-primary/10 flex items-center justify-center",children:e.jsx(Ze,{className:"h-6 w-6 text-primary"})})]}),e.jsx("div",{className:"flex items-center gap-2 mt-4 text-sm",children:e.jsxs(pe,{variant:"secondary",children:[x.length," ",t.dashboard.open]})})]})}),e.jsx(R,{className:"glass-card border-status-critical/30",children:e.jsxs(P,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:t.dashboard.criticalHighRisks}),e.jsx("p",{className:"text-3xl font-bold mt-1 text-status-critical",children:f.length})]}),e.jsx("div",{className:"w-12 h-12 rounded-xl bg-status-critical/10 flex items-center justify-center",children:e.jsx(ss,{className:"h-6 w-6 text-status-critical"})})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-4 text-sm text-status-critical",children:[e.jsx(za,{className:"h-4 w-4"}),e.jsx("span",{children:t.dashboard.requiresAttention})]})]})}),e.jsx(R,{className:"glass-card",children:e.jsxs(P,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:t.dashboard.kriStatus}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsx("span",{className:"text-status-success font-bold",children:k.green}),e.jsx("span",{className:"text-status-warning font-bold",children:k.yellow}),e.jsx("span",{className:"text-status-danger font-bold",children:k.red})]})]}),e.jsx("div",{className:"w-12 h-12 rounded-xl bg-chart-2/10 flex items-center justify-center",children:e.jsx(pi,{className:"h-6 w-6 text-chart-2"})})]}),e.jsx("div",{className:"flex gap-1 mt-4",children:(()=>{if(k.green+k.yellow+k.red<=0)return e.jsx("div",{className:"h-2 w-full rounded-full bg-muted"});const u=[...Array.from({length:k.green},()=>"green"),...Array.from({length:k.yellow},()=>"yellow"),...Array.from({length:k.red},()=>"red")];return e.jsx("div",{className:"flex w-full gap-1",children:u.map((c,j)=>{const b=j===0,M=j===u.length-1,z=c==="green"?"bg-status-success":c==="yellow"?"bg-status-warning":"bg-status-danger";return e.jsx("div",{className:`h-2 flex-1 ${z} ${b?"rounded-l-full":""} ${M?"rounded-r-full":""}`},`${c}-${j}`)})})})()})]})}),e.jsx(R,{className:"glass-card",children:e.jsxs(P,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:t.dashboard.avgRiskScore}),e.jsx("p",{className:"text-3xl font-bold mt-1",children:a.length>0?(a.reduce((m,u)=>m+u.score,0)/a.length).toFixed(1):"0.0"})]}),e.jsx("div",{className:"w-12 h-12 rounded-xl bg-chart-3/10 flex items-center justify-center",children:e.jsx(Va,{className:"h-6 w-6 text-chart-3"})})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-4 text-sm text-chart-2",children:[e.jsx(gi,{className:"h-4 w-4"}),e.jsxs("span",{children:["-2.3% ",t.dashboard.fromLastMonth]})]})]})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:t.dashboard.keyRiskIndicators}),e.jsx(y,{variant:"ghost",size:"sm",asChild:!0,children:e.jsxs(Q,{to:"/reports/home",children:[t.actions.viewAll," ",e.jsx(Me,{className:"ml-2 h-4 w-4"})]})})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:i.slice(0,4).map(m=>e.jsx(R,{className:`glass-card border kri-${m.status}`,children:e.jsxs(P,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-sm font-medium",children:m.metricName}),e.jsx(ce,{status:m.status,children:T(m.status)})]}),e.jsxs("div",{className:"flex items-end justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:m.value}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[t.dashboard.target,": ",m.targetValue]})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[t.dashboard.updated,":"," ",new Date(m.updatedAt).toLocaleDateString()]})]})]})},m.id))})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(R,{className:"glass-card",children:[e.jsx(K,{children:e.jsx(Y,{className:"text-base",children:t.dashboard.riskTrendOverTime})}),e.jsx(P,{children:e.jsx("div",{className:"h-[300px]",children:e.jsx(zs,{width:"100%",height:"100%",children:e.jsxs(sn,{data:N,children:[e.jsx(Ys,{strokeDasharray:"3 3",stroke:"hsl(var(--border))"}),e.jsx(Ws,{dataKey:"month",stroke:"hsl(var(--muted-foreground))",fontSize:12}),e.jsx(Js,{stroke:"hsl(var(--muted-foreground))",fontSize:12}),e.jsx(Gs,{contentStyle:{backgroundColor:"hsl(var(--card))",border:"1px solid hsl(var(--border))",borderRadius:"8px"}}),e.jsx(mr,{}),e.jsx(Es,{type:"monotone",dataKey:"critical",stroke:"hsl(var(--status-critical))",strokeWidth:2,dot:!1}),e.jsx(Es,{type:"monotone",dataKey:"high",stroke:"hsl(var(--status-high))",strokeWidth:2,dot:!1}),e.jsx(Es,{type:"monotone",dataKey:"medium",stroke:"hsl(var(--status-medium))",strokeWidth:2,dot:!1}),e.jsx(Es,{type:"monotone",dataKey:"low",stroke:"hsl(var(--status-low))",strokeWidth:2,dot:!1})]})})})})]}),e.jsxs(R,{className:"glass-card",children:[e.jsx(K,{children:e.jsx(Y,{className:"text-base",children:t.dashboard.risksByCategory})}),e.jsx(P,{children:e.jsx("div",{className:"h-[300px]",children:e.jsx(zs,{width:"100%",height:"100%",children:e.jsxs(yt,{data:p,layout:"vertical",children:[e.jsx(Ys,{strokeDasharray:"3 3",stroke:"hsl(var(--border))",horizontal:!1}),e.jsx(Ws,{type:"number",stroke:"hsl(var(--muted-foreground))",fontSize:12}),e.jsx(Js,{type:"category",dataKey:"category",stroke:"hsl(var(--muted-foreground))",fontSize:12,width:100}),e.jsx(Gs,{contentStyle:{backgroundColor:"hsl(var(--card))",border:"1px solid hsl(var(--border))",borderRadius:"8px"}}),e.jsx(Nt,{dataKey:"count",radius:[0,4,4,0],children:p.map((m,u)=>e.jsx(ur,{fill:`hsl(var(--chart-${u%5+1}))`},`cell-${u}`))})]})})})})]})]}),e.jsxs(R,{className:"glass-card",children:[e.jsxs(K,{className:"flex flex-row items-center justify-between",children:[e.jsx(Y,{className:"text-base",children:t.dashboard.criticalHighTableTitle}),e.jsx(y,{variant:"ghost",size:"sm",asChild:!0,children:e.jsxs(Q,{to:"/risks",children:[t.actions.viewAll," ",e.jsx(Me,{className:"ml-2 h-4 w-4"})]})})]}),e.jsx(P,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-border",children:[e.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-muted-foreground",children:t.table.id}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-muted-foreground",children:t.table.title}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-muted-foreground",children:t.table.category}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-muted-foreground",children:t.table.score}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-muted-foreground",children:t.table.level}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-muted-foreground",children:t.table.owner}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-muted-foreground",children:t.table.status})]})}),e.jsx("tbody",{children:f.slice(0,5).map(m=>e.jsxs("tr",{className:"border-b border-border/50 hover:bg-muted/30 transition-colors",children:[e.jsx("td",{className:"py-3 px-4",children:e.jsx(Q,{to:`/risks/${m.id}`,className:"text-sm font-mono text-primary hover:underline",children:m.id})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx(Q,{to:`/risks/${m.id}`,className:"text-sm font-medium hover:text-primary transition-colors",children:m.title})}),e.jsx("td",{className:"py-3 px-4 text-sm text-muted-foreground",children:t.risks.categories?.[m.category]??m.category}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:"text-sm font-bold",children:m.score})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx(ce,{status:m.level,children:t.risks.levels?.[m.level]??m.level})}),e.jsx("td",{className:"py-3 px-4 text-sm text-muted-foreground",children:m.owner}),e.jsx("td",{className:"py-3 px-4",children:e.jsx(ce,{status:m.status,children:t.risks.statuses?.[m.status]??m.status})})]},m.id))})]})})})]}),e.jsxs(R,{className:"glass-card border-status-warning/30",children:[e.jsx(K,{children:e.jsxs(Y,{className:"text-base flex items-center gap-2",children:[e.jsx(fi,{className:"h-5 w-5 text-status-warning"}),t.dashboard.riskAlerts]})}),e.jsx(P,{children:e.jsx("div",{className:"space-y-3",children:i.filter(m=>m.status==="red"||m.status==="yellow").slice(0,4).map(m=>e.jsx("div",{className:`p-3 rounded-lg border ${m.status==="red"?"kri-red":"kri-yellow"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:m.metricName}),e.jsxs("p",{className:"text-xs opacity-70",children:[t.dashboard.current,": ",m.value," |"," ",t.dashboard.target,": ",m.targetValue]})]}),e.jsx(ce,{status:m.status,children:m.status==="red"?t.dashboard.alertCritical:t.dashboard.alertWarning})]})},m.id))})})]})]})},Xe=vi,Bs=bi,fl=ji,Mr=o.forwardRef(({className:s,...t},a)=>e.jsx(Ya,{className:n("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...t,ref:a}));Mr.displayName=Ya.displayName;const _e=o.forwardRef(({className:s,...t},a)=>e.jsxs(fl,{children:[e.jsx(Mr,{}),e.jsx(Wa,{ref:a,className:n("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...t})]}));_e.displayName=Wa.displayName;const Be=({className:s,...t})=>e.jsx("div",{className:n("flex flex-col space-y-2 text-center sm:text-left",s),...t});Be.displayName="AlertDialogHeader";const Ue=({className:s,...t})=>e.jsx("div",{className:n("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...t});Ue.displayName="AlertDialogFooter";const Ve=o.forwardRef(({className:s,...t},a)=>e.jsx(Ja,{ref:a,className:n("text-lg font-semibold",s),...t}));Ve.displayName=Ja.displayName;const He=o.forwardRef(({className:s,...t},a)=>e.jsx(Ga,{ref:a,className:n("text-sm text-muted-foreground",s),...t}));He.displayName=Ga.displayName;const qe=o.forwardRef(({className:s,...t},a)=>e.jsx(Qa,{ref:a,className:n(Pt(),s),...t}));qe.displayName=Qa.displayName;const Ke=o.forwardRef(({className:s,...t},a)=>e.jsx(Xa,{ref:a,className:n(Pt({variant:"outline"}),"mt-2 sm:mt-0",s),...t}));Ke.displayName=Xa.displayName;const jl=({icon:s=yi,title:t,description:a,action:r,className:i})=>e.jsxs("div",{className:n("flex flex-col items-center justify-center py-12 px-4 text-center",i),children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-muted flex items-center justify-center mb-4",children:e.jsx(s,{className:"h-8 w-8 text-muted-foreground"})}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:t}),a&&e.jsx("p",{className:"text-sm text-muted-foreground max-w-sm mb-6",children:a}),r&&e.jsx(y,{onClick:r.onClick,children:r.label})]}),vl=()=>{const s=gs(),{can:t}=Ne(),{toast:a}=Pe(),{strings:r,isRTL:i}=ie(),d=v=>r.risks.categories?.[v]??v,l=v=>r.risks.statuses?.[v]??v,h=v=>r.risks.levels?.[v]??v,[g,L]=o.useState([]),[f,x]=o.useState(!0),[k,T]=o.useState([...jr]),[p,N]=o.useState(""),[m,u]=o.useState("all"),[c,j]=o.useState("all"),[b,M]=o.useState("all"),[z,S]=o.useState("updatedAt"),[X,ee]=o.useState("desc"),[U,H]=o.useState(!1),[_,B]=o.useState(null);o.useEffect(()=>{oe(),J()},[]);const J=async()=>{try{const A=(await de.getCategories()).slice().sort((le,je)=>(le.sort_order??0)-(je.sort_order??0)).map(le=>ot(le.code||le.name||"")).filter(le=>typeof le=="string"&&le.trim().length>0),se=Array.from(new Set(A));se.length>0&&T(se)}catch{}},oe=async()=>{x(!0);try{const v=await de.getAll();L(v)}finally{x(!1)}},I=async()=>{if(_)try{await de.delete(_.id),L(v=>v.filter(A=>A.id!==_.id)),a({title:r.risks.toastRiskDeletedTitle,description:`${_.title} ${r.risks.toastRiskDeletedDescSuffix}`})}catch{a({title:r.risks.toastErrorTitle,description:r.risks.toastDeleteFailed,variant:"destructive"})}finally{B(null)}},Z=v=>{z===v?ee(A=>A==="asc"?"desc":"asc"):(S(v),ee("asc"))},ue=g.filter(v=>{const A=!p||v.title.toLowerCase().includes(p.toLowerCase())||v.description.toLowerCase().includes(p.toLowerCase()),se=m==="all"||v.category===m,le=c==="all"||v.level===c,je=b==="all"||v.status===b;return A&&se&&le&&je}).sort((v,A)=>{let se=0;switch(z){case"title":se=v.title.localeCompare(A.title);break;case"score":se=v.score-A.score;break;case"category":se=v.category.localeCompare(A.category);break;case"updatedAt":se=new Date(v.updatedAt).getTime()-new Date(A.updatedAt).getTime();break}return X==="asc"?se:-se}),xe=()=>{N(""),u("all"),j("all"),M("all")},ge=p||m!=="all"||c!=="all"||b!=="all";if(f)return e.jsx(fe,{text:r.risks.loading});const E=({field:v})=>z!==v?null:X==="asc"?e.jsx(ja,{className:"h-4 w-4"}):e.jsx(tt,{className:"h-4 w-4"});return e.jsxs("div",{className:"space-y-6 animate-in",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:r.risks.riskRegister}),e.jsxs("p",{className:"text-muted-foreground",children:[g.length," ",r.risks.risksTracked]})]}),t("canCreate")&&e.jsx(y,{asChild:!0,children:e.jsxs(Q,{to:"/risks/new",children:[e.jsx(ze,{className:i?"ml-2 h-4 w-4":"mr-2 h-4 w-4"}),r.actions.newRisk]})})]}),e.jsx(R,{className:"glass-card",children:e.jsxs(P,{className:"p-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ka,{className:n("absolute top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground",i?"right-3":"left-3")}),e.jsx(G,{placeholder:r.risks.searchPlaceholder,value:p,onChange:v=>N(v.target.value),className:i?"pr-10":"pl-10"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(y,{variant:U?"secondary":"outline",onClick:()=>H(!U),children:[e.jsx(Ni,{className:i?"ml-2 h-4 w-4":"mr-2 h-4 w-4"}),r.risks.filters,ge&&e.jsx("span",{className:"ml-2 w-5 h-5 rounded-full bg-primary text-primary-foreground text-xs flex items-center justify-center",children:"!"})]}),ge&&e.jsxs(y,{variant:"ghost",onClick:xe,children:[e.jsx(et,{className:i?"ml-2 h-4 w-4":"mr-2 h-4 w-4"}),r.risks.clear]})]})]}),U&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 mt-4 pt-4 border-t border-border",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:r.risks.category}),e.jsxs(Re,{value:m,onValueChange:u,children:[e.jsx(Se,{children:e.jsx(Ae,{placeholder:r.risks.allCategories})}),e.jsxs(Te,{children:[e.jsx(te,{value:"all",children:r.risks.allCategories}),k.map(v=>e.jsx(te,{value:v,children:d(v)},v))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:r.risks.riskLevel}),e.jsxs(Re,{value:c,onValueChange:j,children:[e.jsx(Se,{children:e.jsx(Ae,{placeholder:r.risks.allLevels})}),e.jsxs(Te,{children:[e.jsx(te,{value:"all",children:r.risks.allLevels}),e.jsx(te,{value:"Critical",children:h("Critical")}),e.jsx(te,{value:"High",children:h("High")}),e.jsx(te,{value:"Medium",children:h("Medium")}),e.jsx(te,{value:"Low",children:h("Low")})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:r.risks.status}),e.jsxs(Re,{value:b,onValueChange:M,children:[e.jsx(Se,{children:e.jsx(Ae,{placeholder:r.risks.allStatuses})}),e.jsxs(Te,{children:[e.jsx(te,{value:"all",children:r.risks.allStatuses}),vr.map(v=>e.jsx(te,{value:v,children:l(v)},v))]})]})]})]})]})}),ue.length===0?e.jsx(jl,{icon:ss,title:r.risks.noRisksFound,description:ge?r.risks.noRisksMatchFilters:r.risks.getStartedCreate,action:t("canCreate")?{label:r.risks.createRisk,onClick:()=>s("/risks/new")}:void 0}):e.jsx(R,{className:"glass-card overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-border bg-muted/30",children:[e.jsx("th",{className:n(i?"text-right":"text-left","py-3 px-4 text-sm font-medium text-muted-foreground"),children:r.table.id}),e.jsx("th",{className:n(i?"text-right":"text-left","py-3 px-4 text-sm font-medium text-muted-foreground cursor-pointer hover:text-foreground transition-colors"),onClick:()=>Z("title"),children:e.jsxs("div",{className:"flex items-center gap-1",children:[r.table.title," ",e.jsx(E,{field:"title"})]})}),e.jsx("th",{className:n(i?"text-right":"text-left","py-3 px-4 text-sm font-medium text-muted-foreground cursor-pointer hover:text-foreground transition-colors"),onClick:()=>Z("category"),children:e.jsxs("div",{className:"flex items-center gap-1",children:[r.table.category," ",e.jsx(E,{field:"category"})]})}),e.jsx("th",{className:"text-center py-3 px-4 text-sm font-medium text-muted-foreground",children:r.table.likelihoodShort}),e.jsx("th",{className:"text-center py-3 px-4 text-sm font-medium text-muted-foreground",children:r.table.impactShort}),e.jsx("th",{className:"text-center py-3 px-4 text-sm font-medium text-muted-foreground cursor-pointer hover:text-foreground transition-colors",onClick:()=>Z("score"),children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[r.table.score," ",e.jsx(E,{field:"score"})]})}),e.jsx("th",{className:n(i?"text-right":"text-left","py-3 px-4 text-sm font-medium text-muted-foreground"),children:r.table.level}),e.jsx("th",{className:n(i?"text-right":"text-left","py-3 px-4 text-sm font-medium text-muted-foreground"),children:r.table.owner}),e.jsx("th",{className:n(i?"text-right":"text-left","py-3 px-4 text-sm font-medium text-muted-foreground"),children:r.table.status}),e.jsx("th",{className:n(i?"text-right":"text-left","py-3 px-4 text-sm font-medium text-muted-foreground cursor-pointer hover:text-foreground transition-colors"),onClick:()=>Z("updatedAt"),children:e.jsxs("div",{className:"flex items-center gap-1",children:[r.table.updated," ",e.jsx(E,{field:"updatedAt"})]})}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-medium text-muted-foreground",children:r.table.actions})]})}),e.jsx("tbody",{children:ue.map(v=>e.jsxs("tr",{className:"border-b border-border/50 hover:bg-muted/30 transition-colors cursor-pointer",onClick:()=>s(`/risks/${v.id}`),children:[e.jsx("td",{className:n(i?"text-right":"text-left","py-3 px-4 text-sm font-mono text-primary"),children:v.id}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("p",{className:"text-sm font-medium line-clamp-1",children:v.title})}),e.jsx("td",{className:n(i?"text-right":"text-left","py-3 px-4 text-sm text-muted-foreground"),children:d(v.category)}),e.jsx("td",{className:"py-3 px-4 text-center text-sm",children:v.likelihood}),e.jsx("td",{className:"py-3 px-4 text-center text-sm",children:v.impact}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsx("span",{className:"text-sm font-bold",children:v.score})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx(ce,{status:v.level,children:h(v.level)})}),e.jsx("td",{className:"py-3 px-4 text-sm text-muted-foreground truncate max-w-[120px]",children:v.owner}),e.jsx("td",{className:"py-3 px-4",children:e.jsx(ce,{status:v.status,children:l(v.status)})}),e.jsx("td",{className:"py-3 px-4 text-sm text-muted-foreground",children:new Date(v.updatedAt).toLocaleDateString()}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",onClick:A=>A.stopPropagation(),children:[e.jsx(y,{variant:"ghost",size:"icon",asChild:!0,children:e.jsx(Q,{to:`/risks/${v.id}`,children:e.jsx(Tt,{className:"h-4 w-4"})})}),t("canEdit")&&e.jsx(y,{variant:"ghost",size:"icon",asChild:!0,children:e.jsx(Q,{to:`/risks/${v.id}/edit`,children:e.jsx(Us,{className:"h-4 w-4"})})}),t("canDelete")&&e.jsx(y,{variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive",onClick:()=>B(v),children:e.jsx(ns,{className:"h-4 w-4"})})]})})]},v.id))})]})})}),e.jsx(Xe,{open:!!_,onOpenChange:()=>B(null),children:e.jsxs(_e,{children:[e.jsxs(Be,{children:[e.jsx(Ve,{children:r.risks.deleteDialogTitle}),e.jsxs(He,{children:[r.risks.deleteDialogDescriptionPrefix,' "',_?.title,'"? ',r.risks.deleteDialogDescriptionSuffix]})]}),e.jsxs(Ue,{children:[e.jsx(Ke,{children:r.actions.cancel}),e.jsx(qe,{onClick:I,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:r.actions.delete})]})]})})]})},Zs=o.forwardRef(({className:s,value:t,...a},r)=>e.jsx(Za,{ref:r,className:n("relative h-4 w-full overflow-hidden rounded-full bg-secondary",s),...a,children:e.jsx(wi,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(t||0)}%)`}})}));Zs.displayName=Za.displayName;const ps=o.forwardRef(({className:s,...t},a)=>e.jsxs(er,{ref:a,className:n("relative flex w-full touch-none select-none items-center",s),...t,children:[e.jsx(ki,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:e.jsx(Si,{className:"absolute h-full bg-primary"})}),e.jsx(Ti,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));ps.displayName=er.displayName;const dt=o.forwardRef(({className:s,...t},a)=>e.jsx("textarea",{className:n("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:a,...t}));dt.displayName="Textarea";const ds=Ri,bl=Ai,yl=Di,$r=o.forwardRef(({className:s,...t},a)=>e.jsx(sr,{ref:a,className:n("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...t}));$r.displayName=sr.displayName;const ts=o.forwardRef(({className:s,children:t,...a},r)=>e.jsxs(yl,{children:[e.jsx($r,{}),e.jsxs(tr,{ref:r,className:n("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...a,children:[t,e.jsxs(Ci,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-accent data-[state=open]:text-muted-foreground hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[e.jsx(et,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));ts.displayName=tr.displayName;const as=({className:s,...t})=>e.jsx("div",{className:n("flex flex-col space-y-1.5 text-center sm:text-left",s),...t});as.displayName="DialogHeader";const js=({className:s,...t})=>e.jsx("div",{className:n("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...t});js.displayName="DialogFooter";const rs=o.forwardRef(({className:s,...t},a)=>e.jsx(ar,{ref:a,className:n("text-lg font-semibold leading-none tracking-tight",s),...t}));rs.displayName=ar.displayName;const is=o.forwardRef(({className:s,...t},a)=>e.jsx(rr,{ref:a,className:n("text-sm text-muted-foreground",s),...t}));is.displayName=rr.displayName;const Nl=({stagesHistory:s,className:t})=>{const{strings:a,isRTL:r}=ie(),i=s.map(g=>g.stage),d=g=>a.risks.stages?.[g]??g,l=g=>{const L=Fs.indexOf(g),f=Fs.findIndex(x=>!i.includes(x));return i.includes(g)?"completed":f===L?"current":"pending"},h=g=>s.find(L=>L.stage===g);return e.jsx("div",{className:n("space-y-4",t),children:Fs.map((g,L)=>{const f=l(g),x=h(g);return e.jsxs("div",{className:n("flex gap-4",r&&"flex-row-reverse"),children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:n("w-8 h-8 rounded-full flex items-center justify-center shrink-0",f==="completed"&&"bg-primary text-primary-foreground",f==="current"&&"bg-primary/20 text-primary border-2 border-primary",f==="pending"&&"bg-muted text-muted-foreground"),children:f==="completed"?e.jsx(at,{className:"h-4 w-4"}):f==="current"?e.jsx(ws,{className:"h-4 w-4"}):e.jsx(Ia,{className:"h-4 w-4"})}),L<Fs.length-1&&e.jsx("div",{className:n("w-0.5 flex-1 min-h-[40px]",f==="completed"?"bg-primary":"bg-border")})]}),e.jsxs("div",{className:"flex-1 pb-4",children:[e.jsxs("div",{className:n("flex items-center justify-between",r&&"flex-row-reverse"),children:[e.jsx("h4",{className:n("font-medium",f==="pending"&&"text-muted-foreground"),children:d(g)}),x&&e.jsx("span",{className:"text-xs text-muted-foreground",children:x.date})]}),x?e.jsxs("div",{className:"mt-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:x.notes}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[a.risks.details.byPrefix," ",x.updatedBy]})]}):e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:a.risks.details.pending})]})]},g)})})},wl=()=>{const{id:s}=Ct(),t=gs(),{can:a}=Ne(),{strings:r,isRTL:i}=ie(),d=w=>r.risks.categories?.[w]??w,l=w=>r.risks.statuses?.[w]??w,h=w=>r.risks.levels?.[w]??w,g=w=>({Mitigate:r.treatments.approachMitigate,Transfer:r.treatments.approachTransfer,Avoid:r.treatments.approachAvoid,Accept:r.treatments.approachAccept})[w]??w,L=w=>({"Not Started":r.treatments.statusNotStarted,"In Progress":r.treatments.statusInProgress,Done:r.treatments.statusDone})[w]??w,[f,x]=o.useState(null),[k,T]=o.useState([]),[p,N]=o.useState(null),[m,u]=o.useState([]),[c,j]=o.useState([]),[b,M]=o.useState(!0),[z,S]=o.useState(null),[X,ee]=o.useState(!1),[U,H]=o.useState(!1),[_,B]=o.useState(null),[J,oe]=o.useState(3),[I,Z]=o.useState(3),[ue,xe]=o.useState(""),[ge,E]=o.useState(new Date().toISOString().slice(0,10)),[v,A]=o.useState(""),se=o.useMemo(()=>J*I,[J,I]),le=o.useMemo(()=>nt(se).label,[se]),je=async w=>{const ae=await Qe.getByRiskId(w);T(ae)};o.useEffect(()=>{(async()=>{if(s){M(!0);try{const[ae,ve,we,Ie,Le]=await Promise.all([de.getById(s),Qe.getByRiskId(s),Oe.getByRiskId(s),$e.getAuditLogsByEntity("Risk",s),Un.getByRiskId(s)]);x(ae),T(ve),N(we.length>0?we[0]:null),u(Ie),j(Le)}finally{M(!1)}}})()},[s]);const Fe=w=>{S(w),oe(w.likelihood),Z(w.impact),xe(w.assessor),E(w.date),A(w.notes??""),ee(!0)},F=async()=>{if(!(!s||!z)&&a("canEdit")&&ue.trim()){H(!0);try{await Qe.update(z.id,{likelihood:J,impact:I,notes:v}),await je(s),ee(!1),S(null)}finally{H(!1)}}},C=async()=>{if(!(!s||!_)&&a("canDelete"))try{await Qe.delete(_.id),await je(s),B(null)}catch{}};if(b)return e.jsx(fe,{text:r.risks.details.loadingDetails});if(!f)return e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:r.risks.details.notFoundTitle}),e.jsx("p",{className:"text-muted-foreground mb-4",children:r.risks.details.notFoundDesc}),e.jsx(y,{onClick:()=>t("/risks"),children:r.risks.form.backToRiskRegister})]});const q=p?Math.round(p.actions.filter(w=>w.status==="Done").length/p.actions.length*100):0;return e.jsxs("div",{className:"space-y-6 animate-in",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs(y,{variant:"ghost",className:"w-fit",onClick:()=>t("/risks"),children:[e.jsx(rt,{className:i?"ml-2 h-4 w-4":"mr-2 h-4 w-4"}),r.risks.form.backToRiskRegister]}),e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-start lg:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(pe,{variant:"outline",className:"font-mono",children:f.id}),e.jsx(ce,{status:f.level,children:h(f.level)}),e.jsx(ce,{status:f.status,children:l(f.status)})]}),e.jsx("h1",{className:"text-2xl font-bold",children:f.title}),e.jsx("p",{className:"text-muted-foreground mt-2 max-w-2xl",children:f.description})]}),e.jsxs("div",{className:"flex gap-2",children:[a("canEdit")&&e.jsx(y,{variant:"outline",asChild:!0,children:e.jsxs(Q,{to:`/risks/${f.id}/edit`,children:[e.jsx(Us,{className:i?"ml-2 h-4 w-4":"mr-2 h-4 w-4"}),r.risks.details.editRisk]})}),a("canCreate")&&e.jsx(y,{asChild:!0,children:e.jsxs(Q,{to:`/assessments/new?riskId=${f.id}`,children:[e.jsx(Ks,{className:i?"ml-2 h-4 w-4":"mr-2 h-4 w-4"}),r.risks.details.newAssessment]})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(R,{className:"glass-card",children:e.jsx(P,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center",children:e.jsx(ss,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:r.risks.form.scoreTitle}),e.jsx("p",{className:"text-xl font-bold",children:f.score})]})]})})}),e.jsx(R,{className:"glass-card",children:e.jsx(P,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-chart-2/10 flex items-center justify-center",children:e.jsx(Dt,{className:"h-5 w-5 text-chart-2"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:r.table.owner}),e.jsx("p",{className:"text-sm font-medium truncate",children:f.owner})]})]})})}),e.jsx(R,{className:"glass-card",children:e.jsx(P,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-chart-3/10 flex items-center justify-center",children:e.jsx(fs,{className:"h-5 w-5 text-chart-3"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:r.table.category}),e.jsx("p",{className:"text-sm font-medium",children:d(f.category)})]})]})})}),e.jsx(R,{className:"glass-card",children:e.jsx(P,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-chart-5/10 flex items-center justify-center",children:e.jsx(hs,{className:"h-5 w-5 text-chart-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:r.bcp.lastUpdated}),e.jsx("p",{className:"text-sm font-medium",children:new Date(f.updatedAt).toLocaleDateString()})]})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(R,{className:"glass-card lg:col-span-1",children:[e.jsx(K,{children:e.jsx(Y,{className:"text-base",children:r.risks.details.lifecycleTitle})}),e.jsx(P,{children:e.jsx(Nl,{stagesHistory:f.stagesHistory})})]}),e.jsx(R,{className:"glass-card lg:col-span-2",children:e.jsxs(Rr,{defaultValue:"overview",className:"w-full",children:[e.jsx(K,{className:"pb-0",children:e.jsxs(It,{className:"w-full justify-start",children:[e.jsx(Je,{value:"overview",children:r.risks.details.overview}),e.jsx(Je,{value:"assessments",children:r.risks.details.assessments}),e.jsx(Je,{value:"treatment",children:r.risks.details.treatment}),e.jsx(Je,{value:"incidents",children:r.risks.details.incidents}),e.jsx(Je,{value:"audit",children:r.risks.details.auditTrail})]})}),e.jsxs(P,{className:"pt-6",children:[e.jsxs(Ge,{value:"overview",className:"mt-0 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-3",children:r.risks.details.riskAssessment}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 rounded-lg bg-muted/50 text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:f.likelihood}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r.risks.details.likelihoodScale})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-muted/50 text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:f.impact}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r.risks.details.impactScale})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-primary/10 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-primary",children:f.score}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r.risks.details.scoreScale})]})]})]}),p&&a("canViewTreatments")&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-3",children:r.risks.details.treatmentProgress}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground",children:[r.risks.details.approachLabel," ",e.jsx("span",{className:"text-foreground",children:g(p.approach)})]}),e.jsxs("span",{className:"font-medium",children:[q,"%"," ",r.risks.details.completeSuffix]})]}),e.jsx(Zs,{value:q}),e.jsx(y,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs(Q,{to:`/treatments/${f.id}`,children:[e.jsx(Ze,{className:i?"ml-2 h-4 w-4":"mr-2 h-4 w-4"}),r.risks.details.viewTreatmentPlan]})})]})]})]}),e.jsx(Ge,{value:"assessments",className:"mt-0",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-sm font-medium",children:r.risks.details.assessmentHistory}),a("canCreate")&&e.jsx(y,{size:"sm",asChild:!0,children:e.jsx(Q,{to:`/assessments/new?riskId=${f.id}`,children:r.risks.details.addAssessment})})]}),k.length===0?e.jsx("p",{className:"text-sm text-muted-foreground py-4",children:r.risks.details.noAssessments}):e.jsx("div",{className:"space-y-3",children:k.map(w=>e.jsxs("div",{className:"p-4 rounded-lg border border-border bg-muted/30",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:w.date}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[r.risks.details.byPrefix," ",w.assessor]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{status:w.level,children:h(w.level)}),a("canEdit")&&e.jsx(y,{variant:"ghost",size:"icon",onClick:()=>Fe(w),"aria-label":r.risks.details.editAssessmentTitle,title:r.risks.details.editAssessmentTitle,children:e.jsx(Us,{className:"h-4 w-4"})}),a("canDelete")&&e.jsx(y,{variant:"ghost",size:"icon",onClick:()=>B(w),"aria-label":r.risks.details.deleteAssessmentTitle,title:r.risks.details.deleteAssessmentTitle,children:e.jsx(ns,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mt-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:r.risks.details.likelihoodLabel})," ",e.jsx("span",{className:"font-medium",children:w.likelihood})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:r.risks.details.impactLabel})," ",e.jsx("span",{className:"font-medium",children:w.impact})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:r.risks.details.scoreLabel})," ",e.jsx("span",{className:"font-bold",children:w.score})]})]}),w.notes&&e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:w.notes})]},w.id))})]})}),e.jsx(ds,{open:X,onOpenChange:ee,children:e.jsxs(ts,{className:"sm:max-w-2xl",children:[e.jsxs(as,{children:[e.jsx(rs,{children:r.risks.details.editAssessmentTitle}),e.jsx(is,{children:r.risks.details.editAssessmentDesc})]}),e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"editAssessor",children:r.risks.details.assessor}),e.jsx(G,{id:"editAssessor",value:ue,onChange:w=>xe(w.target.value),disabled:!a("canEdit")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"editDate",children:r.risks.details.date}),e.jsx(G,{id:"editDate",type:"date",value:ge,onChange:w=>E(w.target.value),disabled:!a("canEdit")})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(V,{children:r.risks.form.likelihood}),e.jsx("span",{className:"text-sm font-medium",children:J})]}),e.jsx(ps,{value:[J],onValueChange:([w])=>oe(w),min:1,max:5,step:1,disabled:!a("canEdit")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(V,{children:r.risks.form.impact}),e.jsx("span",{className:"text-sm font-medium",children:I})]}),e.jsx(ps,{value:[I],onValueChange:([w])=>Z(w),min:1,max:5,step:1,disabled:!a("canEdit")})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"p-4 rounded-lg bg-muted/50 text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:J}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r.risks.form.likelihood})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-muted/50 text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:I}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r.risks.form.impact})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-primary/10 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-primary",children:se}),e.jsx("div",{className:"mt-1 flex justify-center",children:e.jsx(ce,{status:le,children:h(le)})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"editNotes",children:r.risks.details.notes}),e.jsx(dt,{id:"editNotes",value:v,onChange:w=>A(w.target.value),disabled:!a("canEdit"),rows:4})]})]}),e.jsxs(js,{children:[e.jsx(y,{variant:"outline",onClick:()=>ee(!1),disabled:U,children:r.actions.cancel}),e.jsxs(y,{onClick:F,disabled:!a("canEdit")||U||!ue.trim(),children:[U?e.jsx(ke,{className:i?"ml-2 h-4 w-4 animate-spin":"mr-2 h-4 w-4 animate-spin"}):e.jsx(Ye,{className:i?"ml-2 h-4 w-4":"mr-2 h-4 w-4"}),r.actions.save]})]})]})}),e.jsx(Xe,{open:!!_,onOpenChange:w=>w?void 0:B(null),children:e.jsxs(_e,{children:[e.jsxs(Be,{children:[e.jsx(Ve,{children:r.risks.details.deleteAssessmentTitle}),e.jsx(He,{children:r.risks.details.deleteAssessmentDesc})]}),e.jsxs(Ue,{children:[e.jsx(Ke,{children:r.actions.cancel}),e.jsx(qe,{onClick:C,disabled:!a("canDelete"),children:r.actions.delete})]})]})}),e.jsx(Ge,{value:"treatment",className:"mt-0",children:a("canViewTreatments")?p?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium",children:r.treatments.planTitle}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[r.risks.details.approachLabel," ",g(p.approach)]})]}),e.jsx(y,{variant:"outline",size:"sm",asChild:!0,children:e.jsx(Q,{to:`/treatments/${f.id}`,children:a("canEdit")||a("canCreate")?e.jsxs(e.Fragment,{children:[e.jsx(Us,{className:i?"ml-2 h-4 w-4":"mr-2 h-4 w-4"}),r.risks.details.managePlan]}):e.jsxs(e.Fragment,{children:[e.jsx(Ze,{className:i?"ml-2 h-4 w-4":"mr-2 h-4 w-4"}),r.risks.details.viewTreatmentPlan]})})})]}),e.jsx("div",{className:"space-y-2",children:p.actions.map(w=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-border",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:w.title}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[r.treatments.ownerPrefix," ",w.owner," •"," ",r.treatments.duePrefix," ",w.dueDate]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{status:w.status==="Done"?"green":w.status==="In Progress"?"yellow":"red",children:L(w.status)}),w.evidenceLink&&e.jsx(y,{variant:"ghost",size:"icon",asChild:!0,children:e.jsx("a",{href:w.evidenceLink,target:"_blank",rel:"noopener noreferrer","aria-label":r.risks.details.openEvidence,title:r.risks.details.openEvidence,children:e.jsx(Pi,{className:"h-4 w-4"})})})]})]},w.id))})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ze,{className:"h-12 w-12 mx-auto text-muted-foreground mb-3"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:r.risks.details.noTreatmentPlan}),a("canCreate")&&e.jsx(y,{asChild:!0,children:e.jsx(Q,{to:`/treatments/${f.id}`,children:r.risks.details.createTreatmentPlan})})]}):e.jsx("p",{className:"text-sm text-muted-foreground py-4",children:r.common.notAllowed})}),e.jsx(Ge,{value:"incidents",className:"mt-0",children:c.length===0?e.jsx("p",{className:"text-sm text-muted-foreground py-4",children:r.risks.details.noRelatedIncidents}):e.jsx("div",{className:"space-y-3",children:c.map(w=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-border",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:w.title}),e.jsx("p",{className:"text-xs text-muted-foreground",children:w.date})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{status:w.severity,children:r.risks.levels?.[w.severity]??w.severity}),e.jsx(ce,{status:w.status==="Resolved"?"green":"yellow",children:w.status})]})]},w.id))})}),e.jsx(Ge,{value:"audit",className:"mt-0",children:m.length===0?e.jsx("p",{className:"text-sm text-muted-foreground py-4",children:r.risks.details.noAuditEntries}):e.jsx("div",{className:"space-y-3",children:m.map(w=>e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg border border-border",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-muted flex items-center justify-center shrink-0",children:e.jsx(qa,{className:"h-4 w-4 text-muted-foreground"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:w.actor}),e.jsx(pe,{variant:"outline",className:"text-xs",children:w.action})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:w.details}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:new Date(w.timestamp).toLocaleString()})]})]},w.id))})})]})]})})]})]})},Yt=()=>{const s=gs(),{id:t}=Ct(),{toast:a}=Pe(),{strings:r,isRTL:i}=ie(),d=!!t,l=U=>r.risks.categories?.[U]??U,h=U=>r.risks.statuses?.[U]??U,g=U=>r.risks.levels?.[U]??U,[L,f]=o.useState(d),[x,k]=o.useState(!1),[T,p]=o.useState([...jr]),[N,m]=o.useState({title:"",description:"",category:"",owner:"",status:"Open",likelihood:3,impact:3}),[u,c]=o.useState({});o.useEffect(()=>{j(),d&&t&&b(t)},[t,d]);const j=async()=>{try{const H=(await de.getCategories()).slice().sort((B,J)=>(B.sort_order??0)-(J.sort_order??0)).map(B=>ot(B.code||B.name||"")).filter(B=>typeof B=="string"&&B.trim().length>0),_=Array.from(new Set(H));_.length>0&&p(_)}catch{}},b=async U=>{try{const H=await de.getById(U);H&&m({title:H.title,description:H.description,category:H.category,owner:H.owner,status:H.status,likelihood:H.likelihood,impact:H.impact})}finally{f(!1)}},M=()=>{const U={};return N.title.trim()||(U.title=r.risks.form.requiredTitle),N.description.trim()||(U.description=r.risks.form.requiredDescription),N.category||(U.category=r.risks.form.requiredCategory),N.owner.trim()||(U.owner=r.risks.form.requiredOwner),c(U),Object.keys(U).length===0},z=async U=>{if(U.preventDefault(),!!M()){k(!0);try{if(d&&t)await de.update(t,N),a({title:r.risks.form.toastUpdatedTitle,description:r.risks.form.toastUpdatedDesc});else{const H=await de.create({...N,category:N.category,status:N.status,stagesHistory:[{stage:"Context",date:new Date().toISOString().split("T")[0],notes:r.risks.form.stageCreatedNote,updatedBy:r.risks.form.stageUpdatedBy}]});a({title:r.risks.form.toastCreatedTitle,description:`${H.id} ${r.risks.form.toastCreatedDescSuffix}`})}s("/risks")}catch{a({title:r.risks.toastErrorTitle,description:r.risks.form.toastSaveFailed,variant:"destructive"})}finally{k(!1)}}},S=N.likelihood*N.impact,X=nt(S);if(L)return e.jsx(fe,{text:r.risks.form.loadingRisk});const ee=g(X.label);return e.jsxs("div",{className:"max-w-3xl mx-auto space-y-6 animate-in",children:[e.jsxs(y,{variant:"ghost",className:"w-fit",onClick:()=>s("/risks"),children:[e.jsx(rt,{className:i?"ml-2 h-4 w-4":"mr-2 h-4 w-4"}),r.risks.form.backToRiskRegister]}),e.jsxs(R,{className:"glass-card",children:[e.jsx(K,{children:e.jsx(Y,{children:d?r.risks.form.editRiskTitle:r.risks.form.createRiskTitle})}),e.jsx(P,{children:e.jsxs("form",{onSubmit:z,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(V,{htmlFor:"title",children:[r.table.title," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(G,{id:"title",value:N.title,onChange:U=>m(H=>({...H,title:U.target.value})),placeholder:r.risks.form.placeholderTitle,className:u.title?"border-destructive":""}),u.title&&e.jsx("p",{className:"text-xs text-destructive",children:u.title})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(V,{htmlFor:"description",children:[r.table.description," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(dt,{id:"description",value:N.description,onChange:U=>m(H=>({...H,description:U.target.value})),placeholder:r.risks.form.placeholderDescription,rows:4,className:u.description?"border-destructive":""}),u.description&&e.jsx("p",{className:"text-xs text-destructive",children:u.description})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(V,{htmlFor:"category",children:[r.table.category," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(Re,{value:N.category,onValueChange:U=>m(H=>({...H,category:U})),children:[e.jsx(Se,{className:u.category?"border-destructive":"",children:e.jsx(Ae,{placeholder:r.risks.form.placeholderCategory})}),e.jsx(Te,{children:T.map(U=>e.jsx(te,{value:U,children:l(U)},U))})]}),u.category&&e.jsx("p",{className:"text-xs text-destructive",children:u.category})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(V,{htmlFor:"owner",children:[r.table.owner," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(G,{id:"owner",value:N.owner,onChange:U=>m(H=>({...H,owner:U.target.value})),placeholder:r.risks.form.placeholderOwner,className:u.owner?"border-destructive":""}),u.owner&&e.jsx("p",{className:"text-xs text-destructive",children:u.owner})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"status",children:r.table.status}),e.jsxs(Re,{value:N.status,onValueChange:U=>m(H=>({...H,status:U})),children:[e.jsx(Se,{children:e.jsx(Ae,{})}),e.jsx(Te,{children:vr.map(U=>e.jsx(te,{value:U,children:h(U)},U))})]})]}),e.jsxs("div",{className:"space-y-4 p-4 rounded-lg bg-muted/30 border border-border",children:[e.jsx("h3",{className:"font-medium",children:r.risks.form.assessmentTitle}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(V,{children:r.risks.form.likelihood}),e.jsx("span",{className:"text-2xl font-bold text-primary",children:N.likelihood})]}),e.jsx(ps,{value:[N.likelihood],onValueChange:([U])=>m(H=>({...H,likelihood:U})),min:1,max:5,step:1}),e.jsxs("div",{className:i?"flex justify-between text-xs text-muted-foreground flex-row-reverse":"flex justify-between text-xs text-muted-foreground",children:[e.jsx("span",{children:r.risks.form.rare}),e.jsx("span",{children:r.risks.form.almostCertain})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(V,{children:r.risks.form.impact}),e.jsx("span",{className:"text-2xl font-bold text-primary",children:N.impact})]}),e.jsx(ps,{value:[N.impact],onValueChange:([U])=>m(H=>({...H,impact:U})),min:1,max:5,step:1}),e.jsxs("div",{className:i?"flex justify-between text-xs text-muted-foreground flex-row-reverse":"flex justify-between text-xs text-muted-foreground",children:[e.jsx("span",{children:r.risks.form.insignificant}),e.jsx("span",{children:r.risks.form.catastrophic})]})]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-4 pt-4 border-t border-border",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:r.risks.form.scoreTitle}),e.jsx("p",{className:"text-3xl font-bold",children:S})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:r.risks.form.levelTitle}),e.jsx(ce,{status:X.label,className:"text-sm",children:ee})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-4 pt-4",children:[e.jsx(y,{type:"button",variant:"outline",onClick:()=>s("/risks"),children:r.actions.cancel}),e.jsx(y,{type:"submit",disabled:x,children:x?e.jsxs(e.Fragment,{children:[e.jsx(ke,{className:i?"ml-2 h-4 w-4 animate-spin":"mr-2 h-4 w-4 animate-spin"}),r.risks.form.saving]}):e.jsxs(e.Fragment,{children:[e.jsx(Ye,{className:i?"ml-2 h-4 w-4":"mr-2 h-4 w-4"}),d?r.risks.form.updateRisk:r.risks.form.createRisk]})})]})]})})]})]})},kl=(s,t)=>Math.floor((t.getTime()-s.getTime())/(1e3*60*60*24)),Sl=()=>{const{can:s}=Ne(),{strings:t,isRTL:a}=ie(),[r,i]=O.useState(!0),[d,l]=O.useState([]),[h,g]=O.useState([]),[L,f]=O.useState(90);if(O.useEffect(()=>{(async()=>{try{const[M,z,S]=await Promise.all([de.getAll(),Qe.getAll(),$e.getSystemSettings()]);l(M),g(z),f(S.autoAssessmentReminder??90)}finally{i(!1)}})()},[]),r)return e.jsx(fe,{text:t.common.loading});const x=d.filter(b=>b.level==="Critical"||b.level==="High"),k=d.filter(b=>b.status==="Open"||b.status==="Monitoring"),T=d.filter(b=>b.status==="Closed"),p=(()=>{const b=new Map;for(const M of h){const z=b.get(M.riskId);(!z||new Date(M.date)>new Date(z))&&b.set(M.riskId,M.date)}return b})(),N=new Date,m=d.map(b=>{const M=p.get(b.id)??b.updatedAt??b.createdAt,z=new Date(M),S=new Date(z);return S.setDate(S.getDate()+L),{risk:b,dueDate:S,isOverdue:S.getTime()<=N.getTime(),dueInDays:kl(N,S)}}),u=m.filter(b=>b.isOverdue).length,c=m.filter(b=>!b.isOverdue&&b.dueInDays<=14).length,j=[...x].sort((b,M)=>(M.score??0)-(b.score??0)).slice(0,5);return e.jsxs("div",{className:"space-y-6 animate-in",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:t.risksDashboard.title}),e.jsx("p",{className:"text-muted-foreground",children:t.risksDashboard.subtitle})]}),e.jsxs("div",{className:n("flex items-center gap-2",a?"sm:flex-row-reverse":""),children:[s("canCreate")&&e.jsx(y,{asChild:!0,children:e.jsxs(Q,{to:"/risks/new",children:[e.jsx(ze,{className:n("h-4 w-4",a?"ml-2":"mr-2")}),t.actions.newRisk]})}),e.jsx(y,{asChild:!0,variant:"outline",children:e.jsx(Q,{to:"/analysis/matrix",children:t.analysis.openMatrix})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsx(R,{className:"glass-card border-status-critical/30",children:e.jsx(P,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:t.risksDashboard.criticalHigh}),e.jsx("p",{className:"text-3xl font-bold mt-1 text-status-critical",children:x.length})]}),e.jsx(ss,{className:"h-6 w-6 text-status-critical"})]})})}),e.jsx(R,{className:"glass-card",children:e.jsx(P,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:t.risksDashboard.inProgress}),e.jsx("p",{className:"text-3xl font-bold mt-1",children:k.length})]}),e.jsx(ws,{className:"h-6 w-6 text-status-warning"})]})})}),e.jsx(R,{className:"glass-card",children:e.jsx(P,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:t.risksDashboard.closed}),e.jsx("p",{className:"text-3xl font-bold mt-1",children:T.length})]}),e.jsx(ir,{className:"h-6 w-6 text-status-success"})]})})}),e.jsx(R,{className:"glass-card",children:e.jsx(P,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:t.risksDashboard.overdue}),e.jsx("p",{className:n("text-3xl font-bold mt-1",u>0?"text-status-critical":""),children:u})]}),e.jsx(Ks,{className:n("h-6 w-6",u>0?"text-status-critical":"text-muted-foreground")})]})})}),e.jsx(R,{className:"glass-card",children:e.jsx(P,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:t.risksDashboard.dueSoon}),e.jsx("p",{className:"text-3xl font-bold mt-1",children:c})]}),e.jsx(Ks,{className:"h-6 w-6 text-muted-foreground"})]})})})]}),u>0&&e.jsxs(R,{className:"glass-card border-status-warning/30 bg-status-warning/5",children:[e.jsxs(K,{children:[e.jsx(Y,{className:"text-base",children:t.risksDashboard.overdueCardTitle}),e.jsx(ye,{children:t.risksDashboard.overdueCardDesc.replace("{count}",String(u)).replace("{days}",String(L))})]}),e.jsx(P,{children:e.jsx(y,{asChild:!0,variant:"outline",children:e.jsx(Q,{to:"/risks/followup",children:t.risksDashboard.viewFollowUp})})})]}),e.jsxs(R,{className:"glass-card",children:[e.jsxs(K,{children:[e.jsx(Y,{className:"text-base",children:t.risksDashboard.topRisksTitle}),e.jsx(ye,{children:t.risksDashboard.topRisksDesc})]}),e.jsxs(P,{children:[j.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:t.risksDashboard.noTopRisks}):e.jsx("div",{className:"space-y-3",children:j.map(b=>e.jsx("div",{className:"p-4 border border-border rounded-lg",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-semibold truncate",children:b.title}),e.jsx(ce,{status:b.level,children:t.risks.levels?.[b.level]??b.level})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1 line-clamp-2",children:b.description}),e.jsxs("div",{className:"flex flex-wrap gap-3 mt-2 text-xs text-muted-foreground",children:[e.jsxs("span",{children:[t.table.id,": ",e.jsx("span",{className:"text-foreground",children:b.id})]}),e.jsxs("span",{children:[t.table.owner,": ",e.jsx("span",{className:"text-foreground",children:b.owner})]}),e.jsxs("span",{children:[t.table.score,": ",e.jsx("span",{className:"text-foreground font-semibold",children:b.score})]})]})]}),e.jsx(y,{asChild:!0,variant:"outline",className:"shrink-0",children:e.jsxs(Q,{to:`/risks/${b.id}`,children:[t.actions.viewAll,e.jsx(Me,{className:n("h-4 w-4",a?"mr-2":"ml-2")})]})})]})},b.id))}),e.jsxs("div",{className:n("mt-4 flex flex-wrap gap-2",a?"justify-end":"justify-start"),children:[e.jsx(y,{asChild:!0,variant:"ghost",size:"sm",children:e.jsx(Q,{to:"/risks",children:t.risksDashboard.openRegister})}),e.jsx(y,{asChild:!0,variant:"ghost",size:"sm",children:e.jsx(Q,{to:"/risks/followup",children:t.risksDashboard.viewFollowUp})}),e.jsxs(pe,{variant:"secondary",children:[t.risksDashboard.total,": ",d.length]})]})]})]})]})},vt=(s,t)=>Math.floor((t.getTime()-s.getTime())/(1e3*60*60*24)),Tl=()=>{const{strings:s,isRTL:t}=ie(),a=m=>s.risks.levels?.[m]??m,[r,i]=O.useState(!0),[d,l]=O.useState([]),[h,g]=O.useState([]),[L,f]=O.useState(90);if(O.useEffect(()=>{(async()=>{try{const[u,c,j]=await Promise.all([de.getAll(),Qe.getAll(),$e.getSystemSettings()]);l(u),g(c),f(j.autoAssessmentReminder??90)}finally{i(!1)}})()},[]),r)return e.jsx(fe,{text:s.common.loading});const x=(()=>{const m=new Map;for(const u of h){const c=m.get(u.riskId);(!c||new Date(u.date)>new Date(c))&&m.set(u.riskId,u.date)}return m})(),k=new Date,T=d.map(m=>{const u=x.get(m.id)??m.updatedAt??m.createdAt,c=new Date(u),j=new Date(c);j.setDate(j.getDate()+L);const b=vt(j,k);return{risk:m,lastDate:c,dueDate:j,overdueDays:b,isOverdue:j.getTime()<=k.getTime()}}).sort((m,u)=>m.isOverdue!==u.isOverdue?m.isOverdue?-1:1:m.overdueDays!==u.overdueDays?u.overdueDays-m.overdueDays:u.risk.score-m.risk.score),p=T.filter(m=>m.isOverdue),N=T.filter(m=>!m.isOverdue&&vt(k,m.dueDate)<=14);return e.jsxs("div",{className:"space-y-6 animate-in",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:s.followup.title}),e.jsx("p",{className:"text-muted-foreground",children:s.followup.subtitle.replace("{days}",String(L))})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsx(R,{className:"glass-card border-status-critical/30",children:e.jsxs(P,{className:"p-6",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:s.followup.overdue}),e.jsx("p",{className:"text-3xl font-bold mt-1 text-status-critical",children:p.length})]})}),e.jsx(R,{className:"glass-card",children:e.jsxs(P,{className:"p-6",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:s.followup.dueSoon}),e.jsx("p",{className:"text-3xl font-bold mt-1",children:N.length})]})}),e.jsx(R,{className:"glass-card",children:e.jsxs(P,{className:"p-6",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:s.followup.totalTracked}),e.jsx("p",{className:"text-3xl font-bold mt-1",children:T.length})]})})]}),e.jsxs(R,{className:"glass-card",children:[e.jsxs(K,{children:[e.jsx(Y,{className:"text-base",children:s.followup.listTitle}),e.jsx(ye,{children:s.followup.listDesc})]}),e.jsx(P,{className:"space-y-3",children:T.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:s.followup.noRisks}):T.map(({risk:m,lastDate:u,dueDate:c,overdueDays:j,isOverdue:b})=>e.jsxs("div",{className:n("flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 p-3 rounded-lg border",b?"border-status-critical/30 bg-status-critical/5":"border-border bg-muted/10"),children:[e.jsxs("div",{className:"flex items-start gap-3 min-w-0",children:[e.jsx("div",{className:n("mt-0.5",b?"text-status-critical":"text-muted-foreground"),children:e.jsx(Ii,{className:"h-5 w-5"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:m.title}),e.jsxs("p",{className:"text-xs text-muted-foreground truncate",children:[m.id," • ",m.owner," • ",s.followup.lastAssessment,":"," ",u.toLocaleDateString()," • ",s.followup.due,":"," ",c.toLocaleDateString()]}),e.jsx("div",{className:n("mt-1 text-xs",b?"text-status-critical":"text-muted-foreground"),children:b?s.followup.overdueBy.replace("{days}",String(Math.max(0,j))):s.followup.dueIn.replace("{days}",String(Math.max(0,vt(k,c))))})]})]}),e.jsxs("div",{className:n("flex items-center gap-2",t?"sm:flex-row-reverse":""),children:[e.jsx(ce,{status:m.level,children:a(m.level)}),e.jsxs(pe,{variant:"secondary",children:[s.followup.score,": ",m.score]}),e.jsx(y,{asChild:!0,size:"sm",variant:"outline",children:e.jsx(Q,{to:`/assessments/new?riskId=${encodeURIComponent(m.id)}`,children:s.followup.assessNow})}),e.jsx(y,{asChild:!0,size:"sm",variant:"ghost",children:e.jsxs(Q,{to:`/risks/${m.id}`,children:[s.followup.viewRisk,e.jsx(Me,{className:n("h-4 w-4",t?"mr-2":"ml-2")})]})})]})]},m.id))})]})]})},Dl=["Critical","High","Medium","Low","Other"],Cl=s=>s==="Low"||s==="Medium"||s==="High"||s==="Critical",Rl=s=>s==="Critical"?"text-status-critical":s==="High"?"text-status-high":s==="Medium"?"text-status-medium":s==="Low"?"text-status-low":"text-muted-foreground",Al=s=>s==="Critical"?"hsl(var(--status-critical))":s==="High"?"hsl(var(--status-high))":s==="Medium"?"hsl(var(--status-medium))":s==="Low"?"hsl(var(--status-low))":"hsl(var(--muted-foreground))",Pl=()=>{const{strings:s,isRTL:t}=ie(),[a,r]=O.useState(!0),[i,d]=O.useState([]),[l,h]=O.useState([]);if(O.useEffect(()=>{(async()=>{try{const[j,b]=await Promise.all([de.getAll(),Qe.getAll()]);d(j),h(b)}finally{r(!1)}})()},[]),a)return e.jsx(fe,{text:s.common.loading});const g=s.risks.levels??{},L=s.risks.categories??{},f=c=>g[c]??(c==="Other"?s.analysis.otherLevel:c),x=c=>L[c]??c,k=i.reduce((c,j)=>{const b=Cl(j.level)?j.level:"Other";return c[b]=(c[b]??0)+1,c},{Low:0,Medium:0,High:0,Critical:0,Other:0}),T=Dl.filter(c=>k[c]>0).map(c=>({level:c,label:f(c),count:k[c]})),p=(()=>{const c=new Map;for(const j of i)c.set(j.category,(c.get(j.category)??0)+1);return Array.from(c.entries()).map(([j,b])=>({category:j,label:x(j),count:b})).sort((j,b)=>b.count-j.count)})(),N=i.filter(c=>c.level==="Critical"||c.level==="High").sort((c,j)=>j.score-c.score).slice(0,6),m=(()=>{const c=new Map;for(const j of l)c.set(j.riskId,(c.get(j.riskId)??0)+1);return c})(),u=[...i].sort((c,j)=>(m.get(c.id)??0)-(m.get(j.id)??0)).slice(0,6);return e.jsxs("div",{className:"space-y-6 animate-in",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:s.analysis.dashboardTitle}),e.jsx("p",{className:"text-muted-foreground",children:s.analysis.dashboardSubtitle})]}),e.jsx(y,{asChild:!0,variant:"secondary",children:e.jsxs(Q,{to:"/analysis/matrix",children:[e.jsx(Ua,{className:n("h-4 w-4",t?"ml-2":"mr-2")}),s.analysis.openMatrix]})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(R,{className:"glass-card",children:e.jsxs(P,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:s.analysis.totalRisks}),e.jsx("p",{className:"text-3xl font-bold mt-1",children:i.length})]}),e.jsx("div",{className:"w-12 h-12 rounded-xl bg-primary/10 flex items-center justify-center",children:e.jsx(Ha,{className:"h-6 w-6 text-primary"})})]}),e.jsx("div",{className:"flex items-center gap-2 mt-4 text-sm",children:e.jsx(pe,{variant:"secondary",children:s.analysis.updatedFromRegister})})]})}),e.jsx(R,{className:"glass-card border-status-critical/30",children:e.jsxs(P,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:s.analysis.highPriority}),e.jsx("p",{className:"text-3xl font-bold mt-1 text-status-critical",children:N.length})]}),e.jsx("div",{className:"w-12 h-12 rounded-xl bg-status-critical/10 flex items-center justify-center",children:e.jsx(za,{className:"h-6 w-6 text-status-critical"})})]}),e.jsx("div",{className:"flex items-center gap-2 mt-4 text-sm text-status-critical",children:e.jsx("span",{children:s.analysis.needsFollowUp})})]})}),e.jsx(R,{className:"glass-card",children:e.jsxs(P,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:s.analysis.totalAssessments}),e.jsx("p",{className:"text-3xl font-bold mt-1",children:l.length})]}),e.jsx("div",{className:"w-12 h-12 rounded-xl bg-chart-2/10 flex items-center justify-center",children:e.jsx(Me,{className:"h-6 w-6 text-chart-2"})})]}),e.jsx("div",{className:"mt-4 text-sm text-muted-foreground",children:s.analysis.assessmentsStoredLocally})]})}),e.jsx(R,{className:"glass-card",children:e.jsxs(P,{className:"p-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:s.analysis.avgScore}),e.jsx("p",{className:"text-3xl font-bold mt-1",children:i.length>0?(i.reduce((c,j)=>c+j.score,0)/i.length).toFixed(1):"0.0"})]}),e.jsx("div",{className:"mt-4 flex flex-wrap gap-2",children:["Critical","High","Medium","Low"].filter(c=>k[c]>0).map(c=>e.jsxs(pe,{variant:"outline",className:Rl(c),children:[f(c),": ",k[c]]},c))})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(R,{className:"glass-card",children:[e.jsxs(K,{children:[e.jsx(Y,{className:"text-base",children:s.analysis.risksByLevel}),e.jsx(ye,{children:s.analysis.risksByLevelDesc})]}),e.jsx(P,{children:T.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:s.analysis.noRisks}):e.jsx("div",{className:"h-[320px]",children:e.jsx(zs,{width:"100%",height:"100%",children:e.jsxs(yt,{data:T,children:[e.jsx(Ys,{strokeDasharray:"3 3",stroke:"hsl(var(--border))"}),e.jsx(Ws,{dataKey:"label",stroke:"hsl(var(--muted-foreground))",fontSize:12}),e.jsx(Js,{stroke:"hsl(var(--muted-foreground))",fontSize:12,allowDecimals:!1}),e.jsx(Gs,{contentStyle:{backgroundColor:"hsl(var(--card))",border:"1px solid hsl(var(--border))",borderRadius:"8px"}}),e.jsx(mr,{}),e.jsx(Nt,{dataKey:"count",name:s.table.count,radius:[6,6,0,0],children:T.map(c=>e.jsx(ur,{fill:Al(c.level)},c.level))})]})})})})]}),e.jsxs(R,{className:"glass-card",children:[e.jsxs(K,{children:[e.jsx(Y,{className:"text-base",children:s.analysis.risksByCategory}),e.jsx(ye,{children:s.analysis.risksByCategoryDesc})]}),e.jsx(P,{children:p.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:s.analysis.noRisks}):e.jsx("div",{className:"h-[320px]",children:e.jsx(zs,{width:"100%",height:"100%",children:e.jsxs(yt,{data:p,layout:"vertical",margin:{left:16},children:[e.jsx(Ys,{strokeDasharray:"3 3",stroke:"hsl(var(--border))"}),e.jsx(Ws,{type:"number",stroke:"hsl(var(--muted-foreground))",fontSize:12,allowDecimals:!1}),e.jsx(Js,{type:"category",dataKey:"label",stroke:"hsl(var(--muted-foreground))",fontSize:12,width:t?140:120}),e.jsx(Gs,{contentStyle:{backgroundColor:"hsl(var(--card))",border:"1px solid hsl(var(--border))",borderRadius:"8px"}}),e.jsx(Nt,{dataKey:"count",name:s.table.count,fill:"hsl(var(--chart-1))",radius:[0,6,6,0]})]})})})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(R,{className:"glass-card",children:[e.jsxs(K,{children:[e.jsx(Y,{className:"text-base",children:s.analysis.topCriticalRisks}),e.jsx(ye,{children:s.analysis.topCriticalRisksDesc})]}),e.jsx(P,{className:"space-y-3",children:N.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:s.analysis.noCriticalRisks}):N.map(c=>e.jsxs("div",{className:"flex items-center justify-between gap-3 p-3 rounded-lg border border-border bg-muted/20",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:c.title}),e.jsxs("p",{className:"text-xs text-muted-foreground truncate",children:[c.id," • ",c.category," • ",c.owner]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{status:c.level,children:f(c.level)}),e.jsx(y,{asChild:!0,size:"sm",variant:"ghost",children:e.jsxs(Q,{to:`/risks/${c.id}`,children:[s.actions.viewAll,e.jsx(Me,{className:n("h-4 w-4",t?"mr-2 rotate-180":"ml-2")})]})})]})]},c.id))})]}),e.jsxs(R,{className:"glass-card",children:[e.jsxs(K,{children:[e.jsx(Y,{className:"text-base",children:s.analysis.leastAssessed}),e.jsx(ye,{children:s.analysis.leastAssessedDesc})]}),e.jsx(P,{className:"space-y-3",children:u.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:s.analysis.noRisks}):u.map(c=>{const j=m.get(c.id)??0;return e.jsxs("div",{className:"flex items-center justify-between gap-3 p-3 rounded-lg border border-border bg-muted/20",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:c.title}),e.jsxs("p",{className:"text-xs text-muted-foreground truncate",children:[c.id," • ",s.analysis.assessmentsCountLabel,": ",j]})]}),e.jsx(y,{asChild:!0,size:"sm",variant:"outline",children:e.jsx(Q,{to:`/assessments/new?riskId=${encodeURIComponent(c.id)}`,children:s.analysis.addAssessment})})]},c.id)})})]})]})]})},Il=s=>{const t=nt(s).label;return t==="Critical"?"bg-status-critical/15 border-status-critical/40 hover:bg-status-critical/25":t==="High"?"bg-status-high/15 border-status-high/40 hover:bg-status-high/25":t==="Medium"?"bg-status-medium/15 border-status-medium/40 hover:bg-status-medium/25":"bg-status-low/15 border-status-low/40 hover:bg-status-low/25"},Ll=()=>{const s=gs(),{strings:t,isRTL:a}=ie(),[r,i]=O.useState(!0),[d,l]=O.useState([]),h=O.useMemo(()=>{const f={};for(const x of d){const k=`${x.likelihood}-${x.impact}`;f[k]||(f[k]=[]),f[k].push(x)}return f},[d]);if(O.useEffect(()=>{(async()=>{try{l(await de.getAll())}finally{i(!1)}})()},[]),r)return e.jsx(fe,{text:t.common.loading});const g=d.length>0,L=(f,x)=>{const k=`${f}-${x}`,T=h[k]??[];if(T.length===0)return;const p=[...T].sort((N,m)=>m.score-N.score)[0];s(`/risks/${p.id}`)};return e.jsxs("div",{className:"space-y-6 animate-in",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:t.analysis.matrixTitle}),e.jsx("p",{className:"text-muted-foreground",children:t.analysis.matrixSubtitle})]}),e.jsxs(R,{className:"glass-card",children:[e.jsxs(K,{children:[e.jsx(Y,{className:"text-base",children:t.analysis.matrixCardTitle}),e.jsx(ye,{children:t.analysis.matrixCardDesc})]}),e.jsxs(P,{children:[!g&&e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:t.analysis.noRisks}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("div",{className:"inline-block min-w-full",children:[e.jsxs("div",{className:n("flex items-center gap-4 mb-4",a?"flex-row-reverse":""),children:[e.jsx("div",{className:"w-20 text-sm font-semibold text-muted-foreground text-center",children:t.analysis.likelihoodAxis}),e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"grid grid-cols-5 gap-1",children:Array.from({length:5},(f,x)=>5-x).map(f=>e.jsx("div",{className:"contents",children:Array.from({length:5},(x,k)=>k+1).map(x=>{const k=`${f}-${x}`,T=h[k]??[],p=f*x,N=T.length===1?t.analysis.riskLabel:t.analysis.risksLabel,m=`${t.analysis.likelihoodAxis}: ${f}. ${t.analysis.impactAxis}: ${x}. ${T.length} ${N}.`;return e.jsxs("button",{className:n("relative aspect-square min-w-[64px] border-2 rounded-lg p-2 transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background",T.length>0?"cursor-pointer":"opacity-70 cursor-default",Il(p)),onClick:()=>L(f,x),disabled:T.length===0,type:"button","aria-label":m,children:[T.length>0&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",children:T.length}),e.jsx("div",{className:"text-xs text-muted-foreground",children:T.length===1?t.analysis.riskLabel:t.analysis.risksLabel})]})}),T.length===0&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"text-xs text-muted-foreground",children:"0"})})]},k)})},f))})})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-20"}),e.jsx("div",{className:"flex-1 text-center",children:e.jsx("div",{className:"text-sm font-semibold text-muted-foreground",children:t.analysis.impactAxis})})]}),e.jsxs("div",{className:"mt-6 flex flex-wrap gap-4 justify-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-status-critical/20 border-2 border-status-critical"}),e.jsx("span",{className:"text-sm",children:t.analysis.legendCritical})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-status-high/20 border-2 border-status-high"}),e.jsx("span",{className:"text-sm",children:t.analysis.legendHigh})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-status-medium/20 border-2 border-status-medium"}),e.jsx("span",{className:"text-sm",children:t.analysis.legendMedium})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-status-low/20 border-2 border-status-low"}),e.jsx("span",{className:"text-sm",children:t.analysis.legendLow})]})]}),e.jsx("div",{className:n("mt-4 text-xs text-muted-foreground",a?"text-right":"text-left"),children:t.analysis.matrixHint})]})})]})]})]})},El=()=>{const s=gs(),[t,a]=Li(),r=t.get("riskId"),{toast:i}=Pe(),{user:d}=Ne(),{strings:l,isRTL:h}=ie(),g=A=>l.risks.levels?.[A]??A,L=A=>l.risks.categories?.[A]??A,f=A=>l.risks.statuses?.[A]??A,x=o.useMemo(()=>new Date().toISOString().slice(0,10),[]),[k,T]=o.useState(3),[p,N]=o.useState(3),[m,u]=o.useState(d?.name||d?.email||""),[c,j]=o.useState(new Date().toISOString().slice(0,10)),[b,M]=o.useState(""),[z,S]=o.useState(!1),[X,ee]=o.useState([]),[U,H]=o.useState(!1),[_,B]=o.useState(null),[J,oe]=o.useState(!1),[I,Z]=o.useState([]),[ue,xe]=o.useState(!1);o.useEffect(()=>{(async()=>{if(!r){H(!0);try{const le=[...await de.getAll()].sort((je,Fe)=>(Fe.score??0)-(je.score??0));ee(le)}catch{i({title:l.assessments.failedToLoadRisksTitle,description:l.common.pleaseTryAgain,variant:"destructive"})}finally{H(!1)}}})()},[r]),o.useEffect(()=>{(async()=>{if(!r){B(null);return}oe(!0);try{const se=await de.getById(r);if(!se){i({title:l.assessments.riskNotFoundTitle,description:l.assessments.riskNotFoundDesc,variant:"destructive"}),a({});return}B(se)}catch{i({title:l.assessments.failedToLoadRisksTitle,description:l.common.pleaseTryAgain,variant:"destructive"})}finally{oe(!1)}})()},[r]),o.useEffect(()=>{(async()=>{if(!r){Z([]);return}xe(!0);try{const le=[...await Qe.getByRiskId(r)].sort((je,Fe)=>new Date(Fe.date).getTime()-new Date(je.date).getTime());Z(le.slice(0,5))}catch{Z([])}finally{xe(!1)}})()},[r]);const ge=o.useMemo(()=>k*p,[k,p]),E=o.useMemo(()=>nt(ge).label,[ge]),v=async A=>{if(A.preventDefault(),!r){i({title:l.assessments.missingRiskIdTitle,description:l.assessments.missingRiskIdDesc,variant:"destructive"});return}if(!m.trim()){i({title:l.assessments.assessorRequiredTitle,description:l.assessments.assessorRequiredDesc,variant:"destructive"});return}if(c>x){i({title:l.assessments.invalidDateTitle,description:l.assessments.invalidDateDesc,variant:"destructive"});return}S(!0);try{await Qe.create({riskId:r,likelihood:k,impact:p,assessor:m.trim(),date:c,notes:b}),i({title:l.assessments.createdTitle,description:`${l.table.score}: ${ge} (${g(E)})`}),s(`/risks/${r}`)}catch{i({title:l.assessments.failedToCreateTitle,description:l.common.pleaseTryAgain,variant:"destructive"})}finally{S(!1)}};return e.jsxs("div",{className:"max-w-2xl mx-auto space-y-6 animate-in",children:[e.jsxs(y,{variant:"ghost",onClick:()=>s(-1),children:[e.jsx(rt,{className:h?"ml-2 h-4 w-4":"mr-2 h-4 w-4"})," ",l.actions.back]}),e.jsxs(R,{className:"glass-card",children:[e.jsx(K,{children:e.jsxs(Y,{children:[l.assessments.newTitle," ",r&&`${l.assessments.forPrefix} ${r}`]})}),e.jsx(P,{children:r?e.jsxs("form",{onSubmit:v,className:"space-y-6",children:[e.jsx("div",{className:"p-4 rounded-lg border border-border bg-muted/30",children:J?e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(ke,{className:"h-4 w-4 animate-spin"})," ",l.common.loading]}):_?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("p",{className:"text-sm font-medium",children:_.title}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{status:_.level,children:g(_.level)}),e.jsx(ce,{status:_.status,children:f(_.status)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 text-xs text-muted-foreground",children:[e.jsxs("div",{children:[l.table.id,": ",e.jsx("span",{className:"text-foreground font-mono",children:_.id})]}),e.jsxs("div",{children:[l.table.owner,": ",e.jsx("span",{className:"text-foreground",children:_.owner})]}),e.jsxs("div",{children:[l.table.category,":"," ",e.jsx("span",{className:"text-foreground",children:L(_.category)})]}),e.jsxs("div",{children:[l.table.score,": ",e.jsx("span",{className:"text-foreground font-semibold",children:_.score})]})]})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:l.assessments.selectRiskHint})}),e.jsxs(R,{className:"glass-card",children:[e.jsx(K,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx(Y,{className:"text-base",children:l.assessments.recentTitle}),r&&e.jsx(y,{asChild:!0,variant:"outline",size:"sm",children:e.jsx(Q,{to:`/risks/${r}`,children:l.assessments.viewAll})})]})}),e.jsx(P,{className:"space-y-2",children:ue?e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(ke,{className:"h-4 w-4 animate-spin"})," ",l.common.loading]}):I.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:l.assessments.noRecent}):e.jsx("div",{className:"space-y-2",children:I.map(A=>e.jsx("div",{className:"p-3 rounded-lg border border-border bg-muted/20",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("p",{className:"text-sm font-medium",children:[new Date(A.date).toLocaleDateString(),e.jsxs("span",{className:"text-muted-foreground",children:[" • ",l.risks.details.byPrefix," ",A.assessor]})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[l.risks.details.likelihoodLabel," ",A.likelihood," • ",l.risks.details.impactLabel," ",A.impact," • ",l.risks.details.scoreLabel," ",A.score]})]}),e.jsx(ce,{status:A.level,children:g(A.level)})]})},A.id))})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"assessor",children:l.assessments.assessor}),e.jsx(G,{id:"assessor",value:m,onChange:A=>u(A.target.value),placeholder:l.assessments.assessorPlaceholder})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"date",children:l.assessments.date}),e.jsx(G,{id:"date",type:"date",value:c,onChange:A=>j(A.target.value),max:x})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(V,{children:l.assessments.likelihood}),e.jsx("span",{className:"text-2xl font-bold text-primary",children:k})]}),e.jsx(ps,{value:[k],onValueChange:([A])=>T(A),min:1,max:5,step:1}),e.jsxs("div",{className:h?"flex justify-between text-xs text-muted-foreground flex-row-reverse":"flex justify-between text-xs text-muted-foreground",children:[e.jsx("span",{children:l.assessments.rare}),e.jsx("span",{children:l.assessments.almostCertain})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(V,{children:l.assessments.impact}),e.jsx("span",{className:"text-2xl font-bold text-primary",children:p})]}),e.jsx(ps,{value:[p],onValueChange:([A])=>N(A),min:1,max:5,step:1}),e.jsxs("div",{className:h?"flex justify-between text-xs text-muted-foreground flex-row-reverse":"flex justify-between text-xs text-muted-foreground",children:[e.jsx("span",{children:l.assessments.insignificant}),e.jsx("span",{children:l.assessments.catastrophic})]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"p-4 rounded-lg bg-muted/50 text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:k}),e.jsx("p",{className:"text-xs text-muted-foreground",children:l.assessments.likelihood})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-muted/50 text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:p}),e.jsx("p",{className:"text-xs text-muted-foreground",children:l.assessments.impact})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-primary/10 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-primary",children:ge}),e.jsx("div",{className:"mt-1 flex justify-center",children:e.jsx(ce,{status:E,children:g(E)})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"notes",children:l.assessments.notes}),e.jsx(dt,{id:"notes",value:b,onChange:A=>M(A.target.value),placeholder:l.assessments.notesPlaceholder,rows:4})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(y,{type:"button",variant:"outline",onClick:()=>s(-1),disabled:z,children:l.actions.cancel}),e.jsxs(y,{type:"submit",disabled:z,children:[z?e.jsx(ke,{className:h?"ml-2 h-4 w-4 animate-spin":"mr-2 h-4 w-4 animate-spin"}):e.jsx(Ye,{className:h?"ml-2 h-4 w-4":"mr-2 h-4 w-4"}),l.assessments.saveAssessment]})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:l.assessments.selectRiskHint}),U?e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(ke,{className:"h-4 w-4 animate-spin"})," ",l.assessments.loadingRisks]}):X.length===0?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:l.assessments.noRisksYet}),e.jsx(y,{onClick:()=>s("/risks/new"),children:l.assessments.createRisk})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:l.assessments.riskLabel}),e.jsxs(Re,{value:"",onValueChange:A=>a({riskId:A}),children:[e.jsx(Se,{children:e.jsx(Ae,{placeholder:l.assessments.selectRiskPlaceholder})}),e.jsx(Te,{children:X.map(A=>e.jsxs(te,{value:A.id,children:[A.id," — ",A.title," (",A.owner,")"]},A.id))})]})]})]})})]})]})},Wt=()=>({title:"",owner:"",dueDate:new Date().toISOString().slice(0,10),status:"Not Started",evidenceLink:""}),Jt=()=>{const{riskId:s}=Ct(),t=gs(),{toast:a}=Pe(),{can:r}=Ne(),{strings:i,isRTL:d}=ie(),l=new Date().toISOString().slice(0,10),h=F=>i.risks.statuses?.[F]??F,g=F=>i.risks.levels?.[F]??F,[L,f]=o.useState(!0),[x,k]=o.useState(null),[T,p]=o.useState([]),[N,m]=o.useState({}),[u,c]=o.useState(null),[j,b]=o.useState("Mitigate"),[M,z]=o.useState(!1),[S,X]=o.useState(!1),[ee,U]=o.useState(null),[H,_]=o.useState(Wt()),[B,J]=o.useState(!1),[oe,I]=o.useState(null),Z=o.useMemo(()=>!u||!u.actions||u.actions.length===0?0:u.actions.filter(F=>F.status!=="Done"&&F.dueDate<l).length,[u,l]),ue=o.useMemo(()=>{if(!u||!u.actions||u.actions.length===0)return 0;const F=u.actions.filter(C=>C.status==="Done").length;return Math.round(F/u.actions.length*100)},[u]),xe=F=>{switch(F){case"Mitigate":return i.treatments.approachMitigate;case"Transfer":return i.treatments.approachTransfer;case"Avoid":return i.treatments.approachAvoid;case"Accept":return i.treatments.approachAccept;default:return F}},ge=F=>{switch(F){case"Not Started":return i.treatments.statusNotStarted;case"In Progress":return i.treatments.statusInProgress;case"Done":return i.treatments.statusDone;default:return F}};o.useEffect(()=>{(async()=>{f(!0);try{if(!s){const[ae,ve]=await Promise.all([de.getAll(),Oe.getAll()]),we=[...ae].sort((Le,D)=>(D.score??0)-(Le.score??0));p(we);const Ie={};for(const Le of ve){const D=Ie[Le.riskId];if(!D){Ie[Le.riskId]=Le;continue}const ne=new Date(D.updatedAt??D.createdAt??0).getTime();new Date(Le.updatedAt??Le.createdAt??0).getTime()>=ne&&(Ie[Le.riskId]=Le)}m(Ie);return}const[C,q]=await Promise.all([de.getById(s),Oe.getByRiskId(s)]);if(!C){a({title:i.treatments.riskNotFoundTitle,description:i.treatments.riskNotFoundDesc,variant:"destructive"}),t("/risks");return}k(C);const w=Array.isArray(q)?q.length>0?q[0]:null:q;c(w),b(w?.approach??"Mitigate")}catch{a({title:i.treatments.failedToLoad,description:i.common.pleaseTryAgain,variant:"destructive"})}finally{f(!1)}})()},[s]);const E=async()=>{if(!s)return;const F=await Oe.getByRiskId(s),C=Array.isArray(F)?F.length>0?F[0]:null:F;c(C),b(C?.approach??j)},v=async()=>{if(s){if(u){if(!r("canEdit")){a({title:i.common.notAllowed,description:i.treatments.noEditPlanPermission,variant:"destructive"});return}}else if(!r("canCreate")){a({title:i.common.notAllowed,description:i.treatments.noCreatePermission,variant:"destructive"});return}z(!0);try{if(u){const F=await Oe.update(u.id,{approach:j});c(F),a({title:i.treatments.updated})}else{const F=await Oe.create({riskId:s,approach:j,actions:[]});c(F),a({title:i.treatments.created})}}catch{a({title:i.treatments.saveFailedTitle,description:i.treatments.saveFailedDesc,variant:"destructive"})}finally{z(!1)}}},A=()=>{U(null),_(Wt()),X(!0)},se=F=>{U(F),_({title:F.title,owner:F.owner,dueDate:F.dueDate,status:F.status,evidenceLink:F.evidenceLink||""}),X(!0)},le=async()=>{if(u){if(!r("canEdit")){a({title:i.common.notAllowed,description:i.treatments.noEditActionsPermission,variant:"destructive"});return}if(!H.title.trim()||!H.owner.trim()||!H.dueDate){a({title:i.treatments.missingFieldsTitle,description:i.treatments.missingFieldsDesc,variant:"destructive"});return}J(!0);try{ee?(await Oe.updateAction(u.id,ee.id,{title:H.title.trim(),owner:H.owner.trim(),dueDate:H.dueDate,status:H.status,evidenceLink:H.evidenceLink?.trim()||void 0}),a({title:i.treatments.actionUpdated})):(await Oe.addAction(u.id,{title:H.title.trim(),owner:H.owner.trim(),dueDate:H.dueDate,status:H.status,evidenceLink:H.evidenceLink?.trim()||void 0}),a({title:i.treatments.actionAdded})),X(!1),U(null),await E()}catch{a({title:i.treatments.saveFailedTitle,description:i.common.pleaseTryAgain,variant:"destructive"})}finally{J(!1)}}},je=async()=>{if(!(!u||!oe)){if(!r("canEdit")){a({title:i.common.notAllowed,description:i.treatments.noEditActionsPermission,variant:"destructive"});return}try{await Oe.removeAction(u.id,oe.id),a({title:i.treatments.actionRemoved}),I(null),await E()}catch{a({title:i.treatments.deleteFailedTitle,description:i.treatments.deleteFailedDesc,variant:"destructive"})}}},Fe=async(F,C)=>{if(u&&r("canEdit"))try{await Oe.updateAction(u.id,F.id,{status:C}),await E()}catch{a({title:i.treatments.updateFailedTitle,description:i.treatments.updateFailedDesc,variant:"destructive"})}};return e.jsx("div",{className:"space-y-6 animate-in",children:L?e.jsx(fe,{}):s?e.jsxs(e.Fragment,{children:[e.jsxs(y,{variant:"ghost",className:"w-fit",onClick:()=>t(-1),children:[e.jsx(rt,{className:d?"ml-2 h-4 w-4":"mr-2 h-4 w-4"})," ",i.actions.back]}),e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-start lg:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:i.treatments.planTitle}),e.jsx("p",{className:"text-sm text-muted-foreground",children:x?e.jsxs(e.Fragment,{children:[x.id," — ",x.title]}):s})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(y,{variant:"outline",asChild:!0,children:e.jsx(Q,{to:`/risks/${s}`,children:i.treatments.viewRisk})}),r(u?"canEdit":"canCreate")&&e.jsxs(y,{onClick:v,disabled:M,children:[M?e.jsx(ke,{className:d?"ml-2 h-4 w-4 animate-spin":"mr-2 h-4 w-4 animate-spin"}):e.jsx(Ye,{className:d?"ml-2 h-4 w-4":"mr-2 h-4 w-4"}),u?i.treatments.savePlan:i.treatments.createPlan]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(R,{className:"glass-card lg:col-span-1",children:[e.jsx(K,{children:e.jsx(Y,{className:"text-base",children:i.treatments.planSettings})}),e.jsxs(P,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:i.treatments.approach}),e.jsxs(Re,{value:j,onValueChange:F=>b(F),children:[e.jsx(Se,{children:e.jsx(Ae,{placeholder:i.treatments.selectApproach})}),e.jsx(Te,{children:fn.map(F=>e.jsx(te,{value:F,children:xe(F)},F))})]})]}),e.jsxs("div",{className:"p-4 rounded-lg border border-border bg-muted/30",children:[e.jsx("p",{className:"text-sm font-medium mb-1",children:i.treatments.progress}),e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsx("span",{className:"text-muted-foreground",children:i.treatments.completed}),e.jsxs("span",{className:"font-medium",children:[ue,"%"]})]}),e.jsx(Zs,{className:"h-2",value:ue})]}),!u&&e.jsx("p",{className:"text-sm text-muted-foreground",children:i.treatments.noPlanYet})]})]}),e.jsxs(R,{className:"glass-card lg:col-span-2",children:[e.jsxs(K,{className:"flex flex-row items-center justify-between",children:[e.jsx(Y,{className:"text-base",children:i.treatments.actionsTitle}),e.jsxs("div",{className:"flex items-center gap-2",children:[Z>0&&e.jsxs(pe,{variant:"secondary",className:"text-xs",children:[i.followup.overdue,": ",Z]}),u&&r("canEdit")&&e.jsxs(y,{size:"sm",onClick:A,children:[e.jsx(ze,{className:d?"ml-2 h-4 w-4":"mr-2 h-4 w-4"}),i.treatments.addAction]})]})]}),e.jsx(P,{children:u?!u.actions||u.actions.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:i.treatments.noActionsYet}):e.jsx("div",{className:"space-y-3",children:u.actions.map(F=>{const C=F.status!=="Done"&&F.dueDate<l;return e.jsx("div",{className:C?"p-4 rounded-lg border border-status-warning/30 bg-status-warning/5":"p-4 rounded-lg border border-border bg-muted/30",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:F.title}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[i.treatments.ownerPrefix," ",F.owner]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[i.treatments.duePrefix," ",F.dueDate]}),F.evidenceLink&&e.jsx("a",{href:F.evidenceLink,target:"_blank",rel:"noreferrer",className:"text-sm text-primary hover:underline",children:i.treatments.evidence})]}),e.jsxs("div",{className:"flex flex-col items-start sm:items-end gap-2",children:[r("canEdit")?e.jsxs(Re,{value:F.status,onValueChange:q=>Fe(F,q),children:[e.jsx(Se,{className:"w-[180px]",children:e.jsx(Ae,{})}),e.jsx(Te,{children:Vt.map(q=>e.jsx(te,{value:q,children:ge(q)},q))})]}):e.jsx(ce,{status:F.status,children:ge(F.status)}),r("canEdit")&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(y,{size:"sm",variant:"outline",onClick:()=>se(F),children:[e.jsx(it,{className:d?"ml-2 h-4 w-4":"mr-2 h-4 w-4"}),i.actions.edit]}),e.jsxs(y,{size:"sm",variant:"destructive",onClick:()=>I(F),children:[e.jsx(ns,{className:d?"ml-2 h-4 w-4":"mr-2 h-4 w-4"}),i.actions.delete]})]})]})]})},F.id)})}):e.jsx("p",{className:"text-sm text-muted-foreground",children:i.treatments.createPlanToStartActions})})]})]}),e.jsx(ds,{open:S,onOpenChange:X,children:e.jsxs(ts,{className:"sm:max-w-lg",children:[e.jsxs(as,{children:[e.jsx(rs,{children:ee?i.treatments.editAction:i.treatments.addActionDialog}),e.jsx(is,{children:i.treatments.actionDialogDesc})]}),e.jsxs("div",{className:"grid gap-4 py-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"title",children:i.treatments.fieldTitle}),e.jsx(G,{id:"title",value:H.title,onChange:F=>_(C=>({...C,title:F.target.value})),placeholder:i.treatments.placeholderActionTitle})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"owner",children:i.treatments.fieldOwner}),e.jsx(G,{id:"owner",value:H.owner,onChange:F=>_(C=>({...C,owner:F.target.value})),placeholder:i.treatments.placeholderOwner})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"dueDate",children:i.treatments.fieldDueDate}),e.jsx(G,{id:"dueDate",type:"date",value:H.dueDate,onChange:F=>_(C=>({...C,dueDate:F.target.value}))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:i.treatments.fieldStatus}),e.jsxs(Re,{value:H.status,onValueChange:F=>_(C=>({...C,status:F})),children:[e.jsx(Se,{children:e.jsx(Ae,{})}),e.jsx(Te,{children:Vt.map(F=>e.jsx(te,{value:F,children:ge(F)},F))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"evidence",children:i.treatments.fieldEvidence}),e.jsx(G,{id:"evidence",value:H.evidenceLink||"",onChange:F=>_(C=>({...C,evidenceLink:F.target.value})),placeholder:i.treatments.placeholderEvidence})]})]})]}),e.jsxs(js,{children:[e.jsx(y,{variant:"outline",type:"button",onClick:()=>X(!1),disabled:B,children:i.actions.cancel}),e.jsxs(y,{type:"button",onClick:le,disabled:B,children:[B?e.jsx(ke,{className:d?"ml-2 h-4 w-4 animate-spin":"mr-2 h-4 w-4 animate-spin"}):e.jsx(Ye,{className:d?"ml-2 h-4 w-4":"mr-2 h-4 w-4"}),i.actions.save]})]})]})}),e.jsx(Xe,{open:!!oe,onOpenChange:F=>F?void 0:I(null),children:e.jsxs(_e,{children:[e.jsxs(Be,{children:[e.jsx(Ve,{children:i.treatments.deleteActionTitle}),e.jsx(He,{children:i.treatments.deleteActionDesc})]}),e.jsxs(Ue,{children:[e.jsx(Ke,{children:i.actions.cancel}),e.jsx(qe,{onClick:je,children:i.actions.delete})]})]})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center justify-between gap-4",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:i.treatments.plansTitle}),e.jsx("p",{className:"text-sm text-muted-foreground",children:i.treatments.plansSubtitle})]})}),T.length===0?e.jsx(R,{className:"glass-card",children:e.jsx(P,{className:"p-6",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:i.treatments.noRisksFound})})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4",children:T.map(F=>{const C=N[F.id],q=new Date().toISOString().slice(0,10),w=C?.actions?.length??0,ae=C?C.actions.filter(Ie=>Ie.status==="Done").length:0,ve=C?C.actions.filter(Ie=>Ie.status!=="Done"&&Ie.dueDate<q).length:0,we=w===0?0:Math.round(ae/w*100);return e.jsxs(R,{className:"glass-card",children:[e.jsxs(K,{className:"pb-2",children:[e.jsx(Y,{className:"text-base",children:F.title}),e.jsx("p",{className:"text-xs text-muted-foreground",children:F.id})]}),e.jsxs(P,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{status:F.level,children:g(F.level)}),e.jsx(ce,{status:F.status,children:h(F.status)})]}),C?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-muted-foreground",children:i.treatments.progress}),e.jsxs("span",{className:"font-medium",children:[we,"%"]})]}),e.jsx(Zs,{className:"h-2",value:we}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(pe,{variant:"secondary",className:"text-xs",children:[i.treatments.completed,": ",ae,"/",w]}),ve>0&&e.jsxs(pe,{variant:"secondary",className:"text-xs",children:[i.followup.overdue,": ",ve]}),e.jsxs(pe,{variant:"outline",className:"text-xs",children:[i.treatments.approach,":"," ",xe(C.approach)]})]})]}):e.jsx("p",{className:"text-xs text-muted-foreground",children:i.risks.details.noTreatmentPlan}),e.jsx(y,{asChild:!0,variant:"outline",className:"w-full",children:e.jsx(Q,{to:`/treatments/${F.id}`,children:i.treatments.managePlan})})]})]},F.id)})})]})})},Gt=()=>({name:"",criticality:"Medium",rto:"",rpo:"",dependencies:[],owner:""}),Fl=()=>{const{toast:s}=Pe(),{can:t}=Ne(),{strings:a,isRTL:r}=ie(),[i,d]=o.useState(!0),[l,h]=o.useState([]),[g,L]=o.useState(""),[f,x]=o.useState(!1),[k,T]=o.useState("add"),[p,N]=o.useState(null),[m,u]=o.useState(Gt()),[c,j]=o.useState(""),[b,M]=o.useState(!1),[z,S]=o.useState(null),X=async()=>{const I=await he.getServices();h(I)};o.useEffect(()=>{(async()=>{d(!0);try{await X()}catch{s({title:a.bcp.failedToLoadServices,description:a.common.pleaseTryAgain,variant:"destructive"})}finally{d(!1)}})()},[]);const ee=o.useMemo(()=>{if(!g.trim())return l;const I=g.toLowerCase();return l.filter(Z=>Z.name.toLowerCase().includes(I)||Z.owner.toLowerCase().includes(I)||Z.criticality.toLowerCase().includes(I))},[l,g]),U=()=>{T("add"),N(null),u(Gt()),j(""),x(!0)},H=I=>{T("edit"),N(I),u({name:I.name,criticality:I.criticality,rto:I.rto,rpo:I.rpo,dependencies:I.dependencies,owner:I.owner}),j(I.dependencies.join(", ")),x(!0)},_=I=>{T("view"),N(I),u({name:I.name,criticality:I.criticality,rto:I.rto,rpo:I.rpo,dependencies:I.dependencies,owner:I.owner}),j(I.dependencies.join(", ")),x(!0)},B=I=>I.split(",").map(Z=>Z.trim()).filter(Boolean),J=async()=>{if(k==="view"){x(!1);return}if(!m.name.trim()||!m.owner.trim()||!m.rto.trim()||!m.rpo.trim()){s({title:a.bcp.missingFieldsTitle,description:a.bcp.missingFieldsDesc,variant:"destructive"});return}if(p){if(!t("canEdit")){s({title:a.common.notAllowed,description:a.bcp.noPermissionEdit,variant:"destructive"});return}}else if(!t("canCreate")){s({title:a.common.notAllowed,description:a.bcp.noPermissionCreate,variant:"destructive"});return}M(!0);try{const I=B(c);p?(await he.updateService(p.id,{...m,dependencies:I}),s({title:a.bcp.serviceUpdated})):(await he.createService({...m,dependencies:I}),s({title:a.bcp.serviceCreated})),x(!1),await X()}catch{s({title:a.bcp.saveFailedTitle,description:a.common.pleaseTryAgain,variant:"destructive"})}finally{M(!1)}},oe=async()=>{if(z){if(!t("canDelete")){s({title:a.common.notAllowed,description:a.bcp.noPermissionDelete,variant:"destructive"});return}try{await he.deleteService(z.id),s({title:a.bcp.serviceDeleted}),S(null),await X()}catch{s({title:a.bcp.deleteFailedTitle,description:a.common.pleaseTryAgain,variant:"destructive"})}}};return i?e.jsx(fe,{}):e.jsxs("div",{className:"space-y-6 animate-in",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-end sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:a.bcp.servicesTitle}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a.bcp.servicesSubtitle})]}),e.jsxs("div",{className:n("flex gap-2",r?"sm:flex-row-reverse":""),children:[e.jsx(G,{value:g,onChange:I=>L(I.target.value),placeholder:a.bcp.searchPlaceholder,className:"sm:w-[260px]"}),t("canCreate")&&e.jsxs(y,{onClick:U,children:[e.jsx(ze,{className:r?"ml-2 h-4 w-4":"mr-2 h-4 w-4"}),a.actions.add]})]})]}),ee.length===0?e.jsx(R,{className:"glass-card",children:e.jsx(P,{className:"p-6",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:a.bcp.noServicesFound})})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4",children:ee.map(I=>e.jsx(R,{className:"glass-card",children:e.jsxs(P,{className:"p-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:n("absolute top-0",r?"right-0":"left-0"),children:e.jsx(ce,{status:I.criticality,children:I.criticality==="Critical"?a.bcp.criticalityCritical:I.criticality==="High"?a.bcp.criticalityHigh:I.criticality==="Medium"?a.bcp.criticalityMedium:a.bcp.criticalityLow})}),(t("canEdit")||t("canDelete"))&&e.jsxs("div",{className:n("absolute top-0 flex items-center gap-1",r?"left-0":"right-0"),children:[t("canEdit")&&e.jsx(y,{size:"icon",variant:"ghost",onClick:()=>H(I),"aria-label":a.actions.edit,children:e.jsx(it,{className:"h-4 w-4"})}),t("canDelete")&&e.jsx(y,{size:"icon",variant:"ghost",onClick:()=>S(I),"aria-label":a.actions.delete,children:e.jsx(ns,{className:"h-4 w-4 text-destructive"})})]}),e.jsxs("div",{className:"text-center px-12",children:[e.jsx("p",{className:"text-base font-semibold leading-snug",children:I.name}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:a.bcp.serviceCardHint})]})]}),e.jsxs("div",{className:"mt-6 flex items-center justify-between gap-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"RPO"}),e.jsx(ws,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:I.rpo})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"RTO"}),e.jsx(ws,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:I.rto})]})]}),e.jsxs("div",{className:"mt-5 space-y-3",children:[e.jsxs("div",{className:n("flex items-center justify-between gap-3",r?"flex-row-reverse":""),children:[e.jsxs("div",{className:n("flex items-center gap-2 text-xs text-muted-foreground",r?"flex-row-reverse":""),children:[e.jsx(Dt,{className:"h-4 w-4"}),e.jsx("span",{children:a.bcp.ownerPrefix})]}),e.jsx("span",{className:n("text-sm font-medium truncate",r?"text-left":"text-right"),children:I.owner})]}),e.jsxs("div",{className:n("flex items-center justify-between gap-3",r?"flex-row-reverse":""),children:[e.jsxs("div",{className:n("flex items-center gap-2 text-xs text-muted-foreground",r?"flex-row-reverse":""),children:[e.jsx(Ei,{className:"h-4 w-4"}),e.jsx("span",{children:a.bcp.depsPrefix})]}),e.jsx("span",{className:n("text-sm font-medium",r?"text-left":"text-right"),children:a.bcp.depsCount.replace("{count}",String(I.dependencies.length))})]})]}),e.jsx(y,{variant:"secondary",className:"w-full mt-6",onClick:()=>_(I),children:a.bcp.viewDetails})]})},I.id))}),e.jsx(ds,{open:f,onOpenChange:x,children:e.jsxs(ts,{className:"sm:max-w-xl",children:[e.jsxs(as,{children:[e.jsx(rs,{children:k==="view"?a.bcp.serviceDetailsTitle:p?a.bcp.editService:a.bcp.addService}),e.jsx(is,{children:a.bcp.dialogDesc})]}),e.jsxs("div",{className:"grid gap-4 py-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"name",children:a.bcp.serviceName}),e.jsx(G,{id:"name",value:m.name,onChange:I=>u(Z=>({...Z,name:I.target.value})),placeholder:a.bcp.enterServiceName,disabled:k==="view"||b})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:a.bcp.criticality}),e.jsxs(Re,{value:m.criticality,onValueChange:I=>u(Z=>({...Z,criticality:I})),disabled:k==="view"||b,children:[e.jsx(Se,{children:e.jsx(Ae,{})}),e.jsxs(Te,{children:[e.jsx(te,{value:"Critical",children:a.bcp.criticalityCritical}),e.jsx(te,{value:"High",children:a.bcp.criticalityHigh}),e.jsx(te,{value:"Medium",children:a.bcp.criticalityMedium}),e.jsx(te,{value:"Low",children:a.bcp.criticalityLow})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"owner",children:a.bcp.owner}),e.jsx(G,{id:"owner",value:m.owner,onChange:I=>u(Z=>({...Z,owner:I.target.value})),placeholder:a.bcp.enterOwner,disabled:k==="view"||b})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"rto",children:"RTO"}),e.jsx(G,{id:"rto",value:m.rto,onChange:I=>u(Z=>({...Z,rto:I.target.value})),placeholder:a.bcp.rtoPlaceholder,disabled:k==="view"||b})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"rpo",children:"RPO"}),e.jsx(G,{id:"rpo",value:m.rpo,onChange:I=>u(Z=>({...Z,rpo:I.target.value})),placeholder:a.bcp.rpoPlaceholder,disabled:k==="view"||b})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"deps",children:a.bcp.dependenciesLabel}),e.jsx(G,{id:"deps",value:c,onChange:I=>j(I.target.value),placeholder:a.bcp.dependenciesPlaceholder,disabled:k==="view"||b})]})]}),e.jsxs(js,{children:[e.jsx(y,{variant:"outline",onClick:()=>x(!1),disabled:b,children:k==="view"?a.actions.back:a.actions.cancel}),k!=="view"&&e.jsxs(y,{onClick:J,disabled:b,children:[b?e.jsx(ke,{className:r?"ml-2 h-4 w-4 animate-spin":"mr-2 h-4 w-4 animate-spin"}):null,a.actions.save]})]})]})}),e.jsx(Xe,{open:!!z,onOpenChange:I=>I?void 0:S(null),children:e.jsxs(_e,{children:[e.jsxs(Be,{children:[e.jsx(Ve,{children:a.bcp.deleteServiceTitle}),e.jsx(He,{children:a.bcp.deleteServiceDesc})]}),e.jsxs(Ue,{children:[e.jsx(Ke,{children:a.actions.cancel}),e.jsx(qe,{onClick:oe,children:a.actions.delete})]})]})})]})},Ol=s=>s==="Active"?"bg-status-high/15 text-status-high":s==="Draft"?"bg-muted/40 text-muted-foreground":s==="In Review"?"bg-status-warning/15 text-status-warning":s==="Archived"?"bg-muted/30 text-muted-foreground":"bg-muted/40 text-muted-foreground",Ml=()=>{const{toast:s}=Pe(),{can:t}=Ne(),{strings:a,isRTL:r}=ie(),[i,d]=o.useState(!0),[l,h]=o.useState(null),[g,L]=o.useState(!1),f=t("canEdit"),x=async()=>{const c=await he.getBCPlan();h(c)};o.useEffect(()=>{(async()=>{d(!0);try{await x()}catch{s({title:a.bcp.failedToLoadPlan,description:a.common.pleaseTryAgain,variant:"destructive"})}finally{d(!1)}})()},[]);const k=o.useMemo(()=>l?[...l.sections]:[],[l]),T=c=>{h(j=>j&&{...j,...c})},p=(c,j)=>{h(b=>{if(!b)return b;const M=[...b.sections];return M[c]=j,{...b,sections:M}})},N=()=>{h(c=>c&&{...c,sections:[...c.sections,a.bcp.newSection]})},m=c=>{h(j=>j&&{...j,sections:j.sections.filter((b,M)=>M!==c)})},u=async()=>{if(l){if(!f){s({title:a.common.notAllowed,description:a.bcp.noPermissionEdit,variant:"destructive"});return}L(!0);try{await he.updateBCPlan({lastUpdated:new Date().toISOString().slice(0,10),status:l.status,sections:l.sections.map(c=>c.trim()).filter(Boolean)}),s({title:a.bcp.planSaved}),await x()}catch{s({title:a.bcp.saveFailedTitle,description:a.common.pleaseTryAgain,variant:"destructive"})}finally{L(!1)}}};return i?e.jsx(fe,{}):l?e.jsxs("div",{className:"space-y-6 animate-in",children:[e.jsxs("div",{className:n("flex items-start justify-between gap-4",r?"flex-row-reverse":""),children:[e.jsxs("div",{className:n(r?"text-right":"text-left"),children:[e.jsx("h1",{className:"text-2xl font-bold",children:a.bcp.planTitle}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a.bcp.planSubtitle}),e.jsxs("div",{className:n("mt-3 flex items-center gap-3",r?"flex-row-reverse":""),children:[e.jsxs(pe,{variant:"secondary",className:n("gap-2 hover:bg-inherit",Ol(l.status)),children:[e.jsx("span",{className:n("h-1.5 w-1.5 rounded-full",l.status==="Active"?"bg-status-high":l.status==="In Review"?"bg-status-warning":"bg-muted-foreground")}),e.jsx("span",{children:l.status==="Active"?a.bcp.statusActive:l.status==="Draft"?a.bcp.statusDraft:l.status==="In Review"?a.bcp.statusInReview:l.status==="Archived"?a.bcp.statusArchived:l.status})]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[a.bcp.lastUpdated,": ",l.lastUpdated]})]})]}),f&&e.jsxs(y,{onClick:u,disabled:g,variant:"secondary",className:"rounded-full px-5",children:[g?e.jsx(ke,{className:r?"ml-2 h-4 w-4 animate-spin":"mr-2 h-4 w-4 animate-spin"}):e.jsx(Ye,{className:r?"ml-2 h-4 w-4":"mr-2 h-4 w-4"}),a.actions.save]})]}),e.jsxs(R,{className:"glass-card",children:[e.jsx(K,{children:e.jsx(Y,{className:"text-base",children:a.bcp.planDetails})}),e.jsx(P,{className:"grid gap-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:n("rounded-lg border bg-background/50 p-4",r?"text-right":"text-left"),children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{className:"text-xs text-muted-foreground",children:a.bcp.status}),e.jsxs(Re,{value:l.status,onValueChange:c=>T({status:c}),disabled:!f,children:[e.jsx(Se,{children:e.jsx(Ae,{})}),e.jsxs(Te,{children:[e.jsx(te,{value:"Active",children:a.bcp.statusActive}),e.jsx(te,{value:"Draft",children:a.bcp.statusDraft}),e.jsx(te,{value:"In Review",children:a.bcp.statusInReview}),e.jsx(te,{value:"Archived",children:a.bcp.statusArchived})]})]})]})}),e.jsx("div",{className:n("rounded-lg border bg-background/50 p-4",r?"text-right":"text-left"),children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"lastUpdated",className:"text-xs text-muted-foreground",children:a.bcp.lastUpdated}),e.jsx(G,{id:"lastUpdated",value:l.lastUpdated,readOnly:!0,className:n(r?"text-right":"text-left")})]})})]})})]}),e.jsxs(R,{className:"glass-card",children:[e.jsxs(K,{className:n("flex flex-row items-center justify-between gap-4",r?"flex-row-reverse":""),children:[e.jsx(Y,{className:"text-base",children:a.bcp.sections}),f&&e.jsxs(y,{variant:"secondary",onClick:N,className:"rounded-full",children:[e.jsx(ze,{className:r?"ml-2 h-4 w-4":"mr-2 h-4 w-4"}),a.bcp.addSection]})]}),e.jsx(P,{children:k.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:a.bcp.noSectionsYet}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:k.map((c,j)=>{const b=`bcp-section-${j}`;return e.jsxs("div",{className:"relative rounded-lg border bg-background/50 p-5 pt-12 min-h-[150px]",children:[e.jsxs(pe,{variant:"secondary",className:n("absolute top-4 gap-2 hover:bg-inherit",r?"right-4":"left-4"),children:[e.jsx("span",{className:"h-1.5 w-1.5 rounded-full bg-primary/70"}),e.jsxs("span",{children:[a.bcp.section," ",j+1]})]}),f&&e.jsx(y,{variant:"ghost",size:"icon",onClick:()=>m(j),"aria-label":a.bcp.remove,className:n("absolute top-3 text-destructive hover:text-destructive",r?"left-3":"right-3"),children:e.jsx(ns,{className:"h-4 w-4"})}),e.jsxs("div",{className:n("space-y-2",r?"text-right":"text-left"),children:[e.jsx(V,{htmlFor:b,className:"text-xs text-muted-foreground",children:a.bcp.section}),e.jsx(G,{id:b,value:c,onChange:M=>p(j,M.target.value),disabled:!f,className:n("bg-background/60",r?"text-right":"text-left")})]})]},`${j}-${c}`)})})})]})]}):e.jsxs("div",{className:"space-y-6 animate-in",children:[e.jsx("h1",{className:"text-2xl font-bold",children:a.bcp.planTitle}),e.jsx(R,{className:"glass-card",children:e.jsx(P,{className:"p-6",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:a.bcp.noPlanData})})})]})},mt=o.forwardRef(({className:s,...t},a)=>e.jsx(nr,{ref:a,className:n("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),...t,children:e.jsx(Fi,{className:n("flex items-center justify-center text-current"),children:e.jsx(at,{className:"h-4 w-4"})})}));mt.displayName=nr.displayName;const $l="riskms_dr_target_links_v1",St="riskms_dr_target_links_v2",_l=s=>{try{const t=localStorage.getItem($l);if(!t)return Array.from({length:s},()=>[]);const a=JSON.parse(t);if(!Array.isArray(a))return Array.from({length:s},()=>[]);const i=a.map(d=>Array.isArray(d)?d.filter(l=>typeof l=="string"&&l.trim().length>0):[]).slice(0,s);for(;i.length<s;)i.push([]);return i}catch{return Array.from({length:s},()=>[])}},Qt=s=>{const t=new Set(s.map(r=>r.id)),a=()=>Object.fromEntries(s.map(r=>[r.id,[]]));try{const r=localStorage.getItem(St);if(r){const l=JSON.parse(r);if(l&&typeof l=="object"){const h=l,g={};for(const L of s){const f=h[L.id];g[L.id]=Array.isArray(f)?f.filter(x=>typeof x=="string"&&x.trim().length>0):[]}return g}}const i=_l(s.length),d={};s.forEach((l,h)=>{d[l.id]=Array.isArray(i[h])?i[h]:[]});try{localStorage.setItem(St,JSON.stringify(d))}catch{}for(const l of Object.keys(d))t.has(l)||delete d[l];for(const l of s)Array.isArray(d[l.id])||(d[l.id]=[]);return d}catch{return a()}},Ss=s=>{try{localStorage.setItem(St,JSON.stringify(s))}catch{}},Bl=s=>{const t=new Date(s);return!Number.isNaN(t.getTime())},Ul=(s,t)=>{const a=s.filter(r=>r.type===t&&r.status!=="Planned"&&Bl(r.date)).map(r=>new Date(r.date)).filter(r=>!Number.isNaN(r.getTime()));return a.length===0?"-":new Date(Math.max(...a.map(r=>r.getTime()))).toISOString().slice(0,10)},Vl=()=>{const{toast:s}=Pe(),{can:t}=Ne(),{strings:a,isRTL:r}=ie(),[i,d]=o.useState(!0),[l,h]=o.useState(null),[g,L]=o.useState([]),[f,x]=o.useState([]),[k,T]=o.useState({}),[p,N]=o.useState(null),[m,u]=o.useState(!1),[c,j]=o.useState(!1),[b,M]=o.useState(""),[z,S]=o.useState(""),[X,ee]=o.useState([]),[U,H]=o.useState(!1),_=t("canEdit"),B=async()=>{const[C,q,w]=await Promise.all([he.getDRPlan(),he.getTests?.()??Promise.resolve([]),he.getServices?.()??Promise.resolve([])]);h(C),L(Array.isArray(q)?q:[]),x(Array.isArray(w)?w:[]);const ae=Array.isArray(C?.sites)?C.sites:[];T(Qt(ae))};o.useEffect(()=>{(async()=>{d(!0);try{await B()}catch{s({title:a.bcp.failedToLoadDrPlan,description:a.common.pleaseTryAgain,variant:"destructive"})}finally{d(!1)}})()},[]);const J=async()=>{if(l){if(!_){s({title:a.common.notAllowed,description:a.bcp.noPermissionEdit,variant:"destructive"});return}try{const C=(()=>{let w=0;for(const ae of l.sites??[]){const ve=/^DR-(\d+)$/.exec(ae.id);if(ve){const we=Number(ve[1]);Number.isFinite(we)&&(w=Math.max(w,we))}}return`DR-${String(w+1).padStart(3,"0")}`})(),q=await he.updateDRPlan({lastUpdated:new Date().toISOString().slice(0,10),sites:[...l.sites,{id:C,name:a.bcp.newTarget}]});h(q),T(w=>{const ae={...w,[C]:w[C]??[]};return Ss(ae),ae}),s({title:a.bcp.drPlanSaved})}catch{s({title:a.bcp.saveFailedTitle,description:a.common.pleaseTryAgain,variant:"destructive"})}}},oe=()=>{if(!l)return;if(!_){s({title:a.common.notAllowed,description:a.bcp.noPermissionEdit,variant:"destructive"});return}M(l.rto??""),S(l.rpo??""),ee([...l.sites??[]]);const C=Qt(l.sites??[]);T(C),j(!0)},I=(C,q)=>{ee(w=>w.map(ae=>ae.id===C?{...ae,name:q}:ae))},Z=C=>{ee(q=>q.filter(w=>w.id!==C)),T(q=>{const w={...q};return delete w[C],Ss(w),w})},ue=C=>{let q=0;for(const w of C){const ae=/^DR-(\d+)$/.exec(w.id);if(ae){const ve=Number(ae[1]);Number.isFinite(ve)&&(q=Math.max(q,ve))}}return`DR-${String(q+1).padStart(3,"0")}`},xe=()=>{const C=ue(X);ee(q=>[...q,{id:C,name:a.bcp.newTarget}]),T(q=>{const w={...q,[C]:q[C]??[]};return Ss(w),w})},ge=async()=>{if(!l)return;if(!_){s({title:a.common.notAllowed,description:a.bcp.noPermissionEdit,variant:"destructive"});return}const C=X.map(q=>({id:q.id.trim(),name:q.name.trim()})).filter(q=>q.id.length>0&&q.name.length>0);if(C.length===0){s({title:a.bcp.saveFailedTitle,description:a.bcp.noSites,variant:"destructive"});return}H(!0);try{const q={};for(const ae of C)q[ae.id]=Array.isArray(k[ae.id])?k[ae.id]:[];const w=await he.updateDRPlan({lastUpdated:new Date().toISOString().slice(0,10),rto:b.trim()||l.rto,rpo:z.trim()||l.rpo,sites:C});h(w),T(q),Ss(q),j(!1),s({title:a.bcp.drPlanSaved})}catch{s({title:a.bcp.saveFailedTitle,description:a.common.pleaseTryAgain,variant:"destructive"})}finally{H(!1)}};if(i)return e.jsx(fe,{});if(!l)return e.jsxs("div",{className:"space-y-6 animate-in",children:[e.jsx("h1",{className:"text-2xl font-bold",children:a.bcp.drTitle}),e.jsx(R,{className:"glass-card",children:e.jsx(P,{className:"p-6",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:a.bcp.noPlanData})})})]});const E=Ul(g,"DR"),v=(l.sites??[]).map((C,q)=>{const w=q===1?"Active":"Ready";return{id:C.id,name:C.name,status:w}}),A=p?v.find(C=>C.id===p):void 0,se=A?k[A.id]??[]:[],le=se.map(C=>f.find(q=>q.id===C)).filter(C=>!!C),je=(C,q,w)=>{T(ae=>{const ve={...ae},we=new Set(ve[C]??[]);return w?we.add(q):we.delete(q),ve[C]=Array.from(we),Ss(ve),ve})},Fe=C=>C==="Ready"?{className:"bg-status-high/15 text-status-high",dot:"bg-status-high",label:a.bcp.statusReady}:{className:"bg-primary/15 text-primary",dot:"bg-primary",label:a.bcp.statusActive},F=C=>{const ae=r?["1 ساعة","2 ساعة","4 ساعات"]:["1 hour","2 hours","4 hours"];return ae[C%ae.length]};return e.jsxs("div",{className:"space-y-6 animate-in",children:[e.jsxs("div",{className:n("flex items-start justify-between gap-4",r?"flex-row-reverse":""),children:[e.jsxs("div",{className:n(r?"text-right":"text-left"),children:[e.jsx("h1",{className:"text-2xl font-bold",children:a.bcp.drTitle}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a.bcp.drSubtitle})]}),_&&e.jsxs("div",{className:n("flex items-center gap-2",r?"flex-row-reverse":""),children:[e.jsxs(y,{onClick:oe,variant:"secondary",className:"rounded-full px-5",children:[e.jsx(Ye,{className:r?"ml-2 h-4 w-4":"mr-2 h-4 w-4"}),a.bcp.editDrPlan]}),e.jsxs(y,{onClick:J,variant:"secondary",className:"rounded-full px-5",children:[e.jsx(ze,{className:r?"ml-2 h-4 w-4":"mr-2 h-4 w-4"}),a.bcp.addTarget]})]})]}),v.length===0?e.jsx(R,{className:"glass-card",children:e.jsx(P,{className:"p-6",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:a.bcp.noSites})})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4",children:v.map((C,q)=>{const w=Fe(C.status);return e.jsx(R,{className:"glass-card",children:e.jsxs(P,{className:"p-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:n("absolute top-0",r?"right-0":"left-0"),children:e.jsxs(pe,{variant:"secondary",className:n("gap-2 hover:bg-inherit",w.className),children:[e.jsx("span",{className:n("h-1.5 w-1.5 rounded-full",w.dot)}),e.jsx("span",{children:w.label})]})}),e.jsxs("div",{className:n("text-center px-10",r?"text-right":"text-left"),children:[e.jsx("p",{className:"text-base font-semibold leading-snug",children:C.name}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:C.id})]})]}),e.jsxs("div",{className:"mt-6 flex items-center justify-between gap-6",children:[e.jsxs("div",{className:n("flex items-center gap-2",r?"flex-row-reverse":""),children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:a.bcp.lastTest}),e.jsx(hs,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:E})]}),e.jsxs("div",{className:n("flex items-center gap-2",r?"flex-row-reverse":""),children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"RTO"}),e.jsx(ws,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:F(q)})]})]}),e.jsx(y,{variant:"secondary",className:"w-full mt-6",onClick:()=>{N(C.id),u(!0)},children:a.bcp.viewDetails})]})},C.id)})}),e.jsx(ds,{open:m,onOpenChange:u,children:e.jsxs(ts,{className:"sm:max-w-xl",children:[e.jsxs(as,{children:[e.jsx(rs,{children:a.bcp.targetDetailsTitle}),e.jsx(is,{children:a.bcp.targetDetailsSubtitle})]}),A?e.jsxs("div",{className:"grid gap-4 py-2",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:n("rounded-lg border bg-background/50 p-4",r?"text-right":"text-left"),children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:a.bcp.targetName}),e.jsx("div",{className:"mt-1 font-medium",children:A.name})]}),e.jsxs("div",{className:n("rounded-lg border bg-background/50 p-4",r?"text-right":"text-left"),children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:a.bcp.targetId}),e.jsx("div",{className:"mt-1 font-medium",children:A.id})]}),e.jsxs("div",{className:n("rounded-lg border bg-background/50 p-4",r?"text-right":"text-left"),children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:a.bcp.targetStatus}),e.jsx("div",{className:"mt-2",children:(()=>{const C=Fe(A.status);return e.jsxs(pe,{variant:"secondary",className:n("gap-2 hover:bg-inherit",C.className),children:[e.jsx("span",{className:n("h-1.5 w-1.5 rounded-full",C.dot)}),e.jsx("span",{children:C.label})]})})()})]}),e.jsxs("div",{className:n("rounded-lg border bg-background/50 p-4",r?"text-right":"text-left"),children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:a.bcp.lastTest}),e.jsx("div",{className:"mt-1 font-medium",children:E})]})]}),e.jsxs("div",{className:"rounded-lg border bg-background/50 p-4",children:[e.jsxs("div",{className:n("flex items-center justify-between gap-3",r?"flex-row-reverse":""),children:[e.jsx("div",{className:"text-sm font-semibold",children:a.bcp.linkedServices}),e.jsx("div",{className:"text-xs text-muted-foreground",children:a.bcp.linkedCount.replace("{count}",String(le.length))})]}),le.length===0?e.jsx("div",{className:"mt-3 text-sm text-muted-foreground",children:a.bcp.noLinkedServices}):e.jsx("div",{className:"mt-3 space-y-2",children:le.map(C=>e.jsxs("div",{className:n("flex items-center justify-between gap-3",r?"flex-row-reverse":""),children:[e.jsxs("div",{className:n("flex items-center gap-2",r?"flex-row-reverse":""),children:[e.jsx("span",{className:"h-1.5 w-1.5 rounded-sm bg-primary/70"}),e.jsx("span",{className:"text-sm font-medium",children:C.name})]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:C.id})]},C.id))}),_&&A?e.jsxs("div",{className:"mt-4 border-t pt-4",children:[e.jsxs("div",{className:n("flex items-center justify-between gap-3",r?"flex-row-reverse":""),children:[e.jsx("div",{className:"text-sm font-semibold",children:a.actions.edit}),e.jsx("div",{className:"text-xs text-muted-foreground",children:a.bcp.linkedCount.replace("{count}",String(se.length))})]}),f.length===0?e.jsx("div",{className:"mt-3 text-sm text-muted-foreground",children:a.bcp.noLinkedServices}):e.jsx("div",{className:"mt-3 max-h-40 overflow-auto rounded-md border bg-background/50 p-3 space-y-2",children:f.slice().sort((C,q)=>C.name.localeCompare(q.name)).map(C=>{const q=se.includes(C.id);return e.jsxs("label",{className:n("flex items-center justify-between gap-3 text-sm",r?"flex-row-reverse":""),children:[e.jsxs("div",{className:n("flex items-center gap-2",r?"flex-row-reverse":""),children:[e.jsx(mt,{checked:q,onCheckedChange:w=>je(A.id,C.id,w===!0)}),e.jsx("span",{className:"font-medium",children:C.name})]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:C.id})]},C.id)})})]}):null]})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"—"})]})}),e.jsx(ds,{open:c,onOpenChange:C=>{j(C),C||(M(""),S(""),ee([]))},children:e.jsxs(ts,{className:"sm:max-w-2xl",children:[e.jsxs(as,{children:[e.jsx(rs,{children:a.bcp.editDrPlan}),e.jsx(is,{children:a.bcp.drSubtitle})]}),e.jsxs("div",{className:"grid gap-4 py-2",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"dr-rto",children:"RTO"}),e.jsx(G,{id:"dr-rto",value:b,onChange:C=>M(C.target.value),disabled:U})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"dr-rpo",children:"RPO"}),e.jsx(G,{id:"dr-rpo",value:z,onChange:C=>S(C.target.value),disabled:U})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:n("flex items-center justify-between gap-3",r?"flex-row-reverse":""),children:[e.jsx(V,{children:a.bcp.sites}),e.jsxs(y,{variant:"secondary",onClick:xe,disabled:U,children:[e.jsx(ze,{className:r?"ml-2 h-4 w-4":"mr-2 h-4 w-4"}),a.actions.add]})]}),X.length===0?e.jsx("p",{className:n("text-sm text-muted-foreground",r?"text-right":"text-left"),children:a.bcp.noSites}):e.jsx("div",{className:"space-y-2",children:X.map((C,q)=>e.jsxs("div",{className:n("flex items-center gap-2",r?"flex-row-reverse":""),children:[e.jsx(G,{value:C.name,onChange:w=>I(C.id,w.target.value),disabled:U,className:n(r?"text-right":"text-left")}),e.jsx(y,{size:"icon",variant:"ghost",onClick:()=>Z(C.id),disabled:U,"aria-label":a.actions.delete,children:e.jsx(ns,{className:"h-4 w-4 text-destructive"})})]},C.id))})]})]}),e.jsxs("div",{className:n("flex items-center justify-end gap-2",r?"flex-row-reverse":""),children:[e.jsx(y,{variant:"outline",onClick:()=>j(!1),disabled:U,children:a.actions.cancel}),e.jsxs(y,{onClick:ge,disabled:U,children:[e.jsx(Ye,{className:r?"ml-2 h-4 w-4":"mr-2 h-4 w-4"}),a.actions.save]})]})]})}),e.jsx(R,{className:"glass-card overflow-hidden",children:e.jsxs(P,{className:"p-6",children:[e.jsxs("div",{className:n("flex items-start justify-between gap-4",r?"flex-row-reverse":""),children:[e.jsxs("div",{className:n("space-y-1",r?"text-right":"text-left"),children:[e.jsx("p",{className:"text-sm font-semibold",children:a.bcp.recoveryStrategyTitle}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a.bcp.recoveryStrategySubtitle})]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[a.bcp.lastUpdated,": ",l.lastUpdated]})]}),e.jsxs("div",{className:"mt-5 grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:n("rounded-lg border bg-background/50 p-6",r?"text-right":"text-left"),children:[e.jsx("p",{className:"text-2xl font-bold text-primary",children:l.rpo}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:a.bcp.averageRpo})]}),e.jsxs("div",{className:n("rounded-lg border bg-background/50 p-6",r?"text-right":"text-left"),children:[e.jsx("p",{className:"text-2xl font-bold text-primary",children:l.rto}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:a.bcp.averageRto})]}),e.jsxs("div",{className:n("rounded-lg border bg-background/50 p-6",r?"text-right":"text-left"),children:[e.jsx("p",{className:"text-2xl font-bold text-status-high",children:"99.9%"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:a.bcp.availabilityRate})]})]})]})})]})},Hl=Ls("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),Lt=o.forwardRef(({className:s,variant:t,...a},r)=>e.jsx("div",{ref:r,role:"alert",className:n(Hl({variant:t}),s),...a}));Lt.displayName="Alert";const Et=o.forwardRef(({className:s,...t},a)=>e.jsx("h5",{ref:a,className:n("mb-1 font-medium leading-none tracking-tight",s),...t}));Et.displayName="AlertTitle";const Ft=o.forwardRef(({className:s,...t},a)=>e.jsx("div",{ref:a,className:n("text-sm [&_p]:leading-relaxed",s),...t}));Ft.displayName="AlertDescription";const ql=()=>{const{strings:s,isRTL:t}=ie(),[a,r]=O.useState(!0),[i,d]=O.useState([]),[l,h]=O.useState(null),[g,L]=O.useState(null),[f,x]=O.useState(0),[k,T]=O.useState(0);if(O.useEffect(()=>{(async()=>{try{const[B,J,oe,I]=await Promise.all([he.getServices(),he.getBCPlan(),he.getDRPlan(),he.getTests?.()??Promise.resolve([])]);d(B),h(J),L(oe);const Z=Array.isArray(I)?I:[];x(Z.length);const ue=new Date,xe=new Date(ue);xe.setDate(xe.getDate()+30);const ge=Z.filter(E=>{if(E.status!=="Planned")return!1;const v=new Date(E.date);return Number.isNaN(v.getTime())?!1:v>=ue&&v<=xe}).length;T(ge)}finally{r(!1)}})()},[]),a)return e.jsx(fe,{text:s.common.loading});const p=i.length,N=i.filter(_=>_.criticality==="Critical").length,m=i.filter(_=>_.criticality==="High").length,u=Math.max(0,p-N-m),c=i.filter(_=>_.criticality==="Critical"||_.criticality==="High").length,j=_=>{const B=_.trim().toLowerCase(),J=Number.parseFloat(B);return Number.isFinite(J)?B.includes("minute")?J/60:B.includes("hour")?J:B.includes("day")?J*24:null:null},b=i.filter(_=>_.criticality==="Critical"||_.criticality==="High").map(_=>j(_.rto)).filter(_=>typeof _=="number"&&Number.isFinite(_)),M=b.length>0?b.reduce((_,B)=>_+B,0)/b.length:null,z=(l?1:0)+(g?1:0),S=Math.round(z/2*100),X=l?.status?l.status==="Active"?s.bcp.statusActive:l.status==="Draft"?s.bcp.statusDraft:l.status==="In Review"?s.bcp.statusInReview:l.status==="Archived"?s.bcp.statusArchived:l.status:"-",ee=_=>s.bcpDashboard.countOfTotal.replace("{count}",String(_)).replace("{total}",String(p)),U=[{key:"critical",label:s.bcp.criticalityCritical,count:N,fillClass:"bg-status-critical/60"},{key:"high",label:s.bcp.criticalityHigh,count:m,fillClass:"bg-status-high/60"},{key:"mediumLow",label:s.bcpDashboard.mediumLow,count:u,fillClass:"bg-status-medium/60"}],H=_=>{const B=Number.isFinite(_)?Math.min(100,Math.max(0,_)):0;switch(Math.round(B/5)*5){case 0:return"w-[0%]";case 5:return"w-[5%]";case 10:return"w-[10%]";case 15:return"w-[15%]";case 20:return"w-[20%]";case 25:return"w-[25%]";case 30:return"w-[30%]";case 35:return"w-[35%]";case 40:return"w-[40%]";case 45:return"w-[45%]";case 50:return"w-[50%]";case 55:return"w-[55%]";case 60:return"w-[60%]";case 65:return"w-[65%]";case 70:return"w-[70%]";case 75:return"w-[75%]";case 80:return"w-[80%]";case 85:return"w-[85%]";case 90:return"w-[90%]";case 95:return"w-[95%]";default:return"w-[100%]"}};return e.jsxs("div",{className:"space-y-6 animate-in",children:[e.jsxs("div",{className:n("flex items-start justify-between gap-4",t?"flex-row-reverse":""),children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:s.bcpDashboard.title}),e.jsx("p",{className:"text-muted-foreground",children:s.bcpDashboard.subtitle})]}),e.jsx(y,{asChild:!0,variant:"secondary",className:"rounded-full px-5",children:e.jsxs(Q,{to:"/bcp/services",className:n("flex items-center gap-2",t?"flex-row-reverse":""),children:[e.jsx(bt,{className:"h-4 w-4"}),e.jsx("span",{children:s.bcpDashboard.manageServices})]})})]}),e.jsx("div",{className:n("text-sm text-muted-foreground",t?"text-right":"text-left"),children:s.bcpDashboard.overviewTitle}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(R,{className:"glass-card",children:e.jsx(P,{className:"p-6",children:e.jsxs("div",{className:n("flex items-start justify-between gap-4",t?"flex-row-reverse":""),children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-primary/10 flex items-center justify-center shrink-0",children:e.jsx(bt,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{className:n("flex-1",t?"text-right":"text-left"),children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:s.bcpDashboard.vitalServices}),e.jsx("p",{className:"text-3xl font-bold mt-2",children:p}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:[s.bcpDashboard.critical,": ",c]})]})]})})}),e.jsx(R,{className:"glass-card",children:e.jsx(P,{className:"p-6",children:e.jsxs("div",{className:n("flex items-start justify-between gap-4",t?"flex-row-reverse":""),children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-chart-2/10 flex items-center justify-center shrink-0",children:e.jsx(fs,{className:"h-5 w-5 text-chart-2"})}),e.jsxs("div",{className:n("flex-1",t?"text-right":"text-left"),children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:s.bcpDashboard.criticalServices}),e.jsx("p",{className:"text-3xl font-bold mt-2",children:c}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:[s.bcp.criticalityCritical,": ",N," • ",s.bcp.criticalityHigh,": ",m]})]})]})})}),e.jsx(R,{className:"glass-card",children:e.jsx(P,{className:"p-6",children:e.jsxs("div",{className:n("flex items-start justify-between gap-4",t?"flex-row-reverse":""),children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-chart-3/10 flex items-center justify-center shrink-0",children:e.jsx(Ba,{className:"h-5 w-5 text-chart-3"})}),e.jsxs("div",{className:n("flex-1",t?"text-right":"text-left"),children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:s.bcpDashboard.avgRto}),e.jsxs("p",{className:"text-3xl font-bold mt-2",children:[M===null?"-":M.toFixed(1),s.bcpDashboard.hoursShort]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["RTO: ",g?.rto??"-"," • RPO: ",g?.rpo??"-"]})]})]})})}),e.jsx(R,{className:"glass-card",children:e.jsx(P,{className:"p-6",children:e.jsxs("div",{className:n("flex items-start justify-between gap-4",t?"flex-row-reverse":""),children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-status-warning/10 flex items-center justify-center shrink-0",children:e.jsx(Oi,{className:"h-5 w-5 text-status-warning"})}),e.jsxs("div",{className:n("flex-1",t?"text-right":"text-left"),children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:s.bcpDashboard.readyPlans}),e.jsxs("div",{className:n("mt-2 flex items-end gap-2",t?"flex-row-reverse":""),children:[e.jsx("span",{className:"text-3xl font-bold",children:z}),e.jsxs("span",{className:n("text-xs text-muted-foreground flex items-center gap-1",t?"flex-row-reverse":""),children:[S,"%",e.jsx(Mi,{className:"h-3 w-3"})]})]})]})]})})})]}),k>0&&e.jsxs(Lt,{className:n("glass-card border border-status-warning/40 bg-transparent p-6",t&&"[&>svg]:left-auto [&>svg]:right-4 [&>svg~*]:pl-0 [&>svg~*]:pr-7"),children:[e.jsx(ss,{className:"h-4 w-4 text-status-warning"}),e.jsx(Et,{className:n("text-status-warning",t?"text-right":"text-left"),children:s.bcpDashboard.upcomingTestsTitle}),e.jsx(Ft,{className:n(t?"text-right":"text-left"),children:s.bcpDashboard.upcomingTestsDesc.replace("{count}",String(k))})]}),e.jsxs(R,{className:"glass-card",children:[e.jsxs(K,{children:[e.jsx(Y,{className:"text-base",children:s.bcpDashboard.distributionTitle}),e.jsx(ye,{children:s.bcpDashboard.distributionSubtitle})]}),e.jsx(P,{className:"space-y-4",children:U.map(_=>{const B=p>0?_.count/p*100:0;return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:n("flex items-center justify-between gap-4",t?"flex-row-reverse":""),children:[e.jsx("div",{className:n("text-sm font-medium",t?"text-right":"text-left"),children:_.label}),e.jsx("div",{className:n("text-xs text-muted-foreground",t?"text-left":"text-right"),children:p>0?ee(_.count):ee(0)})]}),e.jsx("div",{className:"relative h-2 rounded bg-muted/30 overflow-hidden",children:e.jsx("div",{className:n("absolute top-0 h-full transition-all",t?"right-0":"left-0",_.fillClass,H(B))})})]},_.key)})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(R,{className:"glass-card lg:col-span-2",children:[e.jsxs(K,{children:[e.jsx(Y,{className:"text-base",children:s.bcpDashboard.quickLinks}),e.jsx(ye,{children:s.bcpDashboard.quickLinksDesc})]}),e.jsxs(P,{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsx(y,{asChild:!0,variant:"secondary",className:"justify-between",children:e.jsxs(Q,{to:"/bcp/plan",children:[s.bcpDashboard.editBcpPlan,e.jsx(Me,{className:n("h-4 w-4",t?"rotate-180":"")})]})}),e.jsx(y,{asChild:!0,variant:"secondary",className:"justify-between",children:e.jsxs(Q,{to:"/bcp/dr",children:[s.bcpDashboard.editDrPlan,e.jsx(Me,{className:n("h-4 w-4",t?"rotate-180":"")})]})}),e.jsx(y,{asChild:!0,variant:"secondary",className:"justify-between",children:e.jsxs(Q,{to:"/bcp/services",children:[s.bcpDashboard.editServices,e.jsx(Me,{className:n("h-4 w-4",t?"rotate-180":"")})]})}),e.jsx(y,{asChild:!0,variant:"secondary",className:"justify-between",children:e.jsxs(Q,{to:"/bcp/tests",children:[s.bcpDashboard.manageTests,e.jsx(Me,{className:n("h-4 w-4",t?"rotate-180":"")})]})})]})]}),e.jsxs(R,{className:"glass-card",children:[e.jsxs(K,{children:[e.jsx(Y,{className:"text-base",children:s.bcpDashboard.coverage}),e.jsx(ye,{children:s.bcpDashboard.coverageDesc})]}),e.jsxs(P,{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:s.bcpDashboard.services}),e.jsx("span",{className:"font-medium",children:i.length})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:s.bcpDashboard.sections}),e.jsx("span",{className:"font-medium",children:l?.sections?.length??0})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:s.bcpDashboard.sites}),e.jsx("span",{className:"font-medium",children:Array.isArray(g?.sites)?g?.sites.length:0})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:s.bcpDashboard.bcpStatus}),e.jsx("span",{className:"font-medium",children:X})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:s.bcpDashboard.tests}),e.jsx("span",{className:"font-medium",children:f})]})]})]})]})]})},Kl=(s,t)=>s==="Planned"?e.jsx(pe,{className:"bg-primary/15 text-primary border border-primary/25",children:t.bcpTests.statusPlanned}):e.jsx(pe,{className:"bg-status-high/15 text-status-high border border-status-high/30",children:t.bcpTests.statusCompleted}),zl=(s,t)=>s==="Passed"?{text:t.bcpTests.resultSuccess,className:"text-status-success"}:s==="Failed"?{text:t.bcpTests.resultFailed,className:"text-status-danger"}:{text:"—",className:"text-muted-foreground"},Yl=(s,t)=>s.status==="Planned"||typeof s.durationMinutes!="number"||!Number.isFinite(s.durationMinutes)||s.durationMinutes<=0?"—":`${s.durationMinutes} ${t.bcpTests.minutesShort}`,Wl=s=>{const t=/^TEST-(\d+)$/.exec(s);return t?`T-${t[1]}`:s},Jl=()=>{const{strings:s,isRTL:t}=ie(),{toast:a}=Pe(),{can:r}=Ne(),[i,d]=O.useState(!0),[l,h]=O.useState([]),[g,L]=O.useState([]),[f,x]=O.useState([]),[k,T]=O.useState(!1),[p,N]=O.useState("add"),[m,u]=O.useState(null),[c,j]=O.useState(""),[b,M]=O.useState("BCP"),[z,S]=O.useState(()=>new Date().toISOString().slice(0,10)),[X,ee]=O.useState("Planned"),[U,H]=O.useState(""),[_,B]=O.useState(""),[J,oe]=O.useState([]),[I,Z]=O.useState(""),[ue,xe]=O.useState(null);O.useEffect(()=>{if(!k||p==="view"||b!=="DR"||!I.trim())return;f.some(ne=>ne.id===I.trim())||Z("")},[k,p,b,I,f]);const ge=O.useMemo(()=>{const D=new Set;for(const ne of g)D.add(ne.id);return D},[g]),E=O.useCallback(D=>D.filter(ne=>ge.has(ne)),[ge]);O.useEffect(()=>{k&&p!=="view"&&oe(D=>E(D))},[k,p,E]);const v=O.useCallback(async()=>{d(!0);try{const[D,ne]=await Promise.all([he.getTests(),he.getServices?.()??Promise.resolve([])]);h(D),L(Array.isArray(ne)?ne:[]);try{const Ee=await(he.getDRPlan?.()??Promise.resolve(null)),ls=(()=>{if(!Ee||typeof Ee!="object")return[];const ut=Ee;if(!Array.isArray(ut.sites))return[];const Mt=ut.sites.map(be=>be&&typeof be=="object"?be:null).filter(be=>!!be).map(be=>({id:typeof be.id=="string"?be.id.trim():"",name:typeof be.name=="string"?be.name.trim():""})).filter(be=>be.id.length>0&&be.name.length>0);return Mt.length>0?Mt:ut.sites.filter(be=>typeof be=="string"&&be.trim().length>0).map(be=>be.trim()).map((be,Vr)=>({id:`DR-${String(Vr+1).padStart(3,"0")}`,name:be}))})();x(ls)}catch{x([])}}finally{d(!1)}},[]);O.useEffect(()=>{v()},[v]);const A=()=>{j(""),M("BCP"),S(new Date().toISOString().slice(0,10)),ee("Planned"),H(""),B(""),oe([]),Z("")},se=()=>{if(!r("canCreate")){a({title:s.common.notAllowed,description:s.bcp.noPermissionCreate,variant:"destructive"});return}N("add"),u(null),A(),T(!0)},le=D=>{N("view"),u(D),j(D.name),M(D.type),S(D.date),ee(D.status),H(D.status==="Planned"?"":typeof D.durationMinutes=="number"?String(D.durationMinutes):""),B(D.notes??""),oe(E(Array.isArray(D.serviceIds)?D.serviceIds:[])),Z(typeof D.drTargetId=="string"?D.drTargetId:""),T(!0)},je=D=>{if(!r("canEdit")){a({title:s.common.notAllowed,description:s.bcp.noPermissionEdit,variant:"destructive"});return}N("edit"),u(D),j(D.name),M(D.type),S(D.date),ee(D.status),H(D.status==="Planned"?"":typeof D.durationMinutes=="number"?String(D.durationMinutes):""),B(D.notes??""),oe(E(Array.isArray(D.serviceIds)?D.serviceIds:[])),Z(typeof D.drTargetId=="string"?D.drTargetId:""),T(!0)},Fe=(D,ne)=>{oe(Ee=>{const ls=new Set(Ee);return ne?ls.add(D):ls.delete(D),Array.from(ls)})},F=async()=>{if(p==="view"){T(!1);return}if(!c.trim()){a({title:s.bcpTests.missingFieldsTitle,description:s.bcpTests.missingFieldsDesc,variant:"destructive"});return}try{const D=E(J),ne=U.trim(),Ee=ne===""?void 0:Number(ne),ls=typeof Ee=="number"&&Number.isFinite(Ee)&&Ee>0?Math.round(Ee):void 0;if(p==="edit"&&m){if(!r("canEdit")){a({title:s.common.notAllowed,description:s.bcp.noPermissionEdit,variant:"destructive"});return}await he.updateTest(m.id,{name:c.trim(),type:b,date:z,status:X,durationMinutes:X==="Planned"?void 0:ls,notes:_.trim()||void 0,serviceIds:D.length?D:void 0,drTargetId:b==="DR"&&I.trim()?I.trim():void 0}),a({title:s.actions.save})}else{if(!r("canCreate")){a({title:s.common.notAllowed,description:s.bcp.noPermissionCreate,variant:"destructive"});return}await he.createTest({name:c.trim(),type:b,date:z,status:X,durationMinutes:X==="Planned"?void 0:ls,notes:_.trim()||void 0,serviceIds:D.length?D:void 0,drTargetId:b==="DR"&&I.trim()?I.trim():void 0}),a({title:s.bcpTests.createdTitle,description:s.bcpTests.createdDesc})}T(!1),u(null),A(),await v()}catch{a({title:s.bcpTests.saveFailedTitle,description:s.common.pleaseTryAgain,variant:"destructive"})}},C=async()=>{if(ue){if(!r("canDelete")){a({title:s.common.notAllowed,description:s.bcp.noPermissionDelete,variant:"destructive"});return}try{await he.deleteTest(ue.id),xe(null),await v()}catch{a({title:s.bcpTests.saveFailedTitle,description:s.common.pleaseTryAgain,variant:"destructive"})}}},q=O.useMemo(()=>{const D=new Map;for(const ne of g)D.set(ne.id,ne);return D},[g]),w=O.useMemo(()=>{if(!I.trim())return"—";const D=f.find(ne=>ne.id===I.trim());return D?`${D.id} • ${D.name}`:I.trim()},[I,f]);if(i)return e.jsx(fe,{text:s.common.loading});const ae=l.filter(D=>D.status==="Planned").length,ve=l.filter(D=>D.status!=="Planned"),we=ve.length,Ie=ve.filter(D=>D.status==="Passed").length,Le=we===0?0:Math.round(Ie/we*100);return e.jsxs("div",{className:"space-y-6 animate-in",children:[e.jsxs("div",{className:n("flex items-start justify-between gap-4",t?"flex-row-reverse":""),children:[e.jsxs("div",{className:n(t?"text-right":"text-left"),children:[e.jsx("h1",{className:"text-2xl font-bold",children:s.bcpTests.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.bcpTests.subtitle})]}),r("canCreate")&&e.jsxs(y,{onClick:se,variant:"secondary",className:"rounded-full px-5",children:[e.jsx(ze,{className:n("h-4 w-4",t?"ml-2":"mr-2")}),s.bcpTests.scheduleTest]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(R,{className:"glass-card",children:e.jsx(P,{className:"p-6",children:e.jsxs("div",{className:n("flex items-center justify-between",t?"flex-row-reverse":""),children:[e.jsxs("div",{className:n("space-y-1",t?"text-right":"text-left"),children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:s.bcpTests.successRate}),e.jsxs("div",{className:"text-2xl font-bold",children:[Le,"%"]})]}),e.jsx(Bt,{className:"h-5 w-5 text-status-success"})]})})}),e.jsx(R,{className:"glass-card",children:e.jsx(P,{className:"p-6",children:e.jsxs("div",{className:n("flex items-center justify-between",t?"flex-row-reverse":""),children:[e.jsxs("div",{className:n("space-y-1",t?"text-right":"text-left"),children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:s.bcpTests.scheduledTests}),e.jsx("div",{className:"text-2xl font-bold",children:ae})]}),e.jsx(hs,{className:"h-5 w-5 text-primary"})]})})}),e.jsx(R,{className:"glass-card",children:e.jsx(P,{className:"p-6",children:e.jsxs("div",{className:n("flex items-center justify-between",t?"flex-row-reverse":""),children:[e.jsxs("div",{className:n("space-y-1",t?"text-right":"text-left"),children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:s.bcpTests.executedTests}),e.jsx("div",{className:"text-2xl font-bold",children:we})]}),e.jsx(Bt,{className:"h-5 w-5 text-status-high"})]})})})]}),e.jsxs(R,{className:"glass-card",children:[e.jsxs(K,{children:[e.jsx(Y,{className:"text-base",children:s.bcpTests.listTitle}),e.jsx(ye,{children:s.bcpTests.listDesc})]}),e.jsx(P,{children:e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-border text-sm text-muted-foreground",children:[e.jsx("th",{className:"py-3 px-4 font-medium text-center",children:s.bcpTests.recordId}),e.jsx("th",{className:n("py-3 px-4 font-medium",t?"text-right":"text-left"),children:s.bcpTests.plan}),e.jsx("th",{className:"py-3 px-4 font-medium text-center",children:s.bcpTests.date}),e.jsx("th",{className:"py-3 px-4 font-medium text-center",children:s.bcpTests.status}),e.jsx("th",{className:"py-3 px-4 font-medium text-center",children:s.bcpTests.result}),e.jsx("th",{className:"py-3 px-4 font-medium text-center",children:s.bcpTests.duration}),e.jsx("th",{className:"py-3 px-4 font-medium text-center",children:s.actions.viewAll})]})}),e.jsx("tbody",{children:l.map(D=>{const ne=zl(D.status,s);return e.jsxs("tr",{className:"border-b border-border/50 hover:bg-muted/20 transition-colors",children:[e.jsx("td",{className:"py-3 px-4 text-center text-sm font-medium",children:Wl(D.id)}),e.jsxs("td",{className:n("py-3 px-4",t?"text-right":"text-left"),children:[e.jsx("p",{className:"text-sm font-medium",children:D.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:D.type==="BCP"?s.bcpTests.typeBCP:s.bcpTests.typeDR})]}),e.jsx("td",{className:"py-3 px-4 text-center text-sm",children:D.date}),e.jsx("td",{className:"py-3 px-4 text-center",children:Kl(D.status,s)}),e.jsx("td",{className:n("py-3 px-4 text-center text-sm font-medium",ne.className),children:ne.text}),e.jsx("td",{className:"py-3 px-4 text-center text-sm",children:Yl(D,s)}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:n("flex items-center justify-center gap-1",t?"flex-row-reverse":""),children:[e.jsx(y,{size:"icon",variant:"ghost",onClick:()=>le(D),"aria-label":s.bcp.viewDetails,children:e.jsx(Tt,{className:"h-4 w-4"})}),r("canEdit")&&e.jsx(y,{size:"icon",variant:"ghost",onClick:()=>je(D),"aria-label":s.actions.edit,children:e.jsx(it,{className:"h-4 w-4"})}),r("canDelete")&&e.jsx(y,{size:"icon",variant:"ghost",onClick:()=>xe(D),"aria-label":s.actions.delete,children:e.jsx(ns,{className:"h-4 w-4 text-destructive"})})]})})]},D.id)})})]}),l.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground py-6 text-center",children:s.bcpTests.noTests})]})})]}),e.jsx(ds,{open:k,onOpenChange:D=>{T(D),D||(A(),u(null),N("add"))},children:e.jsxs(ts,{children:[e.jsxs(as,{children:[e.jsx(rs,{children:p==="view"?s.bcp.viewDetails:p==="edit"?s.actions.edit:s.bcpTests.addTest}),e.jsx(is,{children:s.bcpTests.dialogDesc})]}),e.jsxs("div",{className:"grid gap-4 py-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"name",children:s.bcpTests.name}),e.jsx(G,{id:"name",value:c,onChange:D=>j(D.target.value),placeholder:s.bcpTests.namePlaceholder,disabled:p==="view"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:s.bcpTests.type}),e.jsxs(Re,{value:b,onValueChange:D=>{const ne=D;M(ne),ne!=="DR"&&Z("")},disabled:p==="view",children:[e.jsx(Se,{children:e.jsx(Ae,{})}),e.jsxs(Te,{children:[e.jsx(te,{value:"BCP",children:s.bcpTests.typeBCP}),e.jsx(te,{value:"DR",children:s.bcpTests.typeDR})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"date",children:s.bcpTests.date}),e.jsx(G,{id:"date",type:"date",value:z,onChange:D=>S(D.target.value),disabled:p==="view"})]})]}),b==="DR"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:s.bcp.targetId}),p==="view"?e.jsx("div",{className:n("rounded-md border bg-background/50 px-3 py-2 text-sm",t?"text-right":"text-left"),children:w}):e.jsxs(Re,{value:I,onValueChange:Z,disabled:p==="view",children:[e.jsx(Se,{children:e.jsx(Ae,{placeholder:"—"})}),e.jsxs(Te,{children:[e.jsx(te,{value:"",children:"—"}),f.map(D=>e.jsxs(te,{value:D.id,children:[D.id," • ",D.name]},D.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:s.bcpTests.status}),e.jsxs(Re,{value:X,onValueChange:D=>{const ne=D;ee(ne),ne==="Planned"&&H("")},disabled:p==="view",children:[e.jsx(Se,{children:e.jsx(Ae,{})}),e.jsxs(Te,{children:[e.jsx(te,{value:"Planned",children:s.bcpTests.statusPlanned}),e.jsx(te,{value:"Passed",children:s.bcpTests.statusPassed}),e.jsx(te,{value:"Failed",children:s.bcpTests.statusFailed})]})]})]}),X!=="Planned"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"durationMinutes",children:s.bcpTests.durationMinutesLabel}),e.jsx(G,{id:"durationMinutes",type:"number",min:1,inputMode:"numeric",value:U,onChange:D=>H(D.target.value),placeholder:s.bcpTests.durationMinutesPlaceholder,disabled:p==="view"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"notes",children:s.bcpTests.notes}),e.jsx(G,{id:"notes",value:_,onChange:D=>B(D.target.value),placeholder:s.bcpTests.notesPlaceholder,disabled:p==="view"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:n("flex items-center justify-between gap-3",t?"flex-row-reverse":""),children:[e.jsx(V,{children:s.bcp.linkedServices}),e.jsx("span",{className:"text-xs text-muted-foreground",children:s.bcp.linkedCount.replace("{count}",String(J.length))})]}),g.length===0?e.jsx("p",{className:n("text-sm text-muted-foreground",t?"text-right":"text-left"),children:s.bcp.noLinkedServices}):p==="view"?J.length===0?e.jsx("p",{className:n("text-sm text-muted-foreground",t?"text-right":"text-left"),children:s.bcp.noLinkedServices}):e.jsx("div",{className:"space-y-1",children:J.map(D=>q.get(D)).filter(D=>!!D).map(D=>e.jsxs("div",{className:n("flex items-center justify-between gap-3",t?"flex-row-reverse":""),children:[e.jsx("span",{className:"text-sm font-medium",children:D.name}),e.jsx("span",{className:"text-xs text-muted-foreground",children:D.id})]},D.id))}):e.jsx("div",{className:"max-h-40 overflow-auto rounded-md border bg-background/50 p-3 space-y-2",children:g.slice().sort((D,ne)=>D.name.localeCompare(ne.name)).map(D=>{const ne=J.includes(D.id);return e.jsxs("label",{className:n("flex items-center justify-between gap-3 text-sm",t?"flex-row-reverse":""),children:[e.jsxs("div",{className:n("flex items-center gap-2",t?"flex-row-reverse":""),children:[e.jsx(mt,{checked:ne,onCheckedChange:Ee=>Fe(D.id,Ee===!0)}),e.jsx("span",{className:"font-medium",children:D.name})]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:D.id})]},D.id)})})]})]}),e.jsxs(js,{className:n(t?"sm:flex-row-reverse":""),children:[e.jsx(y,{variant:"outline",onClick:()=>T(!1),children:p==="view"?s.actions.back:s.actions.cancel}),p!=="view"&&e.jsx(y,{onClick:F,children:s.actions.save})]})]})}),e.jsx(Xe,{open:!!ue,onOpenChange:D=>D?void 0:xe(null),children:e.jsxs(_e,{children:[e.jsxs(Be,{children:[e.jsx(Ve,{children:s.actions.delete}),e.jsx(He,{children:ue?`${ue.name}`:""})]}),e.jsxs(Ue,{className:n(t?"sm:flex-row-reverse":""),children:[e.jsx(Ke,{children:s.actions.cancel}),e.jsx(qe,{onClick:C,children:s.actions.delete})]})]})})]})},_r=s=>{const t=new Date(s);return!Number.isNaN(t.getTime())},Xt=s=>_r(s)?new Date(s).toISOString().slice(0,10):"-",Zt=(s,t)=>{const a=new Date,r=s.filter(g=>g.type===t&&_r(g.date)),i=r.filter(g=>g.status!=="Planned").map(g=>new Date(g.date)).filter(g=>!Number.isNaN(g.getTime())),d=i.length>0?new Date(Math.max(...i.map(g=>g.getTime()))).toISOString().slice(0,10):"-",l=r.filter(g=>g.status==="Planned").map(g=>new Date(g.date)).filter(g=>!Number.isNaN(g.getTime())&&g>=a),h=l.length>0?new Date(Math.min(...l.map(g=>g.getTime()))).toISOString().slice(0,10):"-";return{lastExecuted:d,nextPlanned:h}},Gl=s=>s==="Active"?"bg-status-high/15 text-status-high":s==="Draft"?"bg-muted/40 text-muted-foreground":s==="In Review"?"bg-status-warning/15 text-status-warning":s==="Archived"?"bg-muted/30 text-muted-foreground":"bg-muted/40 text-muted-foreground",Ql=()=>{const{strings:s,isRTL:t}=ie(),[a,r]=O.useState(!0),[i,d]=O.useState(null),[l,h]=O.useState(null),[g,L]=O.useState([]);if(O.useEffect(()=>{(async()=>{try{const[p,N,m]=await Promise.all([he.getBCPlan(),he.getDRPlan(),he.getTests?.()??Promise.resolve([])]);d(p),h(N),L(Array.isArray(m)?m:[])}finally{r(!1)}})()},[]),a)return e.jsx(fe,{text:s.common.loading});const f=i?.status?i.status==="Active"?s.bcp.statusActive:i.status==="Draft"?s.bcp.statusDraft:i.status==="In Review"?s.bcp.statusInReview:i.status==="Archived"?s.bcp.statusArchived:i.status:"-",x=Zt(g,"BCP"),k=Zt(g,"DR");return e.jsxs("div",{className:"space-y-6 animate-in",children:[e.jsx("div",{className:n("flex items-start justify-between gap-4",t?"flex-row-reverse":""),children:e.jsxs("div",{className:n(t?"text-right":"text-left"),children:[e.jsx("h1",{className:"text-2xl font-bold",children:s.bcpPlans.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.bcpPlans.subtitle})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(R,{className:"glass-card overflow-hidden",children:e.jsxs(P,{className:"p-6",children:[e.jsxs("div",{className:n("flex items-center justify-between gap-3",t?"flex-row-reverse":""),children:[e.jsxs(pe,{variant:"secondary",className:n("gap-2",Gl(i?.status??""),"hover:bg-inherit"),children:[e.jsx("span",{className:n("h-1.5 w-1.5 rounded-full",i?.status==="Active"?"bg-status-high":"bg-muted-foreground")}),e.jsx("span",{children:f})]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s.bcpPlans.lastUpdated,": ",Xt(i?.lastUpdated??"")]})]}),e.jsxs("div",{className:n("mt-5 space-y-2",t?"text-right":"text-left"),children:[e.jsx("h2",{className:"text-lg font-semibold",children:s.bcpPlans.bcpCardTitle}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.bcpPlans.bcpCardDesc})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:s.bcpPlans.mainProcedures}),e.jsxs("div",{className:"mt-2 space-y-1",children:[(i?.sections??[]).slice(0,3).map((T,p)=>e.jsxs("div",{className:n("flex items-start gap-2",t?"flex-row-reverse":""),children:[e.jsx("span",{className:"mt-2 h-1.5 w-1.5 rounded-sm bg-primary/70"}),e.jsx("span",{className:n("leading-6",t?"text-right":"text-left"),children:T})]},`${p}-${T}`)),(i?.sections?.length??0)===0&&e.jsx("div",{className:"text-muted-foreground",children:"—"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:s.bcpPlans.sectionsCount}),e.jsx("div",{className:"mt-2 font-medium",children:i?.sections?.length??0})]})]}),e.jsx("div",{className:"my-6 h-px bg-border/50"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:n("space-y-2",t?"text-right":"text-left"),children:[e.jsx("div",{className:"text-muted-foreground",children:s.bcpPlans.lastTest}),e.jsxs("div",{className:n("flex items-center gap-2",t?"flex-row-reverse":""),children:[e.jsx(hs,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:x.lastExecuted})]})]}),e.jsxs("div",{className:n("space-y-2",t?"text-left":"text-right"),children:[e.jsx("div",{className:"text-muted-foreground",children:s.bcpPlans.nextTest}),e.jsxs("div",{className:n("flex items-center gap-2",t?"flex-row-reverse justify-start":"justify-end"),children:[e.jsx(hs,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:x.nextPlanned})]})]})]}),e.jsx(y,{asChild:!0,variant:"secondary",className:"w-full mt-6",children:e.jsx(Q,{to:"/bcp/plan",children:s.bcpPlans.viewDetails})})]})}),e.jsx(R,{className:"glass-card overflow-hidden",children:e.jsxs(P,{className:"p-6",children:[e.jsxs("div",{className:n("flex items-center justify-between gap-3",t?"flex-row-reverse":""),children:[e.jsxs(pe,{variant:"secondary",className:n("gap-2","bg-status-high/15 text-status-high","hover:bg-inherit"),children:[e.jsx("span",{className:"h-1.5 w-1.5 rounded-full bg-status-high"}),e.jsx("span",{children:s.bcp.statusActive})]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s.bcpPlans.lastUpdated,": ",Xt(l?.lastUpdated??"")]})]}),e.jsxs("div",{className:n("mt-5 space-y-2",t?"text-right":"text-left"),children:[e.jsx("h2",{className:"text-lg font-semibold",children:s.bcpPlans.drCardTitle}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.bcpPlans.drCardDesc})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:s.bcpPlans.mainProcedures}),e.jsxs("div",{className:"mt-2 space-y-1",children:[(l?.sites??[]).slice(0,3).map((T,p)=>e.jsxs("div",{className:n("flex items-start gap-2",t?"flex-row-reverse":""),children:[e.jsx("span",{className:"mt-2 h-1.5 w-1.5 rounded-sm bg-primary/70"}),e.jsx("span",{className:n("leading-6",t?"text-right":"text-left"),children:T.name})]},`${T.id}-${p}`)),(l?.sites?.length??0)===0&&e.jsx("div",{className:"text-muted-foreground",children:"—"})]})]}),e.jsxs("div",{className:n("space-y-2",t?"text-right":"text-left"),children:[e.jsx("div",{className:"text-muted-foreground",children:s.bcpPlans.recoveryTargets}),e.jsxs("div",{className:"font-medium",children:["RTO: ",l?.rto??"-"," • RPO: ",l?.rpo??"-"]})]})]}),e.jsx("div",{className:"my-6 h-px bg-border/50"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:n("space-y-2",t?"text-right":"text-left"),children:[e.jsx("div",{className:"text-muted-foreground",children:s.bcpPlans.lastTest}),e.jsxs("div",{className:n("flex items-center gap-2",t?"flex-row-reverse":""),children:[e.jsx(hs,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:k.lastExecuted})]})]}),e.jsxs("div",{className:n("space-y-2",t?"text-left":"text-right"),children:[e.jsx("div",{className:"text-muted-foreground",children:s.bcpPlans.nextTest}),e.jsxs("div",{className:n("flex items-center gap-2",t?"flex-row-reverse justify-start":"justify-end"),children:[e.jsx(hs,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:k.nextPlanned})]})]})]}),e.jsx(y,{asChild:!0,variant:"secondary",className:"w-full mt-6",children:e.jsx(Q,{to:"/bcp/dr",children:s.bcpPlans.viewDetails})})]})})]})]})},Cs=o.forwardRef(({className:s,...t},a)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:a,className:n("w-full caption-bottom text-sm",s),...t})}));Cs.displayName="Table";const Rs=o.forwardRef(({className:s,...t},a)=>e.jsx("thead",{ref:a,className:n("[&_tr]:border-b",s),...t}));Rs.displayName="TableHeader";const As=o.forwardRef(({className:s,...t},a)=>e.jsx("tbody",{ref:a,className:n("[&_tr:last-child]:border-0",s),...t}));As.displayName="TableBody";const Xl=o.forwardRef(({className:s,...t},a)=>e.jsx("tfoot",{ref:a,className:n("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",s),...t}));Xl.displayName="TableFooter";const We=o.forwardRef(({className:s,...t},a)=>e.jsx("tr",{ref:a,className:n("border-b transition-colors data-[state=selected]:bg-muted hover:bg-muted/50",s),...t}));We.displayName="TableRow";const De=o.forwardRef(({className:s,...t},a)=>e.jsx("th",{ref:a,className:n("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",s),...t}));De.displayName="TableHead";const Ce=o.forwardRef(({className:s,...t},a)=>e.jsx("td",{ref:a,className:n("p-4 align-middle [&:has([role=checkbox])]:pr-0",s),...t}));Ce.displayName="TableCell";const Zl=o.forwardRef(({className:s,...t},a)=>e.jsx("caption",{ref:a,className:n("mt-4 text-sm text-muted-foreground",s),...t}));Zl.displayName="TableCaption";const ec=s=>`Q${Math.floor(s.getMonth()/3)+1} ${s.getFullYear()}`,sc=s=>{const t=String(s??"");return/[\n\r,"]/.test(t)?`"${t.replace(/"/g,'""')}"`:t},ea=(s,t,a)=>{const r=new Blob([t],{type:a}),i=URL.createObjectURL(r),d=document.createElement("a");d.href=i,d.download=s,document.body.appendChild(d),d.click(),d.remove(),URL.revokeObjectURL(i)},tc=()=>{const{toast:s}=Pe(),{can:t}=Ne(),{strings:a,isRTL:r}=ie(),[i,d]=o.useState(!0),[l,h]=o.useState([]),[g,L]=o.useState(!1);o.useEffect(()=>{(async()=>{d(!0);try{const j=await de.getAll();h(j)}catch{s({title:a.reports.failedToLoadTitle,description:a.common.pleaseTryAgain,variant:"destructive"})}finally{d(!1)}})()},[]);const f=o.useMemo(()=>ec(new Date),[]),x=o.useMemo(()=>{const c=l.length,j={Critical:l.filter(M=>M.level==="Critical").length,High:l.filter(M=>M.level==="High").length,Medium:l.filter(M=>M.level==="Medium").length,Low:l.filter(M=>M.level==="Low").length},b=l.filter(M=>M.status==="Closed").length;return{total:c,closed:b,byLevel:j}},[l]),k=o.useMemo(()=>[...l].sort((c,j)=>(j.score??0)-(c.score??0)).slice(0,10),[l]),T=o.useMemo(()=>g?[...l].sort((c,j)=>(j.score??0)-(c.score??0)):k,[l,g,k]),p=o.useMemo(()=>{const c=new Map;for(const j of l)c.set(j.category,(c.get(j.category)??0)+1);return Array.from(c.entries()).map(([j,b])=>({category:j,count:b})).sort((j,b)=>b.count-j.count)},[l]),N=o.useMemo(()=>{const c=new Map;for(const j of l)c.set(j.status,(c.get(j.status)??0)+1);return Array.from(c.entries()).map(([j,b])=>({status:j,count:b})).sort((j,b)=>b.count-j.count)},[l]),m=()=>{if(!t("canExport")){s({title:a.common.notAllowed,description:a.reports.noExportPermission,variant:"destructive"});return}const c=["id","title","category","owner","status","likelihood","impact","score","level","createdAt","updatedAt"],j=l.map(M=>[M.id,M.title,M.category,M.owner,M.status,M.likelihood,M.impact,M.score,M.level,M.createdAt,M.updatedAt]),b=[c.join(","),...j.map(M=>M.map(sc).join(","))].join(`
`);ea(`risk-register-${f}.csv`,b,"text/csv;charset=utf-8"),s({title:a.reports.exportReadyTitle,description:a.reports.exportCsvDesc})},u=()=>{if(!t("canExport")){s({title:a.common.notAllowed,description:a.reports.noExportPermission,variant:"destructive"});return}const c=S=>String(S??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),j=p.map(S=>`<tr><td>${c(S.category)}</td><td style="text-align:end;">${c(S.count)}</td></tr>`).join(""),b=N.map(S=>`<tr><td>${c(S.status)}</td><td style="text-align:end;">${c(S.count)}</td></tr>`).join(""),M=T.map(S=>`<tr>
            <td>${c(S.id)}</td>
            <td>${c(S.title)}</td>
            <td>${c(S.owner)}</td>
            <td>${c(S.status)}</td>
            <td style="text-align:end;">${c(S.score)}</td>
            <td>${c(S.level)}</td>
          </tr>`).join(""),z=`<!doctype html>
<html lang="${r?"ar":"en"}" dir="${r?"rtl":"ltr"}">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>${c(a.reports.reportTitle)} - ${c(f)}</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; padding: 24px; }
      h1 { margin: 0 0 8px 0; }
      .meta { color: #555; margin-bottom: 16px; }
      .grid { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 12px; margin: 16px 0 24px; }
      .grid-2 { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 12px; margin: 16px 0 24px; }
      .card { border: 1px solid #ddd; border-radius: 10px; padding: 12px; }
      table { width: 100%; border-collapse: collapse; }
      th, td { border-bottom: 1px solid #eee; padding: 8px; text-align: start; vertical-align: top; }
      th { background: #fafafa; }
      .small { font-size: 12px; color: #555; }
      .muted { color: #666; }
      @media print { body { padding: 0; } }
    </style>
  </head>
  <body>
    <h1>${c(a.reports.reportTitle)}</h1>
    <div class="meta">${c(a.reports.period)}: ${c(f)} • ${c(a.reports.generated)}: ${c(new Date().toISOString())}</div>
    <div class="grid">
      <div class="card"><div class="small">${c(a.reports.totalRisks)}</div><div style="font-size: 20px; font-weight: 700;">${x.total}</div></div>
      <div class="card"><div class="small">${c(a.reports.closedRisks)}</div><div style="font-size: 20px; font-weight: 700;">${x.closed}</div></div>
      <div class="card"><div class="small">Critical</div><div style="font-size: 20px; font-weight: 700;">${x.byLevel.Critical}</div></div>
      <div class="card"><div class="small">High</div><div style="font-size: 20px; font-weight: 700;">${x.byLevel.High}</div></div>
    </div>

    <div class="grid-2">
      <div class="card">
        <div class="small">${c(a.reports.byCategory)}</div>
        ${p.length===0?`<div class="muted" style="margin-top:6px;">${c(a.reports.noData)}</div>`:`
          <table style="margin-top:6px;">
            <thead><tr><th>${c(a.table.category)}</th><th style="text-align:end;">${c(a.table.count)}</th></tr></thead>
            <tbody>${j}</tbody>
          </table>
        `}
      </div>
      <div class="card">
        <div class="small">${c(a.reports.byStatus)}</div>
        ${N.length===0?`<div class="muted" style="margin-top:6px;">${c(a.reports.noData)}</div>`:`
          <table style="margin-top:6px;">
            <thead><tr><th>${c(a.table.status)}</th><th style="text-align:end;">${c(a.table.count)}</th></tr></thead>
            <tbody>${b}</tbody>
          </table>
        `}
      </div>
    </div>

    <h2>${c(a.reports.registerTitle)}</h2>
    <table>
      <thead>
        <tr>
          <th>${c(a.table.id)}</th><th>${c(a.table.title)}</th><th>${c(a.table.owner)}</th><th>${c(a.table.status)}</th><th>${c(a.table.score)}</th><th>${c(a.table.level)}</th>
        </tr>
      </thead>
      <tbody>
        ${M}
      </tbody>
    </table>
    <p class="small">${c(g?a.reports.showingAll:a.reports.showingTop10)}.</p>
    <p class="small">${c(a.reports.noteHtml)}</p>
  </body>
</html>`;ea(`risk-report-${f}.html`,z,"text/html;charset=utf-8"),s({title:a.reports.exportReadyTitle,description:a.reports.exportHtmlDesc})};return i?e.jsx(fe,{}):e.jsxs("div",{className:"space-y-6 animate-in",children:[e.jsxs("div",{className:n("flex items-center justify-between",r?"flex-row-reverse":""),children:[e.jsxs("div",{className:n(r?"text-right":"text-left"),children:[e.jsx("h1",{className:"text-2xl font-bold",children:a.page.reportsHome}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[a.reports.period,": ",f]})]}),e.jsx("div",{className:n("flex gap-2",r?"flex-row-reverse":""),children:t("canExport")&&e.jsxs(e.Fragment,{children:[e.jsxs(y,{variant:"outline",onClick:u,children:[e.jsx(Ps,{className:n("h-4 w-4",r?"ml-2":"mr-2")}),a.reports.exportHtml]}),e.jsxs(y,{variant:"outline",onClick:m,children:[e.jsx(Ps,{className:n("h-4 w-4",r?"ml-2":"mr-2")}),a.reports.exportCsv]})]})})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(y,{asChild:!0,variant:"outline",size:"sm",children:e.jsx(Q,{to:"/reports/executive",children:a.reports.executiveReport})}),e.jsx(y,{asChild:!0,variant:"outline",size:"sm",children:e.jsx(Q,{to:"/reports/standard",children:a.reports.standardReport})}),e.jsx(y,{asChild:!0,variant:"outline",size:"sm",children:e.jsx(Q,{to:"/reports/custom",children:a.reports.customReport})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(R,{className:"glass-card",children:[e.jsx(K,{children:e.jsxs(Y,{className:n("flex items-center gap-2",r?"flex-row-reverse":""),children:[e.jsx(fs,{className:"h-4 w-4"}),a.reports.totalRisks]})}),e.jsx(P,{children:e.jsx("p",{className:"text-3xl font-bold",children:x.total})})]}),e.jsxs(R,{className:"glass-card",children:[e.jsx(K,{children:e.jsx(Y,{children:a.reports.criticalRisks})}),e.jsx(P,{children:e.jsx("p",{className:"text-3xl font-bold",children:x.byLevel.Critical})})]}),e.jsxs(R,{className:"glass-card",children:[e.jsx(K,{children:e.jsx(Y,{children:a.reports.highRisks})}),e.jsx(P,{children:e.jsx("p",{className:"text-3xl font-bold",children:x.byLevel.High})})]}),e.jsxs(R,{className:"glass-card",children:[e.jsx(K,{children:e.jsx(Y,{children:a.reports.closedRisks})}),e.jsx(P,{children:e.jsx("p",{className:"text-3xl font-bold",children:x.closed})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs(R,{className:"glass-card",children:[e.jsx(K,{children:e.jsx(Y,{children:a.reports.byCategory})}),e.jsx(P,{children:p.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:a.reports.noData}):e.jsx("div",{className:"rounded-md border border-border overflow-hidden",children:e.jsxs(Cs,{children:[e.jsx(Rs,{children:e.jsxs(We,{children:[e.jsx(De,{children:a.table.category}),e.jsx(De,{className:r?"text-left":"text-right",children:a.table.count})]})}),e.jsx(As,{children:p.map(c=>e.jsxs(We,{children:[e.jsx(Ce,{className:"font-medium",children:c.category}),e.jsx(Ce,{className:r?"text-left":"text-right",children:c.count})]},c.category))})]})})})]}),e.jsxs(R,{className:"glass-card",children:[e.jsx(K,{children:e.jsx(Y,{children:a.reports.byStatus})}),e.jsx(P,{children:N.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:a.reports.noData}):e.jsx("div",{className:"rounded-md border border-border overflow-hidden",children:e.jsxs(Cs,{children:[e.jsx(Rs,{children:e.jsxs(We,{children:[e.jsx(De,{children:a.table.status}),e.jsx(De,{className:r?"text-left":"text-right",children:a.table.count})]})}),e.jsx(As,{children:N.map(c=>e.jsxs(We,{children:[e.jsx(Ce,{className:"font-medium",children:c.status}),e.jsx(Ce,{className:r?"text-left":"text-right",children:c.count})]},c.status))})]})})})]})]}),e.jsxs(R,{className:"glass-card",children:[e.jsx(K,{children:e.jsxs("div",{className:n("flex items-center justify-between gap-4",r?"flex-row-reverse":""),children:[e.jsx(Y,{children:a.reports.registerTitle}),e.jsx(y,{variant:"outline",size:"sm",onClick:()=>L(c=>!c),children:g?a.reports.top10:a.reports.all})]})}),e.jsxs(P,{children:[l.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:a.reports.noRisksAvailable}):e.jsx("div",{className:"rounded-md border border-border overflow-hidden",children:e.jsxs(Cs,{children:[e.jsx(Rs,{children:e.jsxs(We,{children:[e.jsx(De,{children:a.table.id}),e.jsx(De,{children:a.table.title}),e.jsx(De,{children:a.table.owner}),e.jsx(De,{children:a.table.status}),e.jsx(De,{className:r?"text-left":"text-right",children:a.table.score}),e.jsx(De,{children:a.table.level})]})}),e.jsx(As,{children:T.map(c=>e.jsxs(We,{children:[e.jsx(Ce,{className:"font-medium",children:c.id}),e.jsx(Ce,{children:c.title}),e.jsx(Ce,{children:c.owner}),e.jsx(Ce,{children:a.risks.statuses?.[c.status]??c.status}),e.jsx(Ce,{className:r?"text-left":"text-right",children:c.score}),e.jsx(Ce,{children:e.jsx(ce,{status:c.level,children:a.risks.levels?.[c.level]??c.level})})]},c.id))})]})}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:g?`${a.reports.showingAll}.`:`${a.reports.showingTop10}.`})]})]})]})},ac=()=>{const{strings:s}=ie(),[t,a]=O.useState(!0),[r,i]=O.useState([]);if(O.useEffect(()=>{(async()=>{try{i(await de.getAll())}finally{a(!1)}})()},[]),t)return e.jsx(fe,{text:s.common.loading});const d=r.length,l=r.filter(L=>L.level==="Critical").length,h=r.filter(L=>L.level==="High").length,g=r.filter(L=>L.status==="Closed").length;return e.jsxs("div",{className:"space-y-6 animate-in",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:s.page.reportsHome}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.reports.homeSubtitle})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs(R,{className:"glass-card",children:[e.jsx(K,{children:e.jsx(Y,{className:"text-sm",children:s.reports.totalRisks})}),e.jsx(P,{children:e.jsx("p",{className:"text-3xl font-bold text-primary",children:d})})]}),e.jsxs(R,{className:"glass-card",children:[e.jsx(K,{children:e.jsx(Y,{className:"text-sm",children:s.reports.criticalRisks})}),e.jsx(P,{children:e.jsx("p",{className:"text-3xl font-bold text-status-critical",children:l})})]}),e.jsxs(R,{className:"glass-card",children:[e.jsx(K,{children:e.jsx(Y,{className:"text-sm",children:s.reports.highRisks})}),e.jsx(P,{children:e.jsx("p",{className:"text-3xl font-bold text-status-warning",children:h})})]}),e.jsxs(R,{className:"glass-card",children:[e.jsx(K,{children:e.jsx(Y,{className:"text-sm",children:s.reports.closedRisks})}),e.jsx(P,{children:e.jsx("p",{className:"text-3xl font-bold text-status-success",children:g})})]})]}),e.jsxs(R,{className:"glass-card",children:[e.jsx(K,{children:e.jsx(Y,{children:s.reports.quickReportsTitle})}),e.jsxs(P,{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 rounded-lg border border-border",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:s.reports.executiveReport}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.reports.executiveSubtitle})]}),e.jsx($i,{className:"h-5 w-5 text-primary"})]}),e.jsx(y,{asChild:!0,className:"mt-4",variant:"outline",children:e.jsx(Q,{to:"/reports/executive",children:s.actions.viewAll})})]}),e.jsxs("div",{className:"p-4 rounded-lg border border-border",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:s.reports.standardReport}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.reports.standardSubtitle})]}),e.jsx(fs,{className:"h-5 w-5 text-primary"})]}),e.jsx(y,{asChild:!0,className:"mt-4",variant:"outline",children:e.jsx(Q,{to:"/reports/standard",children:s.actions.viewAll})})]}),e.jsxs("div",{className:"p-4 rounded-lg border border-border",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:s.reports.customReport}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.reports.customSubtitle})]}),e.jsx(_i,{className:"h-5 w-5 text-primary"})]}),e.jsx(y,{asChild:!0,className:"mt-4",variant:"outline",children:e.jsx(Q,{to:"/reports/custom",children:s.actions.viewAll})})]}),e.jsxs("div",{className:"p-4 rounded-lg border border-border",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:s.reports.registerReport}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.reports.registerSubtitle})]}),e.jsx(Bi,{className:"h-5 w-5 text-primary"})]}),e.jsx(y,{asChild:!0,className:"mt-4",variant:"outline",children:e.jsx(Q,{to:"/reports/register",children:s.actions.viewAll})})]})]})]})]})},rc=()=>{const s=o.useMemo(()=>Ds(),[]),{strings:t,isRTL:a}=ie(),r=i=>{const d=s[i];return Object.entries(d).filter(([,h])=>h).map(([h])=>h)};return e.jsxs("div",{className:"space-y-6 animate-in",children:[e.jsxs("div",{className:n(a?"text-right":"text-left"),children:[e.jsx("h1",{className:"text-2xl font-bold",children:t.roles.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.roles.subtitle})]}),e.jsx("div",{className:"grid gap-4",children:lt.map(i=>{const d=r(i);return e.jsxs(R,{className:"glass-card",children:[e.jsx(K,{children:e.jsxs(Y,{className:n("flex items-center justify-between gap-3",a?"flex-row-reverse":""),children:[e.jsx("span",{children:i}),e.jsxs(pe,{variant:"secondary",children:[d.length," ",t.roles.enabled]})]})}),e.jsx(P,{className:"space-y-2",children:d.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:t.roles.noCapabilities}):e.jsxs("p",{className:"text-sm text-muted-foreground",children:[t.roles.enabledListPrefix," ",d.join(", ")]})})]},i)})})]})},Ot=o.forwardRef(({className:s,...t},a)=>e.jsx(lr,{className:n("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",s),...t,ref:a,children:e.jsx(Ui,{className:n("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));Ot.displayName=lr.displayName;const ic=["canCreate","canEdit","canDelete","canViewTreatments","canViewReports","canViewAnalysis","canViewBCP","canViewFollowUp","canExport","canViewSettings","canViewAudit","canManageUsers"],nc=()=>{const{toast:s}=Pe(),{can:t,user:a}=Ne(),{strings:r,isRTL:i}=ie(),d=t("canViewSettings"),[l,h]=o.useState(()=>Ds()),g={canCreate:r.permissions.create,canEdit:r.permissions.edit,canDelete:r.permissions.delete,canViewTreatments:r.permissions.viewTreatments,canViewReports:r.permissions.viewReports,canViewAnalysis:r.permissions.viewAnalysis,canViewBCP:r.permissions.viewBCP,canViewFollowUp:r.permissions.viewFollowUp,canExport:r.permissions.export,canViewSettings:r.permissions.viewSettings,canViewAudit:r.permissions.viewAudit,canManageUsers:r.permissions.manageUsers},L=o.useMemo(()=>JSON.stringify(l)!==JSON.stringify(Ds()),[l]),f=(T,p,N)=>{h(m=>({...m,[T]:{...m[T],[p]:N}}))},x=()=>{if(!d){s({title:r.common.notAllowed,description:r.permissions.noAccessSystemSettings,variant:"destructive"});return}jn(l),s({title:r.permissions.saved})},k=()=>{if(!d){s({title:r.common.notAllowed,description:r.permissions.noAccessSystemSettings,variant:"destructive"});return}vn(),h(Ds()),s({title:r.permissions.resetDone})};return d?e.jsxs("div",{className:"space-y-6 animate-in",children:[e.jsxs("div",{className:n("flex flex-col sm:flex-row sm:items-end sm:justify-between gap-4",i?"sm:flex-row-reverse":""),children:[e.jsxs("div",{className:n(i?"text-right":"text-left"),children:[e.jsx("h1",{className:"text-2xl font-bold",children:r.permissions.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r.permissions.subtitle})]}),e.jsxs("div",{className:n("flex gap-2",i?"flex-row-reverse":""),children:[e.jsxs(y,{variant:"outline",onClick:k,children:[e.jsx(cr,{className:i?"ml-2 h-4 w-4":"mr-2 h-4 w-4"}),r.actions.reset]}),e.jsxs(y,{onClick:x,disabled:!L,children:[e.jsx(Ye,{className:i?"ml-2 h-4 w-4":"mr-2 h-4 w-4"}),r.actions.save]})]})]}),e.jsx("div",{className:"grid gap-4",children:lt.map(T=>e.jsxs(R,{className:"glass-card",children:[e.jsx(K,{children:e.jsx(Y,{children:T})}),e.jsx(P,{className:"grid gap-3",children:ic.map(p=>e.jsxs("div",{className:n("flex items-center justify-between gap-4",i?"flex-row-reverse":""),children:[e.jsxs("div",{className:n(i?"text-right":"text-left"),children:[e.jsx("p",{className:"font-medium",children:g[p]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:p})]}),e.jsx(Ot,{checked:l[T][p],onCheckedChange:N=>f(T,p,N),disabled:p==="canViewSettings"&&(T==="Admin"||T===a?.role)})]},p))})]},T))})]}):e.jsxs("div",{className:"space-y-6 animate-in",children:[e.jsx("h1",{className:n("text-2xl font-bold",i?"text-right":"text-left"),children:r.permissions.title}),e.jsx(R,{className:"glass-card",children:e.jsx(P,{className:"p-6",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:r.permissions.noAccess})})})]})},Br="riskms_",Ur=()=>{const s=[];for(let t=0;t<localStorage.length;t+=1){const a=localStorage.key(t);a&&a.startsWith(Br)&&s.push(a)}return s.sort(),s},lc=()=>{const s=Ur(),t={version:1,exportedAt:new Date().toISOString(),keys:{}};for(const a of s)t.keys[a]=localStorage.getItem(a);return t},cc=s=>{if(!s||typeof s!="object")throw new Error("Invalid import file");const t=s;if(t.version!==1)throw new Error("Unsupported import version");if(!t.keys||typeof t.keys!="object")throw new Error("Invalid import payload");const a=t.keys;for(const[r,i]of Object.entries(a))if(r.startsWith(Br)){if(i===null){localStorage.removeItem(r);continue}if(typeof i!="string")throw new Error(`Invalid value for key: ${r}`);localStorage.setItem(r,i)}},oc=()=>{const s=Ur();for(const t of s)localStorage.removeItem(t)},dc=()=>{const{toast:s}=Pe(),{can:t}=Ne(),{strings:a,isRTL:r}=ie(),i=o.useRef(null),[d,l]=o.useState(!0),[h,g]=o.useState(!1),[L,f]=o.useState(null),[x,k]=o.useState([]),[T,p]=o.useState(!1),[N,m]=o.useState(null),[u,c]=o.useState({name:"",code:"",description:"",color:"",icon:"",sort_order:0}),[j,b]=o.useState(null),[M,z]=o.useState(!1),S=t("canViewSettings"),X=(E,v)=>{const A=JSON.stringify(v,null,2),se=new Blob([A],{type:"application/json;charset=utf-8"}),le=URL.createObjectURL(se),je=document.createElement("a");je.href=le,je.download=E,document.body.appendChild(je),je.click(),je.remove(),URL.revokeObjectURL(le)},ee=()=>{if(!S){s({title:a.common.notAllowed,description:a.system.noAccessDesc,variant:"destructive"});return}const E=lc(),v=new Date().toISOString().replace(/[:.]/g,"-");X(`riskms-demo-export-${v}.json`,E),s({title:a.system.exportedTitle,description:a.system.exportedDesc})},U=()=>{if(!S){s({title:a.common.notAllowed,description:a.system.noAccessDesc,variant:"destructive"});return}i.current?.click()},H=E=>{const v=E.target.files?.[0];if(E.target.value="",!v)return;if(!S){s({title:a.common.notAllowed,description:a.system.noAccessDesc,variant:"destructive"});return}const A=new FileReader;A.onload=()=>{try{const se=String(A.result??""),le=JSON.parse(se);cc(le),s({title:a.system.importedTitle,description:a.system.importedDesc}),window.setTimeout(()=>window.location.reload(),400)}catch(se){s({title:a.system.importFailedTitle,description:se instanceof Error?se.message:a.system.invalidFile,variant:"destructive"})}},A.onerror=()=>{s({title:a.system.importFailedTitle,description:a.system.couldNotRead,variant:"destructive"})},A.readAsText(v)},_=()=>{if(!S){s({title:a.common.notAllowed,description:a.system.noAccessDesc,variant:"destructive"});return}oc(),s({title:a.system.clearedTitle,description:a.system.clearedDesc}),window.setTimeout(()=>window.location.reload(),400)},B=async()=>{const E=await $e.getSystemSettings();f(E)},J=async()=>{p(!0);try{const E=await de.getCategories();k(E)}finally{p(!1)}};o.useEffect(()=>{(async()=>{l(!0);try{await B(),await J()}catch{s({title:a.system.failedToLoadTitle,description:a.common.pleaseTryAgain,variant:"destructive"})}finally{l(!1)}})()},[]);const oe=()=>{m(null),c({name:"",code:"",description:"",color:"",icon:"",sort_order:0})},I=E=>{m(E),c({name:E.name||"",code:E.code||"",description:E.description||"",color:E.color||"",icon:E.icon||"",sort_order:E.sort_order||0})},Z=async()=>{if(!S){s({title:a.common.notAllowed,description:a.system.noAccessDesc,variant:"destructive"});return}const E=u.name.trim(),v=u.code.trim();if(!E||!v){s({title:a.common.error,description:"الاسم والكود مطلوبين",variant:"destructive"});return}z(!0);try{N?(await de.updateCategory(N.id,{name:E,code:v,description:u.description?.trim()||void 0,color:u.color?.trim()||void 0,icon:u.icon?.trim()||void 0,sort_order:Number(u.sort_order)||0}),s({title:"تم تحديث الفئة"})):(await de.createCategory({name:E,code:v,description:u.description?.trim()||void 0,color:u.color?.trim()||void 0,icon:u.icon?.trim()||void 0,sort_order:Number(u.sort_order)||0}),s({title:"تم إنشاء الفئة"})),m(null),await J()}catch(A){s({title:"فشل حفظ الفئة",description:A instanceof Error?A.message:a.common.pleaseTryAgain,variant:"destructive"})}finally{z(!1)}},ue=async()=>{if(j){if(!S){s({title:a.common.notAllowed,description:a.system.noAccessDesc,variant:"destructive"});return}z(!0);try{await de.deleteCategory(j.id),s({title:"تم حذف الفئة"}),b(null),await J()}catch(E){s({title:"فشل حذف الفئة",description:E instanceof Error?E.message:a.common.pleaseTryAgain,variant:"destructive"})}finally{z(!1)}}},xe=(E,v)=>{f(A=>A&&{...A,riskMatrixThresholds:{...A.riskMatrixThresholds,[E]:v}})},ge=async()=>{if(!L)return;if(!S){s({title:a.common.notAllowed,description:a.system.noAccessDesc,variant:"destructive"});return}const{low:E,medium:v,high:A}=L.riskMatrixThresholds;if(![E,v,A].every(le=>Number.isFinite(le)&&le>0)){s({title:a.system.invalidThresholdsTitle,description:a.system.invalidThresholdsDesc,variant:"destructive"});return}if(!(E<v&&v<A)){s({title:a.system.invalidOrderTitle,description:a.system.invalidOrderDesc,variant:"destructive"});return}if(!Number.isFinite(L.autoAssessmentReminder)||L.autoAssessmentReminder<0){s({title:a.system.invalidReminderTitle,description:a.system.invalidReminderDesc,variant:"destructive"});return}g(!0);try{await $e.updateSystemSettings(L),s({title:a.system.saved}),await B()}catch{s({title:a.system.saveFailedTitle,description:a.common.pleaseTryAgain,variant:"destructive"})}finally{g(!1)}};return d?e.jsx(fe,{}):L?e.jsxs("div",{className:"space-y-6 animate-in",children:[e.jsxs("div",{className:n("flex flex-col sm:flex-row sm:items-end sm:justify-between gap-4",r?"sm:flex-row-reverse":""),children:[e.jsxs("div",{className:n(r?"text-right":"text-left"),children:[e.jsx("h1",{className:"text-2xl font-bold",children:a.system.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a.system.subtitle})]}),S&&e.jsxs(y,{onClick:ge,disabled:h,children:[h?e.jsx(ke,{className:n("h-4 w-4 animate-spin",r?"ml-2":"mr-2")}):e.jsx(Ye,{className:n("h-4 w-4",r?"ml-2":"mr-2")}),a.actions.save]})]}),e.jsxs(R,{className:"glass-card",children:[e.jsx(K,{children:e.jsx(Y,{children:a.system.thresholdsTitle})}),e.jsxs(P,{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:a.system.thresholdsHelp}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"low",children:a.system.lowMax}),e.jsx(G,{id:"low",type:"number",value:L.riskMatrixThresholds.low,onChange:E=>xe("low",Number(E.target.value)),disabled:!S,min:1})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"medium",children:a.system.mediumMax}),e.jsx(G,{id:"medium",type:"number",value:L.riskMatrixThresholds.medium,onChange:E=>xe("medium",Number(E.target.value)),disabled:!S,min:1})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"high",children:a.system.highMax}),e.jsx(G,{id:"high",type:"number",value:L.riskMatrixThresholds.high,onChange:E=>xe("high",Number(E.target.value)),disabled:!S,min:1})]})]})]})]}),e.jsxs(R,{className:"glass-card",children:[e.jsx(K,{children:e.jsx(Y,{children:a.system.notificationsTitle})}),e.jsxs(P,{className:"grid gap-4",children:[e.jsxs("div",{className:n("flex items-center justify-between gap-4",r?"flex-row-reverse":""),children:[e.jsxs("div",{className:n(r?"text-right":"text-left"),children:[e.jsx("p",{className:"font-medium",children:a.system.enableNotifications}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a.system.notificationsHelp})]}),e.jsx(Ot,{checked:L.notifications,onCheckedChange:E=>f(v=>v&&{...v,notifications:E}),disabled:!S})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"reminder",children:a.system.reminderDays}),e.jsx(G,{id:"reminder",type:"number",value:L.autoAssessmentReminder,onChange:E=>f(v=>v&&{...v,autoAssessmentReminder:Number(E.target.value)}),disabled:!S,min:0})]})]})]}),e.jsxs(R,{className:"glass-card",children:[e.jsx(K,{children:e.jsx(Y,{children:a.system.demoDataTitle})}),e.jsxs(P,{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:a.system.demoDataHelp}),e.jsx("input",{ref:i,type:"file",accept:"application/json",className:"hidden","aria-label":"Import demo data JSON",title:"Import demo data JSON",onChange:H}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs(y,{variant:"outline",onClick:ee,disabled:!S,children:[e.jsx(Ps,{className:n("h-4 w-4",r?"ml-2":"mr-2")}),a.system.exportJson]}),e.jsxs(y,{variant:"outline",onClick:U,disabled:!S,children:[e.jsx(or,{className:n("h-4 w-4",r?"ml-2":"mr-2")}),a.system.importJson]}),e.jsxs(Xe,{children:[e.jsx(Bs,{asChild:!0,children:e.jsxs(y,{variant:"destructive",disabled:!S,children:[e.jsx(ns,{className:n("h-4 w-4",r?"ml-2":"mr-2")}),a.system.clearAllData]})}),e.jsxs(_e,{children:[e.jsxs(Be,{children:[e.jsx(Ve,{children:a.system.clearDialogTitle}),e.jsx(He,{children:a.system.clearDialogDescription})]}),e.jsxs(Ue,{children:[e.jsx(Ke,{children:a.actions.cancel}),e.jsx(qe,{onClick:_,children:a.actions.clear})]})]})]})]})]})]}),e.jsxs(R,{className:"glass-card",children:[e.jsx(K,{children:e.jsx(Y,{children:"فئات المخاطر"})}),e.jsxs(P,{className:"space-y-4",children:[e.jsxs("div",{className:n("flex items-center justify-between gap-3",r?"flex-row-reverse":""),children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"إدارة الفئات التي تظهر في سجل المخاطر."}),S&&e.jsxs(Xe,{children:[e.jsx(Bs,{asChild:!0,children:e.jsx(y,{variant:"outline",onClick:oe,children:"إضافة فئة"})}),e.jsxs(_e,{children:[e.jsxs(Be,{children:[e.jsx(Ve,{children:"إضافة فئة"}),e.jsx(He,{children:"أدخل بيانات الفئة الجديدة"})]}),e.jsxs("div",{className:"grid gap-3 py-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"cat-name",children:"الاسم"}),e.jsx(G,{id:"cat-name",value:u.name,onChange:E=>c(v=>({...v,name:E.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"cat-code",children:"الكود"}),e.jsx(G,{id:"cat-code",value:u.code,onChange:E=>c(v=>({...v,code:E.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"cat-desc",children:"الوصف"}),e.jsx(G,{id:"cat-desc",value:u.description,onChange:E=>c(v=>({...v,description:E.target.value}))})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"cat-color",children:"اللون"}),e.jsx(G,{id:"cat-color",value:u.color,onChange:E=>c(v=>({...v,color:E.target.value})),placeholder:"#3B82F6"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"cat-icon",children:"الأيقونة"}),e.jsx(G,{id:"cat-icon",value:u.icon,onChange:E=>c(v=>({...v,icon:E.target.value})),placeholder:"shield"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"cat-order",children:"الترتيب"}),e.jsx(G,{id:"cat-order",type:"number",value:u.sort_order,onChange:E=>c(v=>({...v,sort_order:Number(E.target.value)}))})]})]})]}),e.jsxs(Ue,{children:[e.jsx(Ke,{children:a.actions.cancel}),e.jsx(qe,{onClick:Z,disabled:M,children:"حفظ"})]})]})]})]}),T?e.jsx("p",{className:"text-sm text-muted-foreground",children:"جاري تحميل الفئات..."}):x.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"لا توجد فئات."}):e.jsx("div",{className:"grid gap-2",children:x.slice().sort((E,v)=>(E.sort_order??0)-(v.sort_order??0)).map(E=>e.jsxs("div",{className:n("flex items-center justify-between gap-3 rounded-md border p-3",r?"flex-row-reverse":""),children:[e.jsxs("div",{className:n("flex-1",r?"text-right":"text-left"),children:[e.jsxs("p",{className:"font-medium",children:[E.name," ",e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",E.code,")"]})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:E.description||"—"})]}),e.jsxs("div",{className:n("flex gap-2",r?"flex-row-reverse":""),children:[S&&e.jsxs(Xe,{children:[e.jsx(Bs,{asChild:!0,children:e.jsx(y,{variant:"outline",onClick:()=>I(E),children:"تعديل"})}),e.jsxs(_e,{children:[e.jsxs(Be,{children:[e.jsx(Ve,{children:"تعديل فئة"}),e.jsx(He,{children:"عدّل البيانات ثم احفظ"})]}),e.jsxs("div",{className:"grid gap-3 py-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"cat-name-edit",children:"الاسم"}),e.jsx(G,{id:"cat-name-edit",value:u.name,onChange:v=>c(A=>({...A,name:v.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"cat-code-edit",children:"الكود"}),e.jsx(G,{id:"cat-code-edit",value:u.code,onChange:v=>c(A=>({...A,code:v.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"cat-desc-edit",children:"الوصف"}),e.jsx(G,{id:"cat-desc-edit",value:u.description,onChange:v=>c(A=>({...A,description:v.target.value}))})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"cat-color-edit",children:"اللون"}),e.jsx(G,{id:"cat-color-edit",value:u.color,onChange:v=>c(A=>({...A,color:v.target.value})),placeholder:"#3B82F6"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"cat-icon-edit",children:"الأيقونة"}),e.jsx(G,{id:"cat-icon-edit",value:u.icon,onChange:v=>c(A=>({...A,icon:v.target.value})),placeholder:"shield"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"cat-order-edit",children:"الترتيب"}),e.jsx(G,{id:"cat-order-edit",type:"number",value:u.sort_order,onChange:v=>c(A=>({...A,sort_order:Number(v.target.value)}))})]})]})]}),e.jsxs(Ue,{children:[e.jsx(Ke,{onClick:()=>m(null),children:a.actions.cancel}),e.jsx(qe,{onClick:Z,disabled:M,children:"حفظ"})]})]})]}),S&&e.jsxs(Xe,{open:j?.id===E.id,onOpenChange:v=>b(v?E:null),children:[e.jsx(Bs,{asChild:!0,children:e.jsx(y,{variant:"destructive",onClick:()=>b(E),children:"حذف"})}),e.jsxs(_e,{children:[e.jsxs(Be,{children:[e.jsx(Ve,{children:"حذف فئة"}),e.jsxs(He,{children:['هل أنت متأكد من حذف الفئة "',E.name,'"؟']})]}),e.jsxs(Ue,{children:[e.jsx(Ke,{children:a.actions.cancel}),e.jsx(qe,{onClick:ue,disabled:M,children:"حذف"})]})]})]})]})]},E.id))})]})]})]}):e.jsxs("div",{className:"space-y-6 animate-in",children:[e.jsx("h1",{className:n("text-2xl font-bold",r?"text-right":"text-left"),children:a.system.title}),e.jsx(R,{className:"glass-card",children:e.jsx(P,{className:"p-6",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:a.system.noSettings})})})]})},mc=()=>{const{strings:s,isRTL:t}=ie(),{toast:a}=Pe(),[r,i]=O.useState(!0),[d,l]=O.useState([]),[h,g]=O.useState(!1),[L,f]=O.useState(null),[x,k]=O.useState(""),[T,p]=O.useState(""),[N,m]=O.useState("Viewer"),u=O.useCallback(async()=>{i(!0);try{l(await $e.getUsers())}finally{i(!1)}},[]);O.useEffect(()=>{u()},[u]);const c=()=>{f(null),k(""),p(""),m("Viewer")},j=()=>{c(),g(!0)},b=S=>{f({id:S.id,name:S.name,email:S.email,role:S.role}),k(S.name),p(S.email),m(S.role),g(!0)},M=async()=>{const S=x.trim(),X=T.trim();if(!S||!X){a({title:s.users.missingFields,variant:"destructive"});return}try{L?(await $e.updateUser(L.id,{name:S,email:X,role:N}),a({title:s.users.updatedTitle,description:s.users.updatedDesc})):(await $e.createUser({name:S,email:X,role:N}),a({title:s.users.createdTitle,description:s.users.createdDesc})),g(!1),c(),await u()}catch{a({title:s.users.saveFailedTitle,description:s.common.pleaseTryAgain,variant:"destructive"})}},z=async S=>{try{await $e.deleteUser(S.id),a({title:s.users.deletedTitle,description:s.users.deletedDesc}),await u()}catch{a({title:s.users.deleteFailedTitle,description:s.common.pleaseTryAgain,variant:"destructive"})}};return r?e.jsx(fe,{text:s.common.loading}):e.jsxs("div",{className:"space-y-6 animate-in",children:[e.jsxs("div",{className:n("flex items-start justify-between gap-4",t?"flex-row-reverse":""),children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:s.users.title}),e.jsx("p",{className:"text-muted-foreground",children:s.users.subtitle})]}),e.jsxs(y,{onClick:j,children:[e.jsx(ze,{className:n("h-4 w-4",t?"ml-2":"mr-2")}),s.users.addUser]})]}),e.jsxs(R,{className:"glass-card",children:[e.jsxs(K,{children:[e.jsx(Y,{className:"text-base",children:s.users.listTitle}),e.jsx(ye,{children:s.users.listDesc})]}),e.jsx(P,{children:e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-border text-sm text-muted-foreground",children:[e.jsx("th",{className:n("py-3 px-4 font-medium",t?"text-right":"text-left"),children:s.users.name}),e.jsx("th",{className:n("py-3 px-4 font-medium",t?"text-right":"text-left"),children:s.users.email}),e.jsx("th",{className:"py-3 px-4 font-medium text-center",children:s.users.role}),e.jsx("th",{className:"py-3 px-4 font-medium text-center",children:s.table.actions})]})}),e.jsx("tbody",{children:d.map(S=>e.jsxs("tr",{className:"border-b border-border/50 hover:bg-muted/20 transition-colors",children:[e.jsxs("td",{className:n("py-3 px-4",t?"text-right":"text-left"),children:[e.jsx("p",{className:"text-sm font-medium",children:S.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.table.id,": ",S.id]})]}),e.jsx("td",{className:n("py-3 px-4 text-sm text-muted-foreground",t?"text-right":"text-left"),children:S.email}),e.jsx("td",{className:"py-3 px-4 text-center text-sm",children:S.role}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(y,{size:"icon",variant:"ghost",onClick:()=>b(S),"aria-label":s.actions.edit,children:e.jsx(it,{className:"h-4 w-4"})}),e.jsx(y,{size:"icon",variant:"ghost",onClick:()=>z(S),"aria-label":s.actions.delete,children:e.jsx(ns,{className:"h-4 w-4 text-destructive"})})]})})]},S.id))})]}),d.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground py-6 text-center",children:s.users.noUsers})]})})]}),e.jsxs(ds,{open:h,onOpenChange:S=>{g(S),S||c()},children:[e.jsx(bl,{asChild:!0,children:e.jsx("span",{})}),e.jsxs(ts,{children:[e.jsxs(as,{children:[e.jsx(rs,{children:L?s.users.editUser:s.users.addUser}),e.jsx(is,{children:s.users.dialogDesc})]}),e.jsxs("div",{className:"grid gap-4 py-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"name",children:s.users.name}),e.jsx(G,{id:"name",value:x,onChange:S=>k(S.target.value),placeholder:s.users.namePlaceholder})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{htmlFor:"email",children:s.users.email}),e.jsx(G,{id:"email",value:T,onChange:S=>p(S.target.value),placeholder:s.users.emailPlaceholder})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:s.users.role}),e.jsxs(Re,{value:N,onValueChange:S=>m(S),children:[e.jsx(Se,{children:e.jsx(Ae,{})}),e.jsx(Te,{children:lt.map(S=>e.jsx(te,{value:S,children:S},S))})]})]})]}),e.jsxs(js,{className:n(t?"sm:flex-row-reverse":""),children:[e.jsx(y,{variant:"outline",onClick:()=>g(!1),children:s.actions.cancel}),e.jsx(y,{onClick:M,children:s.actions.save})]})]})]})]})},sa={exportBackup:async()=>{try{const s=await $.get("/backup/export",{responseType:"blob"}),t=s.headers["content-disposition"];let a=`risk_backup_${new Date().toISOString().split("T")[0]}.db`;if(t){const d=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/.exec(t);d!=null&&d[1]&&(a=d[1].replace(/['"]/g,""))}const r=window.URL.createObjectURL(new Blob([s.data])),i=document.createElement("a");return i.href=r,i.setAttribute("download",a),document.body.appendChild(i),i.click(),i.remove(),window.URL.revokeObjectURL(r),!0}catch(s){throw console.error("Failed to export backup:",s),s}},importBackup:async s=>{try{const t=new FormData;return t.append("file",s),(await $.post("/backup/import",t,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(t){throw console.error("Failed to import backup:",t),t}}},uc=()=>{const{t:s,isRTL:t}=ie(),{toast:a}=Pe(),[r,i]=o.useState(!1),[d,l]=o.useState(!1),[h,g]=o.useState(!1),[L,f]=o.useState(null),x=async()=>{i(!0);try{await sa.exportBackup(),a({title:"Backup Created",description:"Database backup has been downloaded successfully."})}catch{a({title:"Backup Failed",description:"Failed to create database backup.",variant:"destructive"})}finally{i(!1)}},k=p=>{if(p.target.files&&p.target.files[0]){const N=p.target.files[0];if(!N.name.endsWith(".db")){a({title:"Invalid File",description:"Please select a valid .db file",variant:"destructive"});return}f(N),g(!0)}},T=async()=>{if(L){l(!0);try{await sa.importBackup(L),a({title:"Restore Successful",description:"System has been restored from backup. Please log in again."}),setTimeout(()=>{window.location.reload()},2e3)}catch{a({title:"Restore Failed",description:"Failed to restore from backup.",variant:"destructive"})}finally{l(!1),g(!1),f(null)}}};return e.jsxs("div",{className:"space-y-6 animate-in fade-in duration-500",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"System Backup & Restore"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Manage your system data backups and restoration points."})]})}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(R,{className:"border-primary/20 shadow-lg",children:[e.jsxs(K,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10 text-primary",children:e.jsx(Vi,{className:"h-6 w-6"})}),e.jsx(Y,{children:"Create Backup"})]}),e.jsx(ye,{children:"Download a complete copy of your system database."})]}),e.jsxs(P,{className:"space-y-4",children:[e.jsx("div",{className:"rounded-lg border p-4 bg-muted/50",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(Hi,{className:"h-5 w-5 text-green-600 mt-0.5"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"font-medium text-sm",children:"Safe & Secure"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Your data is exported securely. Includes all risks, assessments, and configurations."})]})]})}),e.jsx(y,{className:"w-full",onClick:x,disabled:r,children:r?e.jsxs(e.Fragment,{children:[e.jsx(ke,{className:`h-4 w-4 animate-spin ${t?"ml-2":"mr-2"}`}),"Exporting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ps,{className:`h-4 w-4 ${t?"ml-2":"mr-2"}`}),"Download Backup"]})})]})]}),e.jsxs(R,{className:"border-destructive/20 shadow-lg",children:[e.jsxs(K,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-destructive/10 text-destructive",children:e.jsx(qi,{className:"h-6 w-6"})}),e.jsx(Y,{children:"Restore System"})]}),e.jsx(ye,{children:"Restore your system from a previous backup file."})]}),e.jsxs(P,{className:"space-y-4",children:[e.jsxs(Lt,{variant:"destructive",children:[e.jsx(ss,{className:"h-4 w-4"}),e.jsx(Et,{children:"Warning"}),e.jsx(Ft,{children:"Restoring will overwrite all current data. This action cannot be undone."})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("input",{type:"file",accept:".db",className:"hidden",id:"backup-upload",onChange:k,disabled:d}),e.jsxs(y,{variant:"outline",className:"w-full border-dashed border-2 hover:bg-muted",disabled:d,onClick:()=>document.getElementById("backup-upload")?.click(),children:[e.jsx(or,{className:`h-4 w-4 ${t?"ml-2":"mr-2"}`}),"Select Backup File"]})]})]})]})]}),e.jsx(ds,{open:h,onOpenChange:g,children:e.jsxs(ts,{children:[e.jsxs(as,{children:[e.jsxs(rs,{className:"flex items-center gap-2 text-destructive",children:[e.jsx(ss,{className:"h-5 w-5"}),"Confirm System Restore"]}),e.jsxs(is,{className:"space-y-3 pt-4",children:[e.jsxs("p",{children:["You are about to restore the system from file:",e.jsx("span",{className:"font-semibold block mt-1 p-2 bg-muted rounded border",children:L?.name})]}),e.jsx("p",{className:"font-medium text-destructive",children:"All current data will be permanently replaced. Are you sure you want to proceed?"})]})]}),e.jsxs(js,{children:[e.jsx(y,{variant:"outline",onClick:()=>{g(!1),f(null)},disabled:d,children:"Cancel"}),e.jsx(y,{variant:"destructive",onClick:T,disabled:d,children:d?e.jsxs(e.Fragment,{children:[e.jsx(ke,{className:`h-4 w-4 animate-spin ${t?"ml-2":"mr-2"}`}),"Restoring..."]}):"Yes, Restore System"})]})]})})]})},xc=()=>{const[s,t]=o.useState([]),[a,r]=o.useState(!0),{strings:i,isRTL:d}=ie();return o.useEffect(()=>{$e.getAuditLogs().then(l=>{t(l.logs),r(!1)})},[]),a?e.jsx(fe,{}):e.jsxs("div",{className:"space-y-6 animate-in",children:[e.jsx("h1",{className:"text-2xl font-bold",children:i.audit.title}),e.jsx(R,{className:"glass-card",children:e.jsx(P,{className:"p-0",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-border",children:[e.jsx("th",{className:n("p-4 text-sm font-medium text-muted-foreground",d?"text-right":"text-left"),children:i.audit.time}),e.jsx("th",{className:n("p-4 text-sm font-medium text-muted-foreground",d?"text-right":"text-left"),children:i.audit.actor}),e.jsx("th",{className:n("p-4 text-sm font-medium text-muted-foreground",d?"text-right":"text-left"),children:i.audit.action}),e.jsx("th",{className:n("p-4 text-sm font-medium text-muted-foreground",d?"text-right":"text-left"),children:i.audit.details})]})}),e.jsx("tbody",{children:s.map(l=>e.jsxs("tr",{className:"border-b border-border/50",children:[e.jsx("td",{className:n("p-4 text-sm",d?"text-right":"text-left"),children:new Date(l.timestamp).toLocaleString()}),e.jsx("td",{className:n("p-4 text-sm",d?"text-right":"text-left"),children:l.actor}),e.jsx("td",{className:n("p-4 text-sm",d?"text-right":"text-left"),children:l.action}),e.jsx("td",{className:n("p-4 text-sm text-muted-foreground",d?"text-right":"text-left"),children:l.details})]},l.id))})]})})})]})},hc=()=>{const{strings:s,isRTL:t}=ie(),[a,r]=O.useState(!0),[i,d]=O.useState([]);O.useEffect(()=>{(async()=>{try{d(await de.getAll())}finally{r(!1)}})()},[]);const l=i.filter(x=>x.level==="Critical"),h=i.filter(x=>x.level==="High"),g=i.filter(x=>x.status==="Open"||x.status==="Monitoring"),L=i.filter(x=>x.status==="Closed"),f=[...i].filter(x=>x.level==="Critical"||x.level==="High").sort((x,k)=>(k.score??0)-(x.score??0)).slice(0,5);return a?e.jsx(fe,{text:s.common.loading}):e.jsxs("div",{className:"space-y-6 animate-in",children:[e.jsxs("div",{className:n("flex items-center justify-between gap-4 print:hidden",t?"flex-row-reverse":""),children:[e.jsxs("div",{className:n(t?"text-right":"text-left"),children:[e.jsx("h1",{className:"text-2xl font-bold",children:s.reports.executiveTitle}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.reports.executiveSubtitle})]}),e.jsxs("div",{className:n("flex items-center gap-2",t?"flex-row-reverse":""),children:[e.jsxs(y,{variant:"outline",onClick:()=>window.print(),children:[e.jsx(fs,{className:n("h-4 w-4",t?"ml-2":"mr-2")}),s.reports.print]}),e.jsx(y,{asChild:!0,children:e.jsx(Q,{to:"/reports/custom",children:s.reports.customReport})})]})]}),e.jsxs(R,{className:"hidden print:block",children:[e.jsx(K,{children:e.jsx(Y,{className:t?"text-right":"text-left",children:s.reports.executiveTitle})}),e.jsx(P,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:new Date().toLocaleDateString(t?"ar-SA":"en-US")})})]}),e.jsxs(R,{className:"glass-card",children:[e.jsx(K,{children:e.jsx(Y,{children:s.reports.executiveSummaryTitle})}),e.jsxs(P,{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed",children:s.reports.executiveSummaryText.replace("{total}",String(i.length)).replace("{critical}",String(l.length)).replace("{closed}",String(L.length))}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"p-4 rounded-lg bg-primary/10 text-center",children:[e.jsx(Ze,{className:"h-7 w-7 text-primary mx-auto mb-2"}),e.jsx("div",{className:"text-2xl font-bold",children:i.length}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s.reports.totalRisks})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-status-critical/10 text-center",children:[e.jsx(ss,{className:"h-7 w-7 text-status-critical mx-auto mb-2"}),e.jsx("div",{className:"text-2xl font-bold",children:l.length}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s.reports.criticalRisks})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-status-warning/10 text-center",children:[e.jsx(ws,{className:"h-7 w-7 text-status-warning mx-auto mb-2"}),e.jsx("div",{className:"text-2xl font-bold",children:g.length}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s.reports.inProgress})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-status-success/10 text-center",children:[e.jsx(ir,{className:"h-7 w-7 text-status-success mx-auto mb-2"}),e.jsx("div",{className:"text-2xl font-bold",children:L.length}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s.reports.closedRisks})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(pe,{variant:"secondary",children:[s.reports.highRisksLabel,": ",h.length]}),e.jsx(pe,{variant:"secondary",children:s.reports.top5Included})]})]})]}),e.jsxs(R,{className:"glass-card",children:[e.jsx(K,{children:e.jsx(Y,{children:s.reports.keyRisksTitle})}),e.jsx(P,{children:f.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:s.reports.noPriorityRisks}):e.jsx("div",{className:"space-y-3",children:f.map(x=>e.jsx("div",{className:"p-4 border border-border rounded-lg",children:e.jsxs("div",{className:n("flex items-start justify-between gap-4",t?"flex-row-reverse":""),children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:n("flex items-center gap-2",t?"flex-row-reverse":""),children:[e.jsx("p",{className:"font-semibold truncate",children:x.title}),e.jsx(ce,{status:x.level,children:s.risks.levels?.[x.level]??x.level})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1 line-clamp-2",children:x.description}),e.jsxs("div",{className:n("flex flex-wrap gap-3 mt-2 text-xs text-muted-foreground",t?"flex-row-reverse":""),children:[e.jsxs("span",{children:[s.table.id,": ",e.jsx("span",{className:"text-foreground",children:x.id})]}),e.jsxs("span",{children:[s.table.owner,": ",e.jsx("span",{className:"text-foreground",children:x.owner})]}),e.jsxs("span",{children:[s.table.score,": ",e.jsx("span",{className:"text-foreground font-semibold",children:x.score})]})]})]}),e.jsx(y,{asChild:!0,variant:"outline",className:"shrink-0 print:hidden",children:e.jsx(Q,{to:`/risks/${x.id}`,children:s.reports.viewRisk})})]})},x.id))})})]}),e.jsxs(R,{className:"glass-card",children:[e.jsx(K,{children:e.jsx(Y,{children:s.reports.recommendationsTitle})}),e.jsx(P,{children:e.jsxs("ul",{className:"space-y-2 text-sm",children:[e.jsx("li",{children:s.reports.reco1}),e.jsx("li",{children:s.reports.reco2}),e.jsx("li",{children:s.reports.reco3}),e.jsx("li",{children:s.reports.reco4})]})})]}),e.jsxs(R,{className:"glass-card print:hidden",children:[e.jsx(K,{children:e.jsx(Y,{children:s.reports.quickLinksTitle})}),e.jsxs(P,{className:"flex flex-wrap gap-2",children:[e.jsx(y,{asChild:!0,variant:"outline",children:e.jsx(Q,{to:"/reports/home",children:s.reports.reportsHome})}),e.jsx(y,{asChild:!0,variant:"outline",children:e.jsx(Q,{to:"/reports/standard",children:s.reports.standardReport})}),e.jsx(y,{asChild:!0,variant:"outline",children:e.jsx(Q,{to:"/analysis/matrix",children:s.page.riskMatrix})})]})]})]})},ta=s=>{const t=String(s??"");return/[\n\r,"]/.test(t)?`"${t.replace(/"/g,'""')}"`:t},pc=(s,t,a)=>{const r=new Blob([t],{type:a}),i=URL.createObjectURL(r),d=document.createElement("a");d.href=i,d.download=s,document.body.appendChild(d),d.click(),d.remove(),URL.revokeObjectURL(i)},gc=()=>{const{strings:s,isRTL:t}=ie(),{can:a}=Ne(),[r,i]=O.useState(!0),[d,l]=O.useState([]);O.useEffect(()=>{(async()=>{try{l(await de.getAll())}finally{i(!1)}})()},[]);const h=()=>{if(!a("canExport"))return;const x=[s.table.id,s.table.title,s.table.category,s.table.level,s.table.status,s.table.owner,s.table.score],k=d.map(p=>[p.id,p.title,p.category,p.level,p.status,p.owner,p.score]),T=[x.map(ta).join(","),...k.map(p=>p.map(ta).join(","))].join(`
`);pc(`risk-standard-${new Date().toISOString().slice(0,10)}.csv`,T,"text/csv;charset=utf-8")};if(r)return e.jsx(fe,{text:s.common.loading});const g=d.filter(x=>x.level==="Critical").length,L=d.filter(x=>x.level==="High").length,f=d.filter(x=>x.status==="Closed").length;return e.jsxs("div",{className:"space-y-6 animate-in",children:[e.jsxs("div",{className:n("flex items-center justify-between gap-4 print:hidden",t?"flex-row-reverse":""),children:[e.jsxs("div",{className:n(t?"text-right":"text-left"),children:[e.jsx("h1",{className:"text-2xl font-bold",children:s.reports.standardTitle}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.reports.standardSubtitle})]}),e.jsxs("div",{className:n("flex gap-2",t?"flex-row-reverse":""),children:[e.jsxs(y,{variant:"outline",onClick:()=>window.print(),children:[e.jsx(Ki,{className:n("h-4 w-4",t?"ml-2":"mr-2")}),s.reports.print]}),e.jsxs(y,{variant:"outline",onClick:h,disabled:!a("canExport"),children:[e.jsx(Ps,{className:n("h-4 w-4",t?"ml-2":"mr-2")}),s.reports.exportCsv]})]})]}),e.jsxs(R,{className:"hidden print:block",children:[e.jsx(K,{children:e.jsx(Y,{className:t?"text-right":"text-left",children:s.reports.standardTitle})}),e.jsx(P,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:new Date().toLocaleDateString(t?"ar-SA":"en-US")})})]}),e.jsxs(R,{className:"glass-card",children:[e.jsx(K,{children:e.jsx(Y,{children:s.reports.summaryTitle})}),e.jsx(P,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-muted/50 rounded-lg",children:[e.jsx("div",{className:"text-3xl font-bold text-primary",children:d.length}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:s.reports.totalRisks})]}),e.jsxs("div",{className:"text-center p-4 bg-status-critical/10 rounded-lg",children:[e.jsx("div",{className:"text-3xl font-bold text-status-critical",children:g}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:s.reports.criticalRisks})]}),e.jsxs("div",{className:"text-center p-4 bg-status-warning/10 rounded-lg",children:[e.jsx("div",{className:"text-3xl font-bold text-status-warning",children:L}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:s.reports.highRisks})]}),e.jsxs("div",{className:"text-center p-4 bg-status-success/10 rounded-lg",children:[e.jsx("div",{className:"text-3xl font-bold text-status-success",children:f}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:s.reports.closedRisks})]})]})})]}),e.jsxs(R,{className:"glass-card",children:[e.jsx(K,{children:e.jsx(Y,{children:s.reports.detailedTableTitle})}),e.jsx(P,{children:d.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:s.reports.noRisksAvailable}):e.jsx("div",{className:"rounded-md border border-border overflow-hidden",children:e.jsxs(Cs,{children:[e.jsx(Rs,{children:e.jsxs(We,{children:[e.jsx(De,{children:s.table.id}),e.jsx(De,{children:s.table.title}),e.jsx(De,{children:s.table.category}),e.jsx(De,{children:s.table.status}),e.jsx(De,{className:n(t?"text-left":"text-right"),children:s.table.score}),e.jsx(De,{children:s.table.level})]})}),e.jsx(As,{children:d.slice().sort((x,k)=>(k.score??0)-(x.score??0)).map(x=>e.jsxs(We,{children:[e.jsx(Ce,{className:"font-medium",children:x.id}),e.jsx(Ce,{children:x.title}),e.jsx(Ce,{children:s.risks.categories?.[x.category]??x.category}),e.jsx(Ce,{children:s.risks.statuses?.[x.status]??x.status}),e.jsx(Ce,{className:n(t?"text-left":"text-right"),children:x.score}),e.jsx(Ce,{children:e.jsx(ce,{status:x.level,children:s.risks.levels?.[x.level]??x.level})})]},x.id))})]})})})]})]})},aa=s=>{const t=String(s??"");return/[\n\r,"]/.test(t)?`"${t.replace(/"/g,'""')}"`:t},xs=s=>String(s??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),ra=(s,t,a)=>{const r=new Blob([t],{type:a}),i=URL.createObjectURL(r),d=document.createElement("a");d.href=i,d.download=s,document.body.appendChild(d),d.click(),d.remove(),URL.revokeObjectURL(i)},fc=(s,t)=>{switch(t){case"id":return s.id;case"title":return s.title;case"description":return s.description;case"category":return s.category;case"level":return s.level;case"status":return s.status;case"owner":return s.owner;case"likelihood":return s.likelihood;case"impact":return s.impact;case"score":return s.score;case"createdAt":return s.createdAt;case"updatedAt":return s.updatedAt;default:return""}},jc=()=>{const{strings:s,isRTL:t}=ie(),{toast:a}=Pe(),{can:r}=Ne(),[i,d]=O.useState(!0),[l,h]=O.useState([]),[g,L]=O.useState("csv"),f=["id","title","level","status","owner","score"],[x,k]=O.useState(f);O.useEffect(()=>{(async()=>{try{h(await de.getAll())}finally{d(!1)}})()},[]);const T=[{id:"id",label:s.table.id},{id:"title",label:s.table.title},{id:"description",label:s.table.description},{id:"category",label:s.table.category},{id:"level",label:s.table.level},{id:"status",label:s.table.status},{id:"owner",label:s.table.owner},{id:"likelihood",label:s.reports.fieldLikelihood},{id:"impact",label:s.reports.fieldImpact},{id:"score",label:s.table.score},{id:"createdAt",label:s.reports.fieldCreatedAt},{id:"updatedAt",label:s.table.updated}],p=u=>{k(c=>c.includes(u)?c.filter(j=>j!==u):[...c,u])},N=()=>k(f),m=()=>{if(!r("canExport")){a({title:s.common.notAllowed,description:s.reports.noExportPermission,variant:"destructive"});return}if(x.length===0){a({title:s.reports.missingFieldsTitle,description:s.reports.missingFieldsDesc,variant:"destructive"});return}const u=l.slice().sort((z,S)=>(S.score??0)-(z.score??0)).map(z=>x.map(S=>fc(z,S))),c=`risk-custom-${new Date().toISOString().slice(0,10)}`;if(g==="csv"){const S=[x.map(X=>T.find(ee=>ee.id===X)?.label??X).map(aa).join(","),...u.map(X=>X.map(aa).join(","))].join(`
`);ra(`${c}.csv`,S,"text/csv;charset=utf-8"),a({title:s.reports.exportReadyTitle,description:s.reports.exportCsvDesc});return}const j=x.map(z=>`<th>${xs(T.find(S=>S.id===z)?.label??z)}</th>`).join(""),b=u.map(z=>`<tr>${z.map(S=>`<td>${xs(S)}</td>`).join("")}</tr>`).join(""),M=`<!doctype html>
<html lang="${t?"ar":"en"}" dir="${t?"rtl":"ltr"}">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>${xs(s.reports.customTitle)}</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; padding: 24px; }
      h1 { margin: 0 0 8px 0; }
      .meta { color: #555; margin-bottom: 16px; }
      table { width: 100%; border-collapse: collapse; }
      th, td { border-bottom: 1px solid #eee; padding: 8px; text-align: start; vertical-align: top; }
      th { background: #fafafa; }
      @media print { body { padding: 0; } }
    </style>
  </head>
  <body>
    <h1>${xs(s.reports.customTitle)}</h1>
    <div class="meta">${xs(s.reports.generated)}: ${xs(new Date().toISOString())}</div>
    <table>
      <thead><tr>${j}</tr></thead>
      <tbody>${b}</tbody>
    </table>
    <p style="margin-top:12px;color:#666;font-size:12px;">${xs(s.reports.noteHtml)}</p>
  </body>
</html>`;ra(`${c}.html`,M,"text/html;charset=utf-8"),a({title:s.reports.exportReadyTitle,description:s.reports.exportHtmlDesc})};return i?e.jsx(fe,{text:s.common.loading}):e.jsxs("div",{className:"space-y-6 animate-in",children:[e.jsxs("div",{className:n(t?"text-right":"text-left"),children:[e.jsx("h1",{className:"text-2xl font-bold",children:s.reports.customTitle}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.reports.customSubtitle})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1 space-y-6",children:e.jsxs(R,{className:"glass-card",children:[e.jsxs(K,{children:[e.jsx(Y,{className:"text-base",children:s.reports.reportConfigTitle}),e.jsx(ye,{children:s.reports.reportConfigDesc})]}),e.jsxs(P,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:s.reports.format}),e.jsxs(Re,{value:g,onValueChange:u=>L(u),children:[e.jsx(Se,{children:e.jsx(Ae,{})}),e.jsxs(Te,{children:[e.jsx(te,{value:"csv",children:"CSV"}),e.jsx(te,{value:"html",children:"HTML"})]})]})]}),e.jsxs("div",{className:t?"flex gap-2 flex-row-reverse":"flex gap-2",children:[e.jsxs(y,{className:"flex-1 gap-2",onClick:m,disabled:!r("canExport"),children:[e.jsx(fs,{className:"h-4 w-4"}),s.reports.generate]}),e.jsxs(y,{variant:"outline",onClick:N,className:"gap-2",children:[e.jsx(cr,{className:"h-4 w-4"}),s.actions.reset]})]}),!r("canExport")&&e.jsx("p",{className:"text-xs text-muted-foreground",children:s.reports.exportPermissionHint})]})]})}),e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(R,{className:"glass-card",children:[e.jsxs(K,{children:[e.jsx(Y,{children:s.reports.fieldsTitle}),e.jsx(ye,{children:s.reports.fieldsDesc})]}),e.jsx(P,{children:e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-4",children:T.map(u=>e.jsxs("div",{className:t?"flex items-center gap-2 flex-row-reverse":"flex items-center gap-2",children:[e.jsx(mt,{id:u.id,checked:x.includes(u.id),onCheckedChange:()=>p(u.id)}),e.jsx(V,{htmlFor:u.id,className:"cursor-pointer",children:u.label})]},u.id))})})]}),e.jsxs(R,{className:"glass-card",children:[e.jsxs(K,{children:[e.jsx(Y,{children:s.reports.previewTitle}),e.jsx(ye,{children:s.reports.previewDesc.replace("{selected}",String(x.length)).replace("{total}",String(T.length))})]}),e.jsx(P,{children:e.jsx("div",{className:"flex flex-wrap gap-2",children:x.map(u=>{const c=T.find(j=>j.id===u)?.label??u;return e.jsx("span",{className:"px-3 py-1 bg-primary/10 text-primary rounded-full text-sm",children:c},u)})})})]})]})]})]})},vc=()=>e.jsxs(zi,{children:[e.jsx(re,{path:"/login",element:e.jsx(Xn,{})}),e.jsxs(re,{element:e.jsx(me,{children:e.jsx(xl,{})}),children:[e.jsx(re,{path:"/",element:e.jsx(ys,{to:"/dashboard",replace:!0})}),e.jsx(re,{path:"/dashboard",element:e.jsx(gl,{})}),e.jsx(re,{path:"/risks/dashboard",element:e.jsx(Sl,{})}),e.jsx(re,{path:"/risks",element:e.jsx(vl,{})}),e.jsx(re,{path:"/risks/new",element:e.jsx(me,{requirePermission:"canCreate",children:e.jsx(Yt,{})})}),e.jsx(re,{path:"/risks/:id",element:e.jsx(wl,{})}),e.jsx(re,{path:"/risks/:id/edit",element:e.jsx(me,{requirePermission:"canEdit",children:e.jsx(Yt,{})})}),e.jsx(re,{path:"/risks/followup",element:e.jsx(me,{requirePermission:"canViewFollowUp",children:e.jsx(Tl,{})})}),e.jsx(re,{path:"/analysis/dashboard",element:e.jsx(me,{requirePermission:"canViewAnalysis",children:e.jsx(Pl,{})})}),e.jsx(re,{path:"/analysis/matrix",element:e.jsx(me,{requirePermission:"canViewAnalysis",children:e.jsx(Ll,{})})}),e.jsx(re,{path:"/assessments/new",element:e.jsx(me,{requirePermission:"canCreate",children:e.jsx(El,{})})}),e.jsx(re,{path:"/treatments",element:e.jsx(me,{requirePermission:"canViewTreatments",children:e.jsx(Jt,{})})}),e.jsx(re,{path:"/treatments/:riskId",element:e.jsx(me,{requirePermission:"canViewTreatments",children:e.jsx(Jt,{})})}),e.jsx(re,{path:"/bcp/dashboard",element:e.jsx(me,{requirePermission:"canViewBCP",children:e.jsx(ql,{})})}),e.jsx(re,{path:"/bcp/plans",element:e.jsx(me,{requirePermission:"canViewBCP",children:e.jsx(Ql,{})})}),e.jsx(re,{path:"/bcp/services",element:e.jsx(me,{requirePermission:"canViewBCP",children:e.jsx(Fl,{})})}),e.jsx(re,{path:"/bcp/plan",element:e.jsx(me,{requirePermission:"canViewBCP",children:e.jsx(Ml,{})})}),e.jsx(re,{path:"/bcp/dr",element:e.jsx(me,{requirePermission:"canViewBCP",children:e.jsx(Vl,{})})}),e.jsx(re,{path:"/bcp/tests",element:e.jsx(me,{requirePermission:"canViewBCP",children:e.jsx(Jl,{})})}),e.jsx(re,{path:"/reports",element:e.jsx(ys,{to:"/reports/home",replace:!0})}),e.jsx(re,{path:"/reports/home",element:e.jsx(me,{requirePermission:"canViewReports",children:e.jsx(ac,{})})}),e.jsx(re,{path:"/reports/register",element:e.jsx(me,{requirePermission:"canViewReports",children:e.jsx(tc,{})})}),e.jsx(re,{path:"/reports/executive",element:e.jsx(me,{requirePermission:"canViewReports",children:e.jsx(hc,{})})}),e.jsx(re,{path:"/reports/standard",element:e.jsx(me,{requirePermission:"canViewReports",children:e.jsx(gc,{})})}),e.jsx(re,{path:"/reports/custom",element:e.jsx(me,{requirePermission:"canViewReports",children:e.jsx(jc,{})})}),e.jsx(re,{path:"/settings/roles",element:e.jsx(me,{requirePermission:"canViewSettings",children:e.jsx(rc,{})})}),e.jsx(re,{path:"/settings/permissions",element:e.jsx(me,{requirePermission:"canViewSettings",children:e.jsx(nc,{})})}),e.jsx(re,{path:"/settings/system",element:e.jsx(me,{requirePermission:"canViewSettings",children:e.jsx(dc,{})})}),e.jsx(re,{path:"/settings/users",element:e.jsx(me,{requirePermission:"canManageUsers",children:e.jsx(mc,{})})}),e.jsx(re,{path:"/settings/backup",element:e.jsx(me,{requirePermission:"canViewSettings",children:e.jsx(uc,{})})}),e.jsx(re,{path:"/audit",element:e.jsx(me,{requirePermission:"canViewAudit",children:e.jsx(xc,{})})})]}),e.jsx(re,{path:"*",element:e.jsx(ys,{to:"/dashboard",replace:!0})})]});class bc extends O.Component{state={hasError:!1};static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t){}render(){return this.state.hasError?e.jsx("div",{className:"min-h-screen bg-background p-4 flex items-center justify-center",children:e.jsxs(R,{className:"w-full max-w-2xl glass-card",children:[e.jsx(K,{children:e.jsx(Y,{children:"Something went wrong"})}),e.jsxs(P,{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"The app hit a runtime error while rendering. Try reloading the page."}),!1,e.jsxs("div",{className:"flex gap-2",children:[e.jsx(y,{onClick:()=>window.location.reload(),children:"Reload"}),e.jsx(y,{variant:"outline",onClick:()=>this.setState({hasError:!1,error:void 0}),children:"Try again"})]})]})]})}):this.props.children}}const yc=new en,Nc=()=>e.jsx(Yi,{client:yc,children:e.jsxs(xn,{children:[e.jsx(mn,{}),e.jsx(un,{}),e.jsx(bc,{children:e.jsx(Yn,{children:e.jsx(Wi,{children:e.jsx(Vn,{children:e.jsx(vc,{})})})})})]})});Ji.createRoot(document.getElementById("root")).render(e.jsx(Nc,{}));
